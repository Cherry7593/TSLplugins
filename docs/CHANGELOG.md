# TSLplugins 更新日志

> 记录插件的所有功能更新和修复

---

## [v1.0] - 2025-11-30

### ✨ 新增功能
- **玩家配置 YAML 存储系统**
  - 新增 `TSLPlayerProfile` 数据类
  - 新增 `TSLPlayerProfileStore` 存储管理器
  - 玩家配置存储在 `playerdata/<uuid>.yml`
  - 自动从 PDC 迁移旧数据
  - 支持离线编辑配置文件

### 🔧 优化改进
- **PlayerDataManager 重构**
  - 从 PDC 存储迁移到 YAML 存储
  - 添加自动迁移功能
  - 优化内存缓存策略
  - 批量保存功能

### 🐛 Bug 修复
- **ChatBubble 线程安全修复**
  - 修复 `removePassenger()` 跨线程错误
  - 修复 `display.remove()` 跨线程错误
  - 改用实体调度器确保线程安全
  - 完善异常处理

### 📚 文档更新
- 新增 `FOLIA_THREAD_SAFETY_GUIDE.md` - Folia 线程安全开发规范
- 新增 `PLAYERDATA_YAML_MIGRATION.md` - 玩家数据迁移指南
- 新增 `CHATBUBBLE_SCHEDULER_FIX.md` - ChatBubble 修复技术要点
- 新增 `开发历程总结.md` - 完整开发历程
- 更新 `开发者指南.md` - 添加 YAML 存储相关问题

---

## [v0.9] - 2025-11-29

### 🔧 重大修复
- **ChatBubble 跨线程错误修复**
  - 第一次修复：移除手动 `removePassenger()` 调用
  - 第二次修复：改用实体调度器删除实体
  - 完善 Folia 线程安全机制

### 📚 文档新增
- 创建完整的 Folia 线程安全开发规范
- 整理 ChatBubble 修复历程文档

---

## [v0.8] - 2025-11-26

### 📚 文档完善
- **开发者指南重大更新** (1700+ 行)
  - 添加根目录核心文件详解
  - 添加已实现功能模块总结
  - 完善架构设计说明
  - 添加开发经验总结

- **README 和 WIKI 更新**
  - 功能概览表格
  - 更新日志章节
  - 详细的功能说明

- **文档整合**
  - 整合 archive 文档到主文档
  - 建立清晰的文档体系

---

## [v0.7] - 2025-11-25

### ✨ 新增功能
- **FixGhost 模块**
  - 修复玩家假人问题
  - 使用 Folia Entity Scheduler
  - 完整的权限控制

- **Speed 模块优化**
  - 智能速度设置
  - Tab 补全支持
  - 更好的用户体验

### 🔧 优化改进
- **Visitor 访客模式优化**
  - 简化逻辑，移除访客权限依赖
  - 直接通过白名单状态判断
  - 优化性能和权限同步

- **PermissionChecker 优化**
  - 简化权限检查逻辑
  - 移除不必要的延迟
  - 提升响应速度

- **ConfigUpdateManager 优化**
  - 改进配置合并逻辑
  - 更好的注释保留
  - 智能类型转换

---

## [v0.6] - 2025-11-24

### ✨ 核心系统建立
- **配置版本控制系统**
  - `ConfigUpdateManager` 实现
  - 自动检测和更新配置
  - 保留用户自定义设置

- **统一命令分发系统**
  - `TSLCommand` 命令分发器
  - 模块化命令注册
  - 统一的 Tab 补全

- **重载系统**
  - `ReloadCommand` 统一重载
  - 所有模块配置热重载
  - 不需要重启服务器

### 📦 功能模块
- Alias（命令别名）
- Maintenance（维护模式）
- Scale（体型调整）
- Hat（帽子系统）
- Ping（延迟查询）
- Toss（生物举起）
- Ride（生物骑乘）
- BabyLock（幼年锁定）
- Kiss（玩家亲吻）
- Freeze（玩家冻结）
- BlockStats（方块统计）
- ChatBubble（聊天气泡）
- Visitor（访客模式）
- FarmProtect（农田保护）
- AdvancementMessage（成就消息过滤）

---

## 功能特性总览

### 管理工具
- ✅ 维护模式（Maintenance）
- ✅ 访客模式（Visitor）
- ✅ 命令别名（Alias）

### 玩家互动
- ✅ Kiss（亲吻）
- ✅ Freeze（冻结）
- ✅ 聊天气泡（ChatBubble）
- ✅ 延迟查询（Ping）

### 生物互动
- ✅ Toss（举起投掷）
- ✅ Ride（骑乘）
- ✅ 幼年锁定（BabyLock）

### 保护功能
- ✅ 农田保护（FarmProtect）
- ✅ 成就消息过滤

### 系统增强
- ✅ 体型调整（Scale）
- ✅ 帽子系统（Hat）
- ✅ 方块统计（BlockStats）
- ✅ 速度设置（Speed）
- ✅ 假人修复（FixGhost）

---

## 技术改进

### 性能优化
- ✅ 配置缓存模式（减少 90% I/O）
- ✅ 内存缓存策略（玩家数据）
- ✅ 延迟保存机制（批量写入）
- ✅ ChatBubble 优化（减少 95% 任务）

### 线程安全
- ✅ Folia 完全兼容
- ✅ 实体调度器正确使用
- ✅ 并发集合使用
- ✅ 防御性编程

### 代码质量
- ✅ 模块化架构
- ✅ 统一接口设计
- ✅ 详细代码注释
- ✅ 完整异常处理

### 可维护性
- ✅ 配置版本控制
- ✅ 自动配置更新
- ✅ YAML 数据存储
- ✅ 自动数据迁移

---

## 兼容性

### 服务端
- ✅ Folia 1.21.8 (Luminol)
- ✅ Paper 1.21.8
- ⚠️ Bukkit/Spigot（不推荐，部分功能不可用）

### 依赖
- ✅ PlaceholderAPI（可选）
- ✅ LuckPerms（推荐，访客模式需要）

### Java 版本
- ✅ Java 21

---

## 已知问题

### 当前版本
- 无已知问题

### 历史问题（已修复）
- ~~ChatBubble 跨线程错误~~ - v0.9 修复
- ~~Visitor 权限同步延迟~~ - v0.7 修复
- ~~配置更新丢失用户设置~~ - v0.6 修复

---

## 迁移指南

### 从 PDC 到 YAML（自动）
玩家首次加入时自动迁移，无需手动操作：
1. 插件检测玩家是否已迁移
2. 如果未迁移，读取 PDC 数据
3. 写入到 `playerdata/<uuid>.yml`
4. 删除 PDC 数据
5. 标记已迁移

### 配置文件更新（自动）
配置文件更新时自动合并：
1. 检测配置版本号
2. 如果版本较旧，触发更新
3. 合并新配置项
4. 保留用户自定义设置
5. 更新版本号

---

## 下载和反馈

### 下载
- **最新版本**: v1.0
- **发布日期**: 2025-11-30
- **文件**: `TSLplugins-1.0.jar`

### 反馈渠道
- GitHub Issues（如有）
- 服务器管理员直接反馈

---

**维护状态**: 活跃开发中  
**更新频率**: 根据需求更新  
**技术支持**: 完整的文档支持

