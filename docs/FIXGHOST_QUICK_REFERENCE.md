# FixGhost 模块 - 快速参考

## 🎮 玩家使用

### 基本命令
```bash
/tsl fixghost           # 清理附近 5 格范围的幽灵方块
/tsl fixghost 3         # 清理附近 3 格范围的幽灵方块
/tsl fixghost 5         # 清理附近 5 格范围的幽灵方块（最大）
```

### 权限
- **权限节点**: `tsl.fixghost.use`
- **默认**: `true`（所有玩家）

---

## ⚙️ 管理员配置

### config.yml
```yaml
fixghost:
  enabled: true              # 是否启用功能
  default-radius: 5          # 默认扫描半径
  max-radius: 5              # 最大扫描半径（防止滥用）
  cooldown: 5.0              # 冷却时间（秒）
  messages:
    prefix: "&e[FixGhost]&r "
    disabled: "%prefix%&c幽灵方块清理功能已禁用"
    no-permission: "%prefix%&c你没有权限使用此命令"
    console-only: "%prefix%&c此命令只能由玩家执行"
    cooldown: "%prefix%&c请等待 &e%cooldown% &c秒后再使用"
    success: "%prefix%&a已清理你附近 &e%radius% &a格范围内的 &e%count% &a个幽灵方块"
```

### 重载配置
```bash
/tsl reload
```

---

## 🔧 常见问题

### Q: 什么是幽灵方块？
A: 幽灵方块通常是 `moving_piston`（移动活塞），由于服务器卡顿或其他原因导致活塞动画未正确结束而残留的"空气"方块，玩家可以穿过但无法放置方块。

### Q: 为什么清理数量是 0？
A: 可能原因：
- 附近确实没有幽灵方块
- 幽灵方块在未加载的区块中（插件不会强制加载）
- 半径设置太小

### Q: 可以增大扫描半径吗？
A: 可以，修改 `config.yml` 中的 `max-radius` 值，但不建议设置过大（影响性能）。

### Q: 冷却时间可以关闭吗？
A: 可以，设置 `cooldown: 0` 即可禁用冷却。

### Q: 支持 Folia 吗？
A: 完全支持！模块使用 Entity Scheduler 确保线程安全。

---

## 📊 技术细节

### 扫描范围
- 以玩家为中心的立方体
- 公式: `[-r, r] x [-r, r] x [-r, r]`
- 例如半径 5: 扫描 11 x 11 x 11 = 1331 个方块位置

### 清理目标
- 方块类型: `minecraft:moving_piston`
- 替换为: `minecraft:air`

### 安全机制
- 仅在已加载区块中操作
- 使用 Folia Entity Scheduler（线程安全）
- 限制最大半径（防止滥用）
- 冷却机制（防止频繁调用）

---

## 🎯 使用场景

1. **红石机器故障** - 活塞推拉后卡住
2. **服务器卡顿** - TPS 低导致活塞动画未完成
3. **区块重载** - 玩家快速移动导致区块卸载
4. **插件冲突** - 某些保护插件可能导致活塞问题

---

## 💡 最佳实践

### 给玩家
- 遇到幽灵方块时先退出重进（可能自动修复）
- 如果重进无效，使用 `/tsl fixghost`
- 注意冷却时间，避免频繁使用

### 给管理员
- 定期检查玩家反馈，调整半径和冷却时间
- 考虑服务器性能，不建议 `max-radius` 超过 10
- 可以设置不同权限组不同的半径上限（需修改代码）

---

## 📝 版本信息

- **添加版本**: TSLplugins 1.0
- **配置版本**: 14
- **支持服务端**: Folia/Luminol 1.21.8+
- **最低 Java**: 21

---

## 🆘 支持

如遇问题，请检查：
1. 配置文件是否正确
2. 权限是否已授予
3. 服务器日志中的错误信息
4. Folia 版本是否兼容

