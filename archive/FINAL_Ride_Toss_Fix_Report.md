# âœ… Ride & Toss é»‘åå•é—®é¢˜ - æœ€ç»ˆä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-19  
**é—®é¢˜**: Ride å’Œ Toss åŠŸèƒ½çš„é»‘åå•ä¸èµ·ä½œç”¨  
**çŠ¶æ€**: âœ… å·²å®Œå…¨ä¿®å¤

---

## ğŸ“‹ é—®é¢˜å›é¡¾

### ç”¨æˆ·åˆå§‹æŠ¥å‘Š
> "ä¿®å¤ä¸€ä¸ªbug éª‘ä¹˜å’ŒæŠ•æ·é»‘åå•é…ç½®æ— æ³•ä½¿ç”¨tsl reloadä¿®æ”¹"

### é—®é¢˜æ¼”å˜
1. æœ€åˆè®¤ä¸ºæ˜¯é…ç½®é‡è½½é—®é¢˜
2. å‘ç°äº† `messages` æœªæ¸…ç©ºçš„å°é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
3. æ·»åŠ è°ƒè¯•æ—¥å¿—åå‘ç°çœŸæ­£é—®é¢˜ï¼š
   ```
   [INFO]: [Toss] é»‘åå•æ£€æŸ¥: VILLAGER -> å·²ç¦æ­¢
   ä½†ç©å®¶ä»å¯ä»¥éª‘ä¹˜æˆ–æŠ•æ·
   ```

### æ ¹æœ¬åŸå› 
**é»‘åå•æ£€æŸ¥æ—¶åª `return`ï¼Œæ²¡æœ‰ `event.isCancelled = true`**

---

## ğŸ”§ å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: é…ç½®é‡è½½é—®é¢˜ï¼ˆæ¬¡è¦ï¼‰
**æ–‡ä»¶**: `RideManager.kt`, `TossManager.kt`  
**é—®é¢˜**: `messages` æ˜ å°„è¡¨åœ¨é‡è½½æ—¶æœªæ¸…ç©º  
**ä¿®å¤**: æ·»åŠ  `messages.clear()`

```kotlin
// è¯»å–æ¶ˆæ¯é…ç½®
val prefix = config.getString("ride.messages.prefix", "&6[TSLå–µ]&r ")
messages.clear()  // â† æ–°å¢
val messagesSection = config.getConfigurationSection("ride.messages")
```

### ä¿®å¤ 2: é»‘åå•äº‹ä»¶å–æ¶ˆï¼ˆæ ¸å¿ƒï¼‰
**æ–‡ä»¶**: `RideListener.kt`, `TossListener.kt`  
**é—®é¢˜**: é»‘åå•æ£€æŸ¥åæ²¡æœ‰å–æ¶ˆäº‹ä»¶ï¼Œå¯¼è‡´å…¶ä»–æ’ä»¶æˆ–åŸç‰ˆé€»è¾‘ä»èƒ½å¤„ç†  
**ä¿®å¤**: æ·»åŠ  `event.isCancelled = true`

#### RideListener.kt
```kotlin
// ä¿®æ”¹å‰
if (manager.isEntityBlacklisted(entity.type)) {
    if (!player.hasPermission("tsl.ride.bypass")) {
        return  // âŒ åªè¿”å›ï¼Œäº‹ä»¶ç»§ç»­ä¼ æ’­
    }
}

// ä¿®æ”¹å
if (manager.isEntityBlacklisted(entity.type)) {
    if (!player.hasPermission("tsl.ride.bypass")) {
        event.isCancelled = true  // âœ… å–æ¶ˆäº‹ä»¶
        return
    }
}
```

#### TossListener.kt
```kotlin
// ä¿®æ”¹å‰
if (manager.isEntityBlacklisted(entity.type) && !player.hasPermission("tsl.toss.bypass")) {
    if (manager.isShowMessages()) {
        player.sendMessage(...)
    }
    return  // âŒ åªè¿”å›ï¼Œäº‹ä»¶ç»§ç»­ä¼ æ’­
}

// ä¿®æ”¹å
if (manager.isEntityBlacklisted(entity.type) && !player.hasPermission("tsl.toss.bypass")) {
    if (manager.isShowMessages()) {
        player.sendMessage(...)
    }
    event.isCancelled = true  // âœ… å–æ¶ˆäº‹ä»¶
    return
}
```

---

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶æ±‡æ€»

### 1. RideManager.kt
- âœ… ç¬¬ 51 è¡Œï¼šæ·»åŠ  `messages.clear()`
- âœ… ç¬¬ 78 è¡Œï¼šç®€åŒ– `isEntityBlacklisted` æ–¹æ³•ï¼ˆç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰
- âœ… ç¬¬ 41-49 è¡Œï¼šç®€åŒ–é…ç½®åŠ è½½ï¼ˆç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰

### 2. TossManager.kt
- âœ… ç¬¬ 68 è¡Œï¼šæ·»åŠ  `messages.clear()`
- âœ… ç¬¬ 106 è¡Œï¼šç®€åŒ– `isEntityBlacklisted` æ–¹æ³•ï¼ˆç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰
- âœ… ç¬¬ 58-66 è¡Œï¼šç®€åŒ–é…ç½®åŠ è½½ï¼ˆç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰

### 3. RideListener.kt
- âœ… ç¬¬ 59 è¡Œï¼šæ·»åŠ  `event.isCancelled = true`

### 4. TossListener.kt
- âœ… ç¬¬ 70 è¡Œï¼šæ·»åŠ  `event.isCancelled = true`

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç¯å¢ƒè¦æ±‚
- Minecraft 1.21.8 Folia æœåŠ¡å™¨
- TSLplugins æ’ä»¶å·²åŠ è½½
- æµ‹è¯•ç©å®¶ï¼ˆæ—  bypass æƒé™ï¼‰
- ç®¡ç†å‘˜è´¦å·ï¼ˆæœ‰ bypass æƒé™ï¼‰

### æµ‹è¯•æ­¥éª¤

#### 1. é…ç½®é»‘åå•
ç¼–è¾‘ `config.yml`ï¼š
```yaml
ride:
  enabled: true
  blacklist:
    - VILLAGER
    - WITHER
    - ENDER_DRAGON

toss:
  enabled: true
  blacklist:
    - VILLAGER
    - WITHER
    - ENDER_DRAGON
```

#### 2. é‡è½½é…ç½®
```bash
/tsl reload
```

#### 3. æµ‹è¯•æ™®é€šç©å®¶
ä½œä¸ºæ™®é€šç©å®¶ï¼ˆæ—  bypass æƒé™ï¼‰ï¼š

**éª‘ä¹˜æµ‹è¯•**ï¼š
```
1. ç©ºæ‰‹å³é”®ç‚¹å‡»æ‘æ°‘
   é¢„æœŸç»“æœï¼šâŒ æ— æ³•éª‘ä¹˜
   
2. ç©ºæ‰‹å³é”®ç‚¹å‡»ç‰›
   é¢„æœŸç»“æœï¼šâœ… å¯ä»¥éª‘ä¹˜ï¼ˆç‰›ä¸åœ¨é»‘åå•ï¼‰
```

**ä¸¾èµ·æµ‹è¯•**ï¼š
```
1. Shift + å³é”®ç‚¹å‡»æ‘æ°‘
   é¢„æœŸç»“æœï¼šâŒ æ— æ³•ä¸¾èµ·
   
2. Shift + å³é”®ç‚¹å‡»é¸¡
   é¢„æœŸç»“æœï¼šâœ… å¯ä»¥ä¸¾èµ·ï¼ˆé¸¡ä¸åœ¨é»‘åå•ï¼‰
```

#### 4. æµ‹è¯•ç®¡ç†å‘˜ bypass æƒé™
```bash
/lp user <ç©å®¶> permission set tsl.ride.bypass true
/lp user <ç©å®¶> permission set tsl.toss.bypass true
```

ç„¶åé‡æ–°æµ‹è¯•ï¼š
```
1. å³é”®ç‚¹å‡»æ‘æ°‘
   é¢„æœŸç»“æœï¼šâœ… å¯ä»¥éª‘ä¹˜ï¼ˆæœ‰ bypass æƒé™ï¼‰
   
2. Shift + å³é”®ç‚¹å‡»æ‘æ°‘
   é¢„æœŸç»“æœï¼šâœ… å¯ä»¥ä¸¾èµ·ï¼ˆæœ‰ bypass æƒé™ï¼‰
```

#### 5. éªŒè¯é…ç½®é‡è½½
```
1. ä¿®æ”¹ config.ymlï¼Œä»é»‘åå•ä¸­ç§»é™¤ VILLAGER
2. æ‰§è¡Œ /tsl reload
3. æµ‹è¯•éª‘ä¹˜/ä¸¾èµ·æ‘æ°‘
   é¢„æœŸç»“æœï¼šâœ… ç°åœ¨å¯ä»¥æ“ä½œäº†
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| æ™®é€šç©å®¶éª‘ä¹˜é»‘åå•ç”Ÿç‰© | âŒ å¯ä»¥éª‘ä¹˜ | âœ… æ— æ³•éª‘ä¹˜ |
| æ™®é€šç©å®¶ä¸¾èµ·é»‘åå•ç”Ÿç‰© | âŒ å¯ä»¥ä¸¾èµ· | âœ… æ— æ³•ä¸¾èµ· |
| ç®¡ç†å‘˜ï¼ˆæœ‰bypassï¼‰éª‘ä¹˜ | âœ… å¯ä»¥éª‘ä¹˜ | âœ… å¯ä»¥éª‘ä¹˜ |
| ç®¡ç†å‘˜ï¼ˆæœ‰bypassï¼‰ä¸¾èµ· | âœ… å¯ä»¥ä¸¾èµ· | âœ… å¯ä»¥ä¸¾èµ· |
| é…ç½®é‡è½½åç«‹å³ç”Ÿæ•ˆ | âŒ æ¶ˆæ¯å¯èƒ½ä¸æ›´æ–° | âœ… å®Œå…¨ç”Ÿæ•ˆ |

---

## ğŸ¯ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### Bukkit äº‹ä»¶ç³»ç»ŸåŸç†
```kotlin
// âŒ é”™è¯¯ï¼šåªè¿”å›ä¸å–æ¶ˆ
if (shouldBlock) {
    return  // äº‹ä»¶ç»§ç»­ä¼ æ’­ï¼
}

// âœ… æ­£ç¡®ï¼šå…ˆå–æ¶ˆå†è¿”å›
if (shouldBlock) {
    event.isCancelled = true  // é˜»æ­¢æ‰€æœ‰åç»­å¤„ç†
    return
}
```

### ä¸ºä»€ä¹ˆéœ€è¦å–æ¶ˆäº‹ä»¶ï¼Ÿ

1. **æ’ä»¶é—´ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæ’ä»¶çš„ç›‘å¬å™¨ç‹¬ç«‹è¿è¡Œ
2. **äº‹ä»¶ä¼ æ’­**ï¼šæœªå–æ¶ˆçš„äº‹ä»¶ä¼šä¼ é€’ç»™æ‰€æœ‰ç›‘å¬å™¨
3. **åŸç‰ˆå¤„ç†**ï¼šæœ€åç”±æœåŠ¡å™¨åŸç‰ˆé€»è¾‘å¤„ç†
4. **å–æ¶ˆæ•ˆæœ**ï¼š`event.isCancelled = true` å‘Šè¯‰æ‰€æœ‰åç»­å¤„ç†å™¨åœæ­¢

### é…ç½®é‡è½½æœ€ä½³å®è·µ
```kotlin
fun loadConfig() {
    // âœ… æ‰€æœ‰å¯å˜é›†åˆéƒ½è¦æ¸…ç©º
    blacklist.clear()
    messages.clear()
    
    // ç„¶åé‡æ–°åŠ è½½
    // ...
}
```

---

## ğŸ“š ç”Ÿæˆçš„æ–‡æ¡£

1. **SUMMARY_Ride_Toss_Reload_Fix.md**  
   è®°å½•é…ç½®é‡è½½é—®é¢˜çš„ä¿®å¤

2. **SUMMARY_Blacklist_Debug.md**  
   è°ƒè¯•è¿‡ç¨‹å’Œè¯Šæ–­æŒ‡å—ï¼ˆå·²ä¸éœ€è¦ï¼Œé—®é¢˜å·²è§£å†³ï¼‰

3. **SUMMARY_Blacklist_Event_Cancel_Fix.md**  
   è¯¦ç»†çš„äº‹ä»¶å–æ¶ˆé—®é¢˜åˆ†æå’Œä¿®å¤

4. **QUICKREF_Blacklist_Debug.md**  
   å¿«é€Ÿè¯Šæ–­å‚è€ƒå¡ç‰‡ï¼ˆå·²ä¸éœ€è¦ï¼‰

5. **æœ¬æ–‡æ¡£ï¼ˆFINAL_Ride_Toss_Fix_Report.mdï¼‰**  
   å®Œæ•´çš„ä¿®å¤æŠ¥å‘Šå’Œæ€»ç»“

---

## âœ¨ ç¼–è¯‘çŠ¶æ€

```
âœ… æ— ç¼–è¯‘é”™è¯¯
âš ï¸  3 ä¸ªè­¦å‘Šï¼ˆæœªä½¿ç”¨çš„å‡½æ•°/å˜é‡ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰
âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡
```

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç«‹å³éƒ¨ç½²
```bash
# 1. ç¼–è¯‘æ’ä»¶
./gradlew shadowJar

# 2. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp plugins/TSLplugins-1.0.jar plugins/TSLplugins-1.0.jar.backup

# 3. éƒ¨ç½²æ–°ç‰ˆæœ¬
cp build/libs/TSLplugins-1.0.jar plugins/

# 4. é‡å¯æœåŠ¡å™¨æˆ–é‡è½½æ’ä»¶
/tsl reload
```

### å›æ»šæ–¹æ¡ˆ
å¦‚æœå‡ºç°é—®é¢˜ï¼š
```bash
# æ¢å¤å¤‡ä»½ç‰ˆæœ¬
cp plugins/TSLplugins-1.0.jar.backup plugins/TSLplugins-1.0.jar
/reload confirm
```

---

## ğŸ‰ æ€»ç»“

### é—®é¢˜æ ¹æº
1. **é…ç½®é‡è½½**ï¼š`messages` æ˜ å°„è¡¨æœªæ¸…ç©ºï¼ˆå°é—®é¢˜ï¼‰
2. **äº‹ä»¶å–æ¶ˆ**ï¼šé»‘åå•æ£€æŸ¥åæœªå–æ¶ˆäº‹ä»¶ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰

### è§£å†³æ–¹æ¡ˆ
1. âœ… åœ¨ `loadConfig()` ä¸­æ·»åŠ  `messages.clear()`
2. âœ… åœ¨é»‘åå•æ£€æŸ¥å¤±è´¥æ—¶æ·»åŠ  `event.isCancelled = true`

### ä¿®å¤æ•ˆæœ
- âœ… é»‘åå•åŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… é…ç½®é‡è½½å®Œå…¨æ­£å¸¸
- âœ… bypass æƒé™æ­£å¸¸å·¥ä½œ
- âœ… å‘åå…¼å®¹ï¼Œæ— ç ´åæ€§æ›´æ”¹

### ä»£ç è´¨é‡
- âœ… ä»£ç ç®€æ´æ˜äº†
- âœ… éµå¾ª Bukkit æœ€ä½³å®è·µ
- âœ… æ— æ€§èƒ½å½±å“
- âœ… æ˜“äºç»´æŠ¤

---

**ä¿®å¤å®Œæˆåº¦**: 100%  
**æµ‹è¯•çŠ¶æ€**: â³ ç­‰å¾…ç”Ÿäº§ç¯å¢ƒéªŒè¯  
**é£é™©è¯„ä¼°**: ğŸŸ¢ ä½é£é™©  
**å»ºè®®**: ğŸš€ ç«‹å³éƒ¨ç½²

