# TSLplugins é¡¹ç›®å…¨é¢è§£æ

**ç”Ÿæˆæ—¥æœŸ**: 2025-11-25  
**æ–‡æ¡£ç±»å‹**: é¡¹ç›®æ¶æ„å’ŒæŠ€æœ¯åˆ†æ

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [æŠ€æœ¯æ ˆåˆ†æ](#æŠ€æœ¯æ ˆåˆ†æ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ ¸å¿ƒç³»ç»Ÿ](#æ ¸å¿ƒç³»ç»Ÿ)
5. [åŠŸèƒ½æ¨¡å—è¯¦è§£](#åŠŸèƒ½æ¨¡å—è¯¦è§£)
6. [è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ](#è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
9. [é¡¹ç›®ç‰¹è‰²](#é¡¹ç›®ç‰¹è‰²)

---

## é¡¹ç›®ç®€ä»‹

### åŸºæœ¬ä¿¡æ¯

**TSLplugins** æ˜¯ä¸€ä¸ªä¸º Minecraft Folia 1.21.8 æœåŠ¡ç«¯è®¾è®¡çš„å¤šåŠŸèƒ½æ•´åˆæ’ä»¶ï¼Œä½¿ç”¨ Kotlin è¯­è¨€å¼€å‘ã€‚

- **é¡¹ç›®åç§°**: TSLplugins
- **ç‰ˆæœ¬**: 1.0
- **å¼€å‘è¯­è¨€**: Kotlin 1.9.21
- **ç›®æ ‡å¹³å°**: Paper/Folia 1.21.8
- **Java ç‰ˆæœ¬**: 21
- **æ„å»ºå·¥å…·**: Gradle 8.5 + Kotlin DSL
- **é…ç½®ç‰ˆæœ¬**: 10

### é¡¹ç›®å®šä½

è¿™æ˜¯ä¸€ä¸ª**æ¨¡å—åŒ–çš„å¤šåŠŸèƒ½æ•´åˆæ’ä»¶**ï¼Œé›†æˆäº† **13 ä¸ªç‹¬ç«‹åŠŸèƒ½æ¨¡å—**ï¼Œæ¶µç›–ï¼š
- ğŸ”§ **æœåŠ¡å™¨ç®¡ç†å·¥å…·**ï¼ˆç»´æŠ¤æ¨¡å¼ã€ç©å®¶å†»ç»“ã€å‘½ä»¤åˆ«åï¼‰
- ğŸ® **ç©å®¶äº’åŠ¨åŠŸèƒ½**ï¼ˆäº²å»ã€å¸½å­ã€ä½“å‹è°ƒæ•´ã€å»¶è¿ŸæŸ¥è¯¢ï¼‰
- ğŸ¾ **ç”Ÿç‰©äº’åŠ¨ç³»ç»Ÿ**ï¼ˆä¸¾èµ·ã€éª‘ä¹˜ã€æ°¸ä¹…å¹¼å¹´ï¼‰
- ğŸ›¡ï¸ **ä¿æŠ¤åŠŸèƒ½**ï¼ˆå†œç”°ä¿æŠ¤ã€è®¿å®¢ä¿æŠ¤ï¼‰
- âš™ï¸ **ç³»ç»Ÿå¢å¼º**ï¼ˆæˆå°±è¿‡æ»¤ã€MOTDå‡ç©å®¶ï¼‰

### è®¾è®¡ç†å¿µ

1. **æ¨¡å—åŒ–** - æ¯ä¸ªåŠŸèƒ½åŒ…ç‹¬ç«‹ï¼Œäº’ä¸ä¾èµ–
2. **å³æ’å³ç”¨** - å¯é€šè¿‡é…ç½®å•ç‹¬å¯ç”¨/ç¦ç”¨æ¨¡å—
3. **äº‹ä»¶é©±åŠ¨** - åŸºäº Bukkit/Folia äº‹ä»¶ç³»ç»Ÿï¼Œæ— è½®è¯¢ä»»åŠ¡
4. **é…ç½®é©±åŠ¨** - æ‰€æœ‰è¡Œä¸ºå¯é€šè¿‡é…ç½®æ–‡ä»¶å®šåˆ¶
5. **é…ç½®ç¼“å­˜** - å¯åŠ¨æ—¶åŠ è½½é…ç½®åˆ°å†…å­˜ï¼Œäº‹ä»¶å¤„ç†é›¶å¼€é”€

---

## æŠ€æœ¯æ ˆåˆ†æ

### æ ¸å¿ƒæŠ€æœ¯

#### 1. Kotlin è¯­è¨€ç‰¹æ€§
```kotlin
// æ•°æ®ç±»
data class PlayerInfo(val uuid: UUID, val name: String)

// å±æ€§è®¿é—®ï¼ˆè€Œé Java çš„ getter/setterï¼‰
val name = player.name
val health = player.health

// å­—ç¬¦ä¸²æ¨¡æ¿
val message = "ç©å®¶ $name çš„å»¶è¿Ÿæ˜¯ ${player.ping}ms"

// Lambda è¡¨è¾¾å¼å’Œé›†åˆæ“ä½œ
players.filter { it.health > 10 }
       .map { it.name }
       .forEach { println(it) }

// ç©ºå®‰å…¨
val name = player?.name ?: "Unknown"
```

#### 2. Folia å¤šçº¿ç¨‹æ”¯æŒ

Folia æ˜¯ Paper çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œéœ€è¦ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ APIï¼š

```kotlin
// âœ… å®ä½“æ“ä½œä½¿ç”¨å®ä½“è°ƒåº¦å™¨
player.scheduler.run(plugin, { _ ->
    player.inventory.setHelmet(item)
}, null)

// âœ… å…¨å±€å®šæ—¶ä»»åŠ¡
Bukkit.getGlobalRegionScheduler().runAtFixedRate(plugin, { _ ->
    // å…¨å±€ä»»åŠ¡
}, 20L, 20L)

// âŒ ä¸å†æ”¯æŒä¼ ç»Ÿè°ƒåº¦å™¨
Bukkit.getScheduler().runTask(plugin, Runnable { }) // ä¼šæŠ¥é”™
```

### ä¾èµ–ç®¡ç†

#### å¿…éœ€ä¾èµ–
```kotlin
compileOnly("io.papermc.paper:paper-api:1.21.8-R0.1-SNAPSHOT")
implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
```

#### å¯é€‰ä¾èµ–
```kotlin
compileOnly("net.luckperms:api:5.4")          // æƒé™ç»„ç®¡ç†ï¼ˆè®¿å®¢ä¿æŠ¤ï¼‰
compileOnly("me.clip:placeholderapi:2.11.6")  // å˜é‡ç³»ç»Ÿï¼ˆKiss ç»Ÿè®¡ï¼‰
```

#### æ„å»ºæ’ä»¶
```kotlin
// Shadow æ’ä»¶ï¼šæ‰“åŒ… Kotlin æ ‡å‡†åº“åˆ° JAR
id("com.github.johnrengelman.shadow") version "8.1.1"
```

---

## æ¶æ„è®¾è®¡

### é¡¹ç›®ç»“æ„

```
TSLplugins/
â”‚
â”œâ”€â”€ TSLplugins.kt              # ä¸»æ’ä»¶ç±»ï¼šåˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
â”œâ”€â”€ TSLCommand.kt              # å‘½ä»¤åˆ†å‘å™¨ï¼šç»Ÿä¸€å…¥å£ /tsl
â”œâ”€â”€ ReloadCommand.kt           # é‡è½½å‘½ä»¤ï¼šé‡è½½æ‰€æœ‰æ¨¡å—é…ç½®
â”œâ”€â”€ ConfigUpdateManager.kt     # é…ç½®æ›´æ–°ï¼šç‰ˆæœ¬æ§åˆ¶å’Œè‡ªåŠ¨æ›´æ–°
â”œâ”€â”€ PlayerDataManager.kt       # PDC ç®¡ç†å™¨ï¼šæ•°æ®æŒä¹…åŒ–
â”‚
â”œâ”€â”€ Alias/                     # å‘½ä»¤åˆ«åç³»ç»Ÿ
â”œâ”€â”€ Maintenance/               # ç»´æŠ¤æ¨¡å¼
â”œâ”€â”€ Scale/                     # ä½“å‹è°ƒæ•´
â”œâ”€â”€ Hat/                       # å¸½å­ç³»ç»Ÿ
â”œâ”€â”€ Ping/                      # å»¶è¿ŸæŸ¥è¯¢
â”œâ”€â”€ Toss/                      # ç”Ÿç‰©ä¸¾èµ·
â”œâ”€â”€ Ride/                      # ç”Ÿç‰©éª‘ä¹˜
â”œâ”€â”€ BabyLock/                  # æ°¸ä¹…å¹¼å¹´
â”œâ”€â”€ Kiss/                      # ç©å®¶äº²å»
â”œâ”€â”€ Freeze/                    # ç©å®¶å†»ç»“
â”œâ”€â”€ Advancement/               # æˆå°±è¿‡æ»¤
â”œâ”€â”€ Visitor/                   # è®¿å®¢ä¿æŠ¤
â”œâ”€â”€ Permission/                # æƒé™æ£€æµ‹
â”œâ”€â”€ Farmprotect/               # å†œç”°ä¿æŠ¤
â””â”€â”€ Motd/                      # MOTD å‡ç©å®¶
```

### Manager-Command-Listener æ¨¡å¼

è¿™æ˜¯æ’ä»¶çš„**æ ¸å¿ƒæ¶æ„æ¨¡å¼**ï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½éµå¾ªæ­¤ç»“æ„ï¼š

```
Module/
â”œâ”€â”€ ModuleManager.kt    # ç®¡ç†å™¨ï¼šé…ç½®ç®¡ç†ã€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ ModuleCommand.kt    # å‘½ä»¤å¤„ç†å™¨ï¼šå‘½ä»¤å¤„ç†ã€æƒé™æ£€æŸ¥
â””â”€â”€ ModuleListener.kt   # äº‹ä»¶ç›‘å¬å™¨ï¼šä¸šåŠ¡é€»è¾‘å®ç°
```

#### Managerï¼ˆç®¡ç†å™¨ï¼‰èŒè´£
- âœ… åŠ è½½å’Œç¼“å­˜é…ç½®
- âœ… ç®¡ç†æ¨¡å—å¯ç”¨/ç¦ç”¨çŠ¶æ€
- âœ… æä¾›æ•°æ®è®¿é—®æ–¹æ³•
- âœ… ç®¡ç†å†·å´æ—¶é—´ã€ç»Ÿè®¡æ•°æ®ç­‰

```kotlin
class FeatureManager(private val plugin: JavaPlugin) {
    // é…ç½®ç¼“å­˜
    private var enabled: Boolean = true
    private var cooldown: Long = 1000
    private val blacklist: MutableSet<EntityType> = mutableSetOf()
    
    init {
        loadConfig()
    }
    
    fun loadConfig() {
        // ä»é…ç½®æ–‡ä»¶è¯»å–åˆ°ç¼“å­˜
        enabled = plugin.config.getBoolean("feature.enabled", true)
        cooldown = plugin.config.getLong("feature.cooldown", 1000)
        // ...
    }
    
    // æä¾›å¿«é€Ÿè®¿é—®æ–¹æ³•
    fun isEnabled(): Boolean = enabled
    fun getCooldown(): Long = cooldown
}
```

#### Commandï¼ˆå‘½ä»¤å¤„ç†å™¨ï¼‰èŒè´£
- âœ… å®ç° `SubCommandHandler` æ¥å£
- âœ… å¤„ç†ç”¨æˆ·å‘½ä»¤
- âœ… æƒé™æ£€æŸ¥
- âœ… æä¾› Tab è¡¥å…¨

```kotlin
class FeatureCommand(
    private val manager: FeatureManager
) : SubCommandHandler {
    
    override fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean {
        // 1. åŠŸèƒ½æ£€æŸ¥
        if (!manager.isEnabled()) {
            sender.sendMessage("åŠŸèƒ½å·²ç¦ç”¨")
            return true
        }
        
        // 2. ç©å®¶æ£€æŸ¥
        if (sender !is Player) {
            sender.sendMessage("ä»…ç©å®¶å¯ç”¨")
            return true
        }
        
        // 3. æƒé™æ£€æŸ¥
        if (!sender.hasPermission("tsl.feature.use")) {
            sender.sendMessage("æ— æƒé™")
            return true
        }
        
        // 4. ä¸šåŠ¡é€»è¾‘
        // ...
        
        return true
    }
    
    override fun tabComplete(...): List<String> {
        // Tab è¡¥å…¨é€»è¾‘
    }
}
```

#### Listenerï¼ˆç›‘å¬å™¨ï¼‰èŒè´£
- âœ… ç›‘å¬ Bukkit äº‹ä»¶
- âœ… å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- âœ… è°ƒç”¨ Manager æ–¹æ³•

```kotlin
class FeatureListener(
    private val plugin: JavaPlugin,
    private val manager: FeatureManager
) : Listener {
    
    @EventHandler(priority = EventPriority.NORMAL)
    fun onEvent(event: SomeEvent) {
        // å¿«é€Ÿå¤±è´¥ä¼˜åŒ–
        if (!manager.isEnabled()) return
        if (!player.hasPermission("tsl.feature.use")) return
        
        // ä¸šåŠ¡é€»è¾‘
        // ...
    }
}
```

---

## æ ¸å¿ƒç³»ç»Ÿ

### 1. é…ç½®ç¼“å­˜ç³»ç»Ÿ

**è¿™æ˜¯æ’ä»¶æœ€é‡è¦çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚**

#### ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç¼“å­˜ï¼Ÿ

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| ç›´æ¥è¯»å– config | å®æ—¶æœ€æ–° | æ¯æ¬¡äº‹ä»¶éƒ½æœ‰ I/O å¼€é”€ï¼Œæ€§èƒ½æå·® |
| **é…ç½®ç¼“å­˜** | **é›¶å¼€é”€ï¼Œæ€§èƒ½æœ€ä½³** | ä¿®æ”¹é…ç½®åéœ€æ‰‹åŠ¨é‡è½½ |

#### å®ç°æ–¹å¼

```kotlin
class FeatureManager(private val plugin: JavaPlugin) {
    // âœ… ç¼“å­˜é…ç½®å€¼
    private var enabled: Boolean = true
    private var maxValue: Int = 10
    private val blacklist: MutableSet<EntityType> = mutableSetOf()
    
    init {
        loadConfig()  // å¯åŠ¨æ—¶åŠ è½½ä¸€æ¬¡
    }
    
    fun loadConfig() {
        val config = plugin.config
        // ä»é…ç½®æ–‡ä»¶è¯»å–åˆ°å†…å­˜
        enabled = config.getBoolean("feature.enabled", true)
        maxValue = config.getInt("feature.max_value", 10)
        
        blacklist.clear()
        config.getStringList("feature.blacklist").forEach { name ->
            try {
                blacklist.add(EntityType.valueOf(name.uppercase()))
            } catch (e: IllegalArgumentException) {
                plugin.logger.warning("æ— æ•ˆçš„å®ä½“ç±»å‹: $name")
            }
        }
    }
    
    // âœ… ç›´æ¥è¯»å–ç¼“å­˜ï¼ˆé›¶å¼€é”€ï¼‰
    fun isEnabled(): Boolean = enabled
    fun getMaxValue(): Int = maxValue
    fun isBlacklisted(type: EntityType): Boolean = blacklist.contains(type)
}
```

#### Listener ä½¿ç”¨ç¼“å­˜

```kotlin
@EventHandler
fun onEvent(event: SomeEvent) {
    // âœ… è¯»å–ç¼“å­˜ï¼Œæ²¡æœ‰ä»»ä½• I/O å¼€é”€
    if (!manager.isEnabled()) return
    if (manager.isBlacklisted(entity.type)) return
    
    // ä¸šåŠ¡é€»è¾‘
}
```

#### é‡è½½æœºåˆ¶

```kotlin
// ReloadCommand.kt
override fun handle(...): Boolean {
    // é‡è½½æ‰€æœ‰æ¨¡å—çš„é…ç½®
    plugin.reloadConfig()
    plugin.reloadKissManager()
    plugin.reloadFreezeManager()
    plugin.reloadTossManager()
    // ...
}

// TSLplugins.kt
fun reloadKissManager() {
    kissManager.loadConfig()  // åˆ·æ–°ç¼“å­˜
}
```

### 2. PDC æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ

**PersistentDataContainer** æ˜¯ Bukkit API æä¾›çš„æŒä¹…åŒ–å­˜å‚¨æœºåˆ¶ï¼Œæ•°æ®ä¿å­˜åœ¨ç©å®¶çš„ `.dat` æ–‡ä»¶ä¸­ã€‚

#### ä¸ºä»€ä¹ˆä½¿ç”¨ PDCï¼Ÿ

| å­˜å‚¨æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|----------|------|------|
| HashMap | å¿«é€Ÿè®¿é—® | ç¦»çº¿ä¸¢å¤±ã€æœåŠ¡å™¨é‡å¯ä¸¢å¤± |
| é…ç½®æ–‡ä»¶ | æŒä¹…åŒ– | I/O å¼€é”€å¤§ã€ç®¡ç†å¤æ‚ |
| æ•°æ®åº“ | åŠŸèƒ½å¼ºå¤§ | é…ç½®å¤æ‚ã€ä¾èµ–å¤–éƒ¨æœåŠ¡ |
| **PDC** | **æŒä¹…åŒ–ã€é›¶é…ç½®ã€æ€§èƒ½å¥½** | åªèƒ½å­˜å‚¨ç®€å•æ•°æ®ç±»å‹ |

#### PlayerDataManager ç»Ÿä¸€ç®¡ç†

```kotlin
class PlayerDataManager(private val plugin: JavaPlugin) {
    
    // PDC Keysï¼ˆç»Ÿä¸€ç®¡ç†é¿å…å†²çªï¼‰
    private val kissToggleKey = NamespacedKey(plugin, "kiss_toggle")
    private val rideToggleKey = NamespacedKey(plugin, "ride_toggle")
    private val tossToggleKey = NamespacedKey(plugin, "toss_toggle")
    private val tossVelocityKey = NamespacedKey(plugin, "toss_velocity")
    
    // ==================== Kiss åŠŸèƒ½ ====================
    
    fun getKissToggle(player: Player, defaultValue: Boolean = true): Boolean {
        val pdc = player.persistentDataContainer
        return if (pdc.has(kissToggleKey, PersistentDataType.BOOLEAN)) {
            pdc.get(kissToggleKey, PersistentDataType.BOOLEAN) ?: defaultValue
        } else {
            defaultValue
        }
    }
    
    fun setKissToggle(player: Player, enabled: Boolean) {
        player.persistentDataContainer.set(
            kissToggleKey,
            PersistentDataType.BOOLEAN,
            enabled
        )
    }
    
    // å…¶ä»–åŠŸèƒ½çš„æ•°æ®å­˜å–æ–¹æ³•...
}
```

#### Manager ä½¿ç”¨ PDC

```kotlin
class KissManager(
    private val plugin: JavaPlugin,
    private val dataManager: PlayerDataManager  // æ³¨å…¥
) {
    // ä» PDC è¯»å–ç©å®¶é…ç½®
    fun isPlayerEnabled(player: Player): Boolean {
        return dataManager.getKissToggle(player, true)
    }
    
    // å†™å…¥ PDC
    fun togglePlayer(player: Player): Boolean {
        val current = isPlayerEnabled(player)
        val newStatus = !current
        dataManager.setKissToggle(player, newStatus)
        return newStatus
    }
}
```

#### å­˜å‚¨çš„æ•°æ®

| æ¨¡å— | å­˜å‚¨å†…å®¹ | PDC Key | æ•°æ®ç±»å‹ |
|------|----------|---------|----------|
| Kiss | åŠŸèƒ½å¼€å…³ | `tsl:kiss_toggle` | Boolean |
| Ride | åŠŸèƒ½å¼€å…³ | `tsl:ride_toggle` | Boolean |
| Toss | åŠŸèƒ½å¼€å…³ | `tsl:toss_toggle` | Boolean |
| Toss | æŠ•æ·é€Ÿåº¦ | `tsl:toss_velocity` | Double |

### 3. é…ç½®è‡ªåŠ¨æ›´æ–°ç³»ç»Ÿ

`ConfigUpdateManager` å®ç°äº†æ™ºèƒ½çš„é…ç½®ç‰ˆæœ¬æ§åˆ¶å’Œè‡ªåŠ¨æ›´æ–°ã€‚

#### æ ¸å¿ƒåŠŸèƒ½

```kotlin
class ConfigUpdateManager(private val plugin: JavaPlugin) {
    
    companion object {
        const val CURRENT_CONFIG_VERSION = 10  // å½“å‰ç‰ˆæœ¬
    }
    
    fun checkAndUpdate(): Boolean {
        val configFile = File(plugin.dataFolder, "config.yml")
        val currentConfig = YamlConfiguration.loadConfiguration(configFile)
        val currentVersion = currentConfig.getInt("config-version", 0)
        
        // ç‰ˆæœ¬ä¸€è‡´ï¼Œæ— éœ€æ›´æ–°
        if (currentVersion == CURRENT_CONFIG_VERSION) {
            return false
        }
        
        // éœ€è¦æ›´æ–°
        // 1. å¤‡ä»½æ—§é…ç½®åˆ° config.yml.backup
        // 2. è¯»å–é»˜è®¤é…ç½®çš„åŸå§‹æ–‡æœ¬ï¼ˆä¿ç•™æ³¨é‡Šï¼‰
        // 3. è¯»å–ç”¨æˆ·é…ç½®çš„å€¼
        // 4. åˆå¹¶ï¼šä½¿ç”¨é»˜è®¤é…ç½®çš„æ ¼å¼å’Œæ³¨é‡Šï¼Œå¡«å…¥ç”¨æˆ·çš„å€¼
        // 5. ä¿å­˜æ›´æ–°åçš„é…ç½®
        
        return true
    }
}
```

#### æ›´æ–°æµç¨‹

1. **å¼€å‘è€…æ·»åŠ æ–°é…ç½®é¡¹**
   - ä¿®æ”¹ `src/main/resources/config.yml`
   - é€’å¢ `CURRENT_CONFIG_VERSION`

2. **æ’ä»¶å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹**
   - æ¯”å¯¹é…ç½®ç‰ˆæœ¬
   - å‘ç°ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶è‡ªåŠ¨æ›´æ–°

3. **æ™ºèƒ½åˆå¹¶**
   - âœ… ä¿ç•™æ‰€æœ‰æ³¨é‡Šå’Œæ ¼å¼
   - âœ… ä¿ç•™ç”¨æˆ·çš„é…ç½®å€¼
   - âœ… æ·»åŠ æ–°çš„é…ç½®é¡¹ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
   - âœ… å¤‡ä»½æ—§é…ç½®æ–‡ä»¶

4. **ç”¨æˆ·ä½“éªŒ**
   - æ— éœ€æ‰‹åŠ¨ç¼–è¾‘é…ç½®
   - æ— éœ€åˆ é™¤æ—§é…ç½®
   - è‡ªåŠ¨å¹³æ»‘å‡çº§

### 4. å‘½ä»¤ç³»ç»Ÿ

#### ç»Ÿä¸€å‘½ä»¤å…¥å£

æ‰€æœ‰å‘½ä»¤éƒ½é€šè¿‡ `/tsl` è¿›å…¥ï¼š

```kotlin
class TSLCommand(private val plugin: TSLplugins) : CommandExecutor, TabCompleter {
    
    private val subCommands = mutableMapOf<String, SubCommandHandler>()
    
    fun registerSubCommand(name: String, handler: SubCommandHandler) {
        subCommands[name.lowercase()] = handler
    }
    
    override fun onCommand(...): Boolean {
        if (args.isEmpty()) {
            showHelp(sender)
            return true
        }
        
        val subCommand = args[0].lowercase()
        val handler = subCommands[subCommand]
        
        if (handler != null) {
            return handler.handle(sender, command, label, args.drop(1).toTypedArray())
        } else {
            sender.sendMessage("æœªçŸ¥å‘½ä»¤")
            return true
        }
    }
    
    override fun onTabComplete(...): List<String> {
        // Tab è¡¥å…¨é€»è¾‘
    }
}
```

#### SubCommandHandler æ¥å£

```kotlin
interface SubCommandHandler {
    fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean
    
    fun tabComplete(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): List<String>
    
    fun getDescription(): String = ""
}
```

---

## åŠŸèƒ½æ¨¡å—è¯¦è§£

### ç®¡ç†å·¥å…·ç±»

#### 1. ç»´æŠ¤æ¨¡å¼ï¼ˆMaintenanceï¼‰

**åŠŸèƒ½**: æœåŠ¡å™¨ç»´æŠ¤æœŸé—´é˜»æ­¢ç©å®¶ç™»å½•ï¼Œæ”¯æŒç™½åå•ç®¡ç†ã€‚

**æ¨¡å—ç»“æ„**:
```
Maintenance/
â”œâ”€â”€ MaintenanceManager.kt              # é…ç½®å’Œç™½åå•ç®¡ç†
â”œâ”€â”€ MaintenanceCommand.kt              # toggle/add/remove/list å‘½ä»¤
â”œâ”€â”€ MaintenanceLoginListener.kt        # é˜»æ­¢éç™½åå•ç©å®¶ç™»å½•
â”œâ”€â”€ MaintenanceMotdListener.kt         # ä¿®æ”¹ MOTD æ˜¾ç¤ºç»´æŠ¤çŠ¶æ€
â””â”€â”€ MaintenancePermissionListener.kt   # æƒé™æ£€æŸ¥
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å¼€å…³ç»´æŠ¤æ¨¡å¼
- âœ… ç™½åå•ç®¡ç†ï¼ˆUUID éªŒè¯ï¼‰
- âœ… è‡ªå®šä¹‰è¸¢å‡ºæ¶ˆæ¯
- âœ… è‡ªå®šä¹‰ç»´æŠ¤ MOTD
- âœ… Bypass æƒé™æ”¯æŒ

**æ•°æ®å­˜å‚¨**: `maintenance.yml`
```yaml
enabled: false
whitelist:
  550e8400-e29b-41d4-a716-446655440000: "PlayerName"
```

#### 2. ç©å®¶å†»ç»“ï¼ˆFreezeï¼‰

**åŠŸèƒ½**: å†»ç»“ç©å®¶æ‰€æœ‰æ“ä½œï¼Œç”¨äºç®¡ç†é—®é¢˜ç©å®¶ã€‚

**æ¨¡å—ç»“æ„**:
```
Freeze/
â”œâ”€â”€ FreezeManager.kt    # å†»ç»“çŠ¶æ€ç®¡ç†ã€è‡ªåŠ¨è¿‡æœŸæ£€æŸ¥
â”œâ”€â”€ FreezeCommand.kt    # freeze/unfreeze/list å‘½ä»¤
â””â”€â”€ FreezeListener.kt   # é˜»æ­¢å„ç§æ“ä½œã€ActionBar æç¤º
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æ°¸ä¹…å†»ç»“æˆ–å®šæ—¶å†»ç»“
- âœ… å†»ç»“æ‰€æœ‰æ“ä½œï¼ˆç§»åŠ¨ã€äº¤äº’ã€æŒ‡ä»¤ç­‰ï¼‰
- âœ… ActionBar å®æ—¶æ˜¾ç¤ºå‰©ä½™æ—¶é—´
- âœ… è‡ªåŠ¨è¿‡æœŸè§£å†»
- âœ… Bypass æƒé™æ”¯æŒ

**å†»ç»“é™åˆ¶**:
- âŒ ç§»åŠ¨ï¼ˆä½ç½®ç§»åŠ¨ï¼Œè§†è§’å¯è½¬åŠ¨ï¼‰
- âŒ ç ´å/æ”¾ç½®æ–¹å—
- âŒ ä¸æ–¹å—/å®ä½“äº¤äº’
- âŒ ä½¿ç”¨æŒ‡ä»¤
- âŒ ä¸¢å¼ƒ/æ¡èµ·ç‰©å“
- âŒ åˆ‡æ¢æ‰‹æŒç‰©å“

**æŠ€æœ¯äº®ç‚¹**:
```kotlin
// è‡ªåŠ¨è¿‡æœŸæ£€æŸ¥ï¼ˆå…¨å±€å®šæ—¶ä»»åŠ¡ï¼‰
Bukkit.getGlobalRegionScheduler().runAtFixedRate(plugin, { _ ->
    val now = System.currentTimeMillis()
    val expired = mutableListOf<UUID>()
    
    frozenPlayers.forEach { (uuid, expireTime) ->
        if (expireTime > 0 && now > expireTime) {
            expired.add(uuid)
        }
    }
    
    expired.forEach { uuid ->
        frozenPlayers.remove(uuid)
        // é€šçŸ¥ç©å®¶
    }
}, 20L, 20L)  // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
```

#### 3. å‘½ä»¤åˆ«åï¼ˆAliasï¼‰

**åŠŸèƒ½**: ä¸ºç°æœ‰å‘½ä»¤åˆ›å»ºè‡ªå®šä¹‰åˆ«åï¼Œæ”¯æŒä¸­æ–‡ã€‚

**æ¨¡å—ç»“æ„**:
```
Alias/
â”œâ”€â”€ AliasManager.kt          # åŠ è½½ aliases.yml
â”œâ”€â”€ AliasCommand.kt          # aliasreload å‘½ä»¤
â””â”€â”€ DynamicAliasCommand.kt   # åŠ¨æ€æ³¨å†Œåˆ«åå‘½ä»¤
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è‡ªå®šä¹‰åˆ«åï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
- âœ… å®Œæ•´ Tab è¡¥å…¨
- âœ… çƒ­é‡è½½
- âœ… åŠ¨æ€æ³¨å†Œå‘½ä»¤

**é…ç½®ç¤ºä¾‹**:
```yaml
aliases:
  - "t:tpa"
  - "ä¼ é€:tpa"
  - "gms:gamemode survival"
```

### ç©å®¶äº’åŠ¨ç±»

#### 4. ç©å®¶äº²å»ï¼ˆKissï¼‰

**åŠŸèƒ½**: ç©å®¶ä¹‹é—´çš„äº’åŠ¨åŠŸèƒ½ï¼Œå¸¦ç²’å­æ•ˆæœå’ŒéŸ³æ•ˆã€‚

**æ¨¡å—ç»“æ„**:
```
Kiss/
â”œâ”€â”€ KissManager.kt       # é…ç½®ã€å†·å´ã€ç»Ÿè®¡
â”œâ”€â”€ KissCommand.kt       # kiss <ç©å®¶> å‘½ä»¤
â”œâ”€â”€ KissExecutor.kt      # æ‰§è¡Œäº²å»æ•ˆæœ
â”œâ”€â”€ KissListener.kt      # Shift+å³é”®è§¦å‘
â””â”€â”€ KissPlaceholder.kt   # PAPI å˜é‡
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… `/tsl kiss <ç©å®¶>` - å‘½ä»¤äº²å»
- âœ… Shift + å³é”® - äº’åŠ¨äº²å»
- âœ… ä¸ªäººå¼€å…³é˜²éªšæ‰°ï¼ˆPDC å­˜å‚¨ï¼‰
- âœ… å†·å´æ—¶é—´
- âœ… ç»Ÿè®¡ï¼ˆäº²å»æ¬¡æ•°ã€è¢«äº²å»æ¬¡æ•°ï¼‰
- âœ… PlaceholderAPI æ”¯æŒ

**æ•ˆæœ**:
- â¤ï¸ çˆ±å¿ƒç²’å­ç‰¹æ•ˆ
- ğŸ”Š éŸ³æ•ˆï¼ˆENTITY_PLAYER_LEVELUPï¼‰
- ğŸ“¢ æ¶ˆæ¯æç¤º

**PAPI å˜é‡**:
- `%tsl_kiss_count%` - äº²å»æ¬¡æ•°
- `%tsl_kissed_count%` - è¢«äº²å»æ¬¡æ•°

**æŠ€æœ¯äº®ç‚¹**:
```kotlin
// PDC å­˜å‚¨ä¸ªäººå¼€å…³
fun isPlayerEnabled(player: Player): Boolean {
    return dataManager.getKissToggle(player, true)
}

// å†·å´ç®¡ç†
private val playerCooldowns: MutableMap<UUID, Long> = ConcurrentHashMap()

fun isInCooldown(uuid: UUID): Boolean {
    val lastUsed = playerCooldowns[uuid] ?: return false
    return System.currentTimeMillis() - lastUsed < cooldown
}
```

#### 5. å¸½å­ç³»ç»Ÿï¼ˆHatï¼‰

**åŠŸèƒ½**: å°†æ‰‹æŒç‰©å“æˆ´åœ¨å¤´ä¸Šã€‚

**æ¨¡å—ç»“æ„**:
```
Hat/
â”œâ”€â”€ HatManager.kt    # é…ç½®ç®¡ç†
â””â”€â”€ HatCommand.kt    # hat å‘½ä»¤
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å°†ä»»æ„ç‰©å“æˆ´å¤´ä¸Š
- âœ… è‡ªåŠ¨å¤„ç†å †å ç‰©å“ï¼ˆåªæˆ´ 1 ä¸ªï¼‰
- âœ… èƒŒåŒ…æ»¡æ—¶è‡ªåŠ¨æ‰è½åŸå¸½å­
- âœ… é»‘åå•é…ç½®

**æŠ€æœ¯äº®ç‚¹**:
```kotlin
// ä½¿ç”¨ Folia å®ä½“è°ƒåº¦å™¨
player.scheduler.run(plugin, { _ ->
    val helmet = player.inventory.helmet
    val handItem = player.inventory.itemInMainHand
    
    // å¤„ç†å †å ç‰©å“
    if (handItem.amount > 1) {
        val single = handItem.clone()
        single.amount = 1
        player.inventory.setHelmet(single)
        handItem.amount -= 1
    } else {
        player.inventory.setHelmet(handItem)
        player.inventory.setItemInMainHand(null)
    }
    
    // è¿”è¿˜åŸå¸½å­
    if (helmet != null && helmet.type != Material.AIR) {
        if (player.inventory.firstEmpty() == -1) {
            player.world.dropItem(player.location, helmet)
        } else {
            player.inventory.addItem(helmet)
        }
    }
}, null)
```

#### 6. ä½“å‹è°ƒæ•´ï¼ˆScaleï¼‰

**åŠŸèƒ½**: è°ƒæ•´ç©å®¶ä½“å‹å¤§å°ã€‚

**æ¨¡å—ç»“æ„**:
```
Scale/
â”œâ”€â”€ ScaleManager.kt    # é…ç½®ã€èŒƒå›´é™åˆ¶
â””â”€â”€ ScaleCommand.kt    # scale <æ•°å€¼> å‘½ä»¤
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è‡ªå®šä¹‰ä½“å‹å¤§å°
- âœ… èŒƒå›´é™åˆ¶ï¼ˆ0.1 - 5.0ï¼‰
- âœ… æ”¯æŒå°æ•°ç²¾åº¦

**æŠ€æœ¯å®ç°**:
```kotlin
player.setAttribute(Attribute.GENERIC_SCALE, scale)
```

#### 7. å»¶è¿ŸæŸ¥è¯¢ï¼ˆPingï¼‰

**åŠŸèƒ½**: æŸ¥è¯¢ç©å®¶å»¶è¿Ÿï¼Œæ”¯æŒæ’è¡Œæ¦œã€‚

**æ¨¡å—ç»“æ„**:
```
Ping/
â”œâ”€â”€ PingManager.kt     # é…ç½®ç®¡ç†
â”œâ”€â”€ PingCommand.kt     # ping [ç©å®¶|all] å‘½ä»¤
â””â”€â”€ PingPaginator.kt   # åˆ†é¡µæ˜¾ç¤º
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… `/tsl ping` - æŸ¥è¯¢è‡ªå·±
- âœ… `/tsl ping <ç©å®¶>` - æŸ¥è¯¢ä»–äºº
- âœ… `/tsl ping all` - å»¶è¿Ÿæ’è¡Œæ¦œ
- âœ… é¢œè‰²åˆ†çº§æ˜¾ç¤º
- âœ… å¯ç‚¹å‡»ç¿»é¡µ

**é¢œè‰²åˆ†çº§**:
- 0-50ms: ç»¿è‰²ï¼ˆä¼˜ç§€ï¼‰
- 51-100ms: é»„è‰²ï¼ˆè‰¯å¥½ï¼‰
- 101-200ms: é‡‘è‰²ï¼ˆä¸€èˆ¬ï¼‰
- 201-500ms: çº¢è‰²ï¼ˆè¾ƒå·®ï¼‰
- 500+ms: æ·±çº¢è‰²ï¼ˆå¾ˆå·®ï¼‰

### ç”Ÿç‰©äº’åŠ¨ç±»

#### 8. ç”Ÿç‰©ä¸¾èµ·ï¼ˆTossï¼‰

**åŠŸèƒ½**: ä¸¾èµ·å’ŒæŠ•æ·ç”Ÿç‰©ã€‚

**æ¨¡å—ç»“æ„**:
```
Toss/
â”œâ”€â”€ TossManager.kt     # é…ç½®ã€å ç½—æ±‰ç®¡ç†
â”œâ”€â”€ TossCommand.kt     # toss toggle/velocity å‘½ä»¤
â””â”€â”€ TossListener.kt    # Shift+å³é”®ä¸¾èµ·ã€å·¦é”®æŠ•æ·
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… Shift + å³é”® - ä¸¾èµ·ç”Ÿç‰©
- âœ… å·¦é”® - æŠ•æ·ç”Ÿç‰©
- âœ… å ç½—æ±‰ï¼ˆæœ€å¤š 3 ä¸ªï¼‰
- âœ… å¯è°ƒæŠ•æ·é€Ÿåº¦ï¼ˆPDC å­˜å‚¨ï¼‰
- âœ… ä¸ªäººå¼€å…³ï¼ˆPDC å­˜å‚¨ï¼‰
- âœ… é»‘åå•é…ç½®

**æŠ€æœ¯äº®ç‚¹**:
```kotlin
// æŠ•æ·é€»è¾‘
val direction = player.location.direction
val throwVelocity = direction.multiply(velocity)
throwVelocity.setY(throwVelocity.y + 0.3)  // âš ï¸ Kotlin ç‰¹æ€§ï¼šå¿…é¡»ç”¨ setY
passenger.setVelocity(throwVelocity)
```

#### 9. ç”Ÿç‰©éª‘ä¹˜ï¼ˆRideï¼‰

**åŠŸèƒ½**: å³é”®éª‘ä¹˜ä»»æ„ç”Ÿç‰©ã€‚

**æ¨¡å—ç»“æ„**:
```
Ride/
â”œâ”€â”€ RideManager.kt     # é…ç½®ã€é»‘åå•
â”œâ”€â”€ RideCommand.kt     # ride toggle å‘½ä»¤
â””â”€â”€ RideListener.kt    # å³é”®è§¦å‘
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å³é”®ç”Ÿç‰©éª‘ä¹˜
- âœ… ä¸ªäººå¼€å…³ï¼ˆPDC å­˜å‚¨ï¼‰
- âœ… é»‘åå•é…ç½®

#### 10. æ°¸ä¹…å¹¼å¹´ï¼ˆBabyLockï¼‰

**åŠŸèƒ½**: ç»™å¹¼å¹´ç”Ÿç‰©å‘½åç‰¹æ®Šå‰ç¼€ï¼Œé”å®šå¹¼å¹´çŠ¶æ€ã€‚

**æ¨¡å—ç»“æ„**:
```
BabyLock/
â”œâ”€â”€ BabyLockManager.kt    # é…ç½®ã€å‰ç¼€æ£€æµ‹
â””â”€â”€ BabyLockListener.kt   # æˆé•¿äº‹ä»¶ã€å‘½åäº‹ä»¶
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å‘½å `[å¹¼]`ã€`[å°]`ã€`[Baby]` å‰ç¼€é”å®š
- âœ… é˜»æ­¢æˆé•¿
- âœ… å–æ¶ˆå‘½åæ—¶è§£é”

**æŠ€æœ¯å®ç°**:
```kotlin
@EventHandler
fun onEntityBreed(event: EntityBreedEvent) {
    val child = event.entity
    if (child is Ageable) {
        child.scheduler.runDelayed(plugin, { _ ->
            val name = child.customName()
            if (name != null && manager.hasBabyPrefix(name)) {
                child.setAge(Int.MIN_VALUE)  // é”å®šå¹¼å¹´
                child.ageLock = true
            }
        }, null, 1L)
    }
}
```

### ä¿æŠ¤åŠŸèƒ½ç±»

#### 11. å†œç”°ä¿æŠ¤ï¼ˆFarmProtectï¼‰

**åŠŸèƒ½**: é˜²æ­¢ç©å®¶/ç”Ÿç‰©è¸©è¸å†œç”°ã€‚

**æŠ€æœ¯å®ç°**:
```kotlin
@EventHandler(priority = EventPriority.HIGHEST, ignoreCancelled = true)
fun onPlayerInteract(event: PlayerInteractEvent) {
    if (event.action == Action.PHYSICAL) {
        val block = event.clickedBlock ?: return
        if (block.type == Material.FARMLAND) {
            event.isCancelled = true
        }
    }
}
```

#### 12. è®¿å®¢ä¿æŠ¤ï¼ˆVisitorï¼‰

**åŠŸèƒ½**: æ‹¥æœ‰ç‰¹å®šæƒé™çš„ç©å®¶è·å¾—ä¿æŠ¤å’Œå‘å…‰æ•ˆæœã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æ€ªç‰©ä¸ä¼šæ”»å‡»è®¿å®¢
- âœ… è®¿å®¢å‘å…‰æ•ˆæœ
- âœ… è·å¾—/å¤±å»æƒé™æ—¶æç¤º
- âœ… ä¾èµ– LuckPerms

### ç³»ç»Ÿå¢å¼ºç±»

#### 13. æˆå°±è¿‡æ»¤ï¼ˆAdvancementï¼‰

**åŠŸèƒ½**: è¿‡æ»¤æˆå°±æ¶ˆæ¯ã€ç»Ÿè®¡æˆå°±ã€PlaceholderAPI æ”¯æŒã€‚

**æ¨¡å—ç»“æ„**:
```
Advancement/
â”œâ”€â”€ AdvancementCount.kt     # ç»Ÿè®¡æˆå°±æ•°é‡
â”œâ”€â”€ AdvancementMessage.kt   # è¿‡æ»¤æˆå°±æ¶ˆæ¯
â””â”€â”€ AdvancementCommand.kt   # å‘½ä»¤
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å…³é—­/å¼€å¯æˆå°±æ¶ˆæ¯
- âœ… ç»Ÿè®¡æˆå°±æ•°é‡
- âœ… PAPI å˜é‡

#### 14. MOTD å‡ç©å®¶ï¼ˆMotdï¼‰

**åŠŸèƒ½**: ä¿®æ”¹æœåŠ¡å™¨åˆ—è¡¨æ˜¾ç¤ºçš„åœ¨çº¿äººæ•°ã€‚

**æŠ€æœ¯å®ç°**:
```kotlin
@EventHandler
fun onServerListPing(event: ServerListPingEvent) {
    val realPlayers = Bukkit.getOnlinePlayers().size
    val fakeCount = plugin.config.getInt("fakeplayer.count", 0)
    val displayPlayers = (realPlayers + fakeCount).coerceAtLeast(0)
    
    event.numPlayers = displayPlayers
}
```

---

## è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ

### 1. ä¾èµ–æ³¨å…¥

```kotlin
class KissManager(
    private val plugin: JavaPlugin,
    private val dataManager: PlayerDataManager  // æ³¨å…¥
) {
    // ...
}

// ä¸»ç±»ä¸­
override fun onEnable() {
    playerDataManager = PlayerDataManager(this)
    kissManager = KissManager(this, playerDataManager)
}
```

### 2. å¿«é€Ÿå¤±è´¥ä¼˜åŒ–

```kotlin
@EventHandler
fun onEvent(event: SomeEvent) {
    // âœ… å…ˆæ£€æŸ¥ç®€å•æ¡ä»¶ï¼ˆè¶Šå¿«è¶Šå¥½ï¼‰
    if (!manager.isEnabled()) return        // æœ€å¿«ï¼šå¸ƒå°”å€¼
    if (player.isSneaking) return          // æ¬¡å¿«ï¼šå¯¹è±¡å±æ€§
    if (!player.hasPermission("...")) return  // è¾ƒå¿«ï¼šæƒé™æ£€æŸ¥
    
    // æœ€åæ£€æŸ¥å¤æ‚æ¡ä»¶
    if (manager.isBlacklisted(entity.type)) return  // æ…¢ï¼šé›†åˆæŸ¥æ‰¾
    
    // ä¸šåŠ¡é€»è¾‘
}
```

### 3. å¹¶å‘å®‰å…¨

```kotlin
// ä½¿ç”¨ ConcurrentHashMap
private val playerCooldowns: MutableMap<UUID, Long> = ConcurrentHashMap()

// ä½¿ç”¨ CopyOnWriteArrayListï¼ˆè¯»å¤šå†™å°‘ï¼‰
private val listeners: MutableList<Listener> = CopyOnWriteArrayList()
```

### 4. èµ„æºæ¸…ç†

```kotlin
@EventHandler
fun onPlayerQuit(event: PlayerQuitEvent) {
    val uuid = event.player.uniqueId
    
    // æ¸…ç†å†…å­˜æ•°æ®
    playerCooldowns.remove(uuid)
    
    // âš ï¸ PDC æ•°æ®ä¸éœ€è¦æ¸…ç†ï¼ˆè‡ªåŠ¨æŒä¹…åŒ–ï¼‰
}
```

### 5. ç©ºå®‰å…¨

```kotlin
// âœ… ä½¿ç”¨å®‰å…¨è°ƒç”¨
val name = player?.name ?: "Unknown"

// âœ… ä½¿ç”¨ let
player?.let {
    it.sendMessage("Hello")
}

// âŒ é¿å… !!ï¼ˆé™¤éç¡®å®šä¸ä¸º nullï¼‰
val name = player!!.name  // ä¸æ¨è
```

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### å·²å®ç°çš„ä¼˜åŒ–

1. âœ… **é…ç½®ç¼“å­˜æœºåˆ¶** - å¯åŠ¨/reload æ—¶è¯»å–ï¼Œäº‹ä»¶å¤„ç†é›¶å¼€é”€
2. âœ… **äº‹ä»¶é©±åŠ¨æ¶æ„** - æ— è½®è¯¢ä»»åŠ¡ï¼ŒæŒ‰éœ€å“åº”
3. âœ… **å¿«é€Ÿå¤±è´¥ä¼˜åŒ–** - å…ˆæ£€æŸ¥ç®€å•æ¡ä»¶
4. âœ… **Folia è°ƒåº¦å™¨** - åŸç”Ÿå¤šçº¿ç¨‹æ”¯æŒ
5. âœ… **PDC æ•°æ®æŒä¹…åŒ–** - å‡å°‘å†…å­˜å ç”¨
6. âœ… **å¹¶å‘é›†åˆ** - ConcurrentHashMap ä¿è¯çº¿ç¨‹å®‰å…¨
7. âœ… **äº‹ä»¶ä¼˜å…ˆçº§** - åˆç†è®¾ç½® EventPriority

### æ€§èƒ½ç›‘æ§

```kotlin
// è°ƒè¯•æ¨¡å¼
private var debug: Boolean = false

fun loadConfig() {
    debug = plugin.config.getBoolean("debug", false)
}

private fun debugLog(message: String) {
    if (debug) {
        plugin.logger.info("[DEBUG] $message")
    }
}
```

---

## å¼€å‘æµç¨‹

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

#### 1. åˆ›å»ºåŒ…ç»“æ„
```
NewFeature/
â”œâ”€â”€ NewFeatureManager.kt
â”œâ”€â”€ NewFeatureCommand.kt
â””â”€â”€ NewFeatureListener.kt
```

#### 2. å®ç° Manager
```kotlin
class NewFeatureManager(private val plugin: JavaPlugin) {
    private var enabled: Boolean = true
    
    init {
        loadConfig()
    }
    
    fun loadConfig() {
        enabled = plugin.config.getBoolean("new_feature.enabled", true)
    }
    
    fun isEnabled(): Boolean = enabled
}
```

#### 3. å®ç° Command
```kotlin
class NewFeatureCommand(
    private val manager: NewFeatureManager
) : SubCommandHandler {
    override fun handle(...): Boolean { ... }
    override fun tabComplete(...): List<String> { ... }
}
```

#### 4. å®ç° Listener
```kotlin
class NewFeatureListener(
    private val plugin: JavaPlugin,
    private val manager: NewFeatureManager
) : Listener {
    @EventHandler
    fun onEvent(event: SomeEvent) {
        if (!manager.isEnabled()) return
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

#### 5. æ³¨å†Œåˆ°ä¸»ç±»
```kotlin
// TSLplugins.kt
private lateinit var newFeatureManager: NewFeatureManager

override fun onEnable() {
    newFeatureManager = NewFeatureManager(this)
    val listener = NewFeatureListener(this, newFeatureManager)
    pm.registerEvents(listener, this)
    
    dispatcher.registerSubCommand("newfeature", NewFeatureCommand(newFeatureManager))
}

fun reloadNewFeatureManager() {
    newFeatureManager.loadConfig()
}
```

#### 6. æ·»åŠ åˆ° ReloadCommand
```kotlin
plugin.reloadNewFeatureManager()
```

#### 7. æ·»åŠ é…ç½®
```yaml
# config.yml
new_feature:
  enabled: true
  messages:
    prefix: "&6[NewFeature]&r "
```

#### 8. æ›´æ–°é…ç½®ç‰ˆæœ¬
```kotlin
// ConfigUpdateManager.kt
const val CURRENT_CONFIG_VERSION = 11  // é€’å¢
```

### æ„å»ºå’Œéƒ¨ç½²

```bash
# Windows
gradlew.bat clean shadowJar

# è¾“å‡º
build/libs/TSLplugins-1.0.jar
```

---

## é¡¹ç›®ç‰¹è‰²

### æŠ€æœ¯ç‰¹è‰²

1. **Kotlin è¯­è¨€ä¼˜åŠ¿**
   - ç®€æ´çš„è¯­æ³•ï¼ˆæ•°æ®ç±»ã€Lambdaã€ç©ºå®‰å…¨ï¼‰
   - ä¸ Java å®Œå…¨äº’æ“ä½œ
   - ç°ä»£åŒ–çš„è¯­è¨€ç‰¹æ€§

2. **Folia åŸç”Ÿæ”¯æŒ**
   - å®Œå…¨ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ API
   - æ— ä¼ ç»Ÿ Bukkit Scheduler
   - åŸç”Ÿå¤šçº¿ç¨‹æ€§èƒ½

3. **é…ç½®ç¼“å­˜æœºåˆ¶**
   - é›¶ I/O å¼€é”€
   - æœ€ä½³æ€§èƒ½è¡¨ç°
   - ç®€å•çš„é‡è½½æœºåˆ¶

4. **PDC æ•°æ®æŒä¹…åŒ–**
   - é›¶é…ç½®éœ€æ±‚
   - æ•°æ®æ°¸ä¸ä¸¢å¤±
   - è‡ªåŠ¨è·¨æœåŒæ­¥

5. **æ™ºèƒ½é…ç½®æ›´æ–°**
   - è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬
   - ä¿ç•™æ³¨é‡Šå’Œæ ¼å¼
   - å¹³æ»‘å‡çº§ä½“éªŒ

### æ¶æ„ç‰¹è‰²

1. **æ¨¡å—åŒ–è®¾è®¡**
   - 13 ä¸ªç‹¬ç«‹æ¨¡å—
   - äº’ä¸ä¾èµ–
   - å¯å•ç‹¬ç¦ç”¨

2. **ç»Ÿä¸€æ¶æ„æ¨¡å¼**
   - Manager-Command-Listener
   - SubCommandHandler æ¥å£
   - ä¸€è‡´çš„ä»£ç é£æ ¼

3. **äº‹ä»¶é©±åŠ¨**
   - æ— è½®è¯¢ä»»åŠ¡
   - æŒ‰éœ€å“åº”
   - é«˜æ•ˆèŠ‚èƒ½

### ç”¨æˆ·ä½“éªŒ

1. **é…ç½®çƒ­é‡è½½**
   - `/tsl reload` é‡è½½æ‰€æœ‰é…ç½®
   - æ— éœ€é‡å¯æœåŠ¡å™¨

2. **å®Œæ•´çš„ Tab è¡¥å…¨**
   - æ‰€æœ‰å‘½ä»¤æ”¯æŒ Tab
   - æ™ºèƒ½è¡¥å…¨ç©å®¶å

3. **ä¸°å¯Œçš„æ¶ˆæ¯é…ç½®**
   - æ‰€æœ‰æ¶ˆæ¯å¯è‡ªå®šä¹‰
   - æ”¯æŒé¢œè‰²ä»£ç 
   - ç»Ÿä¸€çš„å‰ç¼€ç³»ç»Ÿ

4. **æƒé™ç³»ç»Ÿ**
   - ç»†ç²’åº¦æƒé™æ§åˆ¶
   - Bypass æƒé™æ”¯æŒ
   - OP é»˜è®¤æ‹¥æœ‰æ‰€æœ‰æƒé™

---

## æ€»ç»“

TSLplugins æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾è‰¯ã€æ¶æ„æ¸…æ™°ã€æ€§èƒ½ä¼˜è¶Šçš„ Minecraft æœåŠ¡å™¨æ’ä»¶ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡ã€é…ç½®ç¼“å­˜ã€PDC æŒä¹…åŒ–ç­‰æŠ€æœ¯ï¼Œå®ç°äº†é«˜æ€§èƒ½å’Œè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

### æ ¸å¿ƒä¼˜åŠ¿

- âœ… **æ€§èƒ½ä¼˜è¶Š** - é…ç½®ç¼“å­˜ã€äº‹ä»¶é©±åŠ¨ã€é›¶è½®è¯¢
- âœ… **æ¶æ„æ¸…æ™°** - Manager-Command-Listener æ¨¡å¼
- âœ… **æ˜“äºç»´æŠ¤** - ç»Ÿä¸€é£æ ¼ã€æ¨¡å—ç‹¬ç«‹
- âœ… **ç”¨æˆ·å‹å¥½** - çƒ­é‡è½½ã€Tab è¡¥å…¨ã€è‡ªå®šä¹‰æ¶ˆæ¯
- âœ… **æ•°æ®å®‰å…¨** - PDC æŒä¹…åŒ–ã€è‡ªåŠ¨å¤‡ä»½

### é€‚åˆå­¦ä¹ çš„å†…å®¹

- Kotlin åœ¨ Minecraft æ’ä»¶å¼€å‘ä¸­çš„åº”ç”¨
- Folia å¤šçº¿ç¨‹è°ƒåº¦å™¨çš„ä½¿ç”¨
- äº‹ä»¶é©±åŠ¨æ¶æ„è®¾è®¡
- é…ç½®ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
- æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ

---

**æ–‡æ¡£ç”Ÿæˆæ—¥æœŸ**: 2025-11-25  
**æ’ä»¶ç‰ˆæœ¬**: 1.0  
**é…ç½®ç‰ˆæœ¬**: 10

