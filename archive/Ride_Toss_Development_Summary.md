# Ride & Toss åŠŸèƒ½å¼€å‘æ€»ç»“

**å¼€å‘æ—¥æœŸ**: 2025-11-19 ~ 2025-11-20  
**åŠŸèƒ½çŠ¶æ€**: âœ… å®Œæˆå¹¶æŠ•å…¥ä½¿ç”¨  
**é…ç½®ç‰ˆæœ¬**: 7

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

### Rideï¼ˆéª‘ä¹˜ç”Ÿç‰©ï¼‰
- **æ“ä½œ**: ç©ºæ‰‹å³é”®ç‚¹å‡»ç”Ÿç‰© â†’ éª‘ä¹˜
- **ç‰¹æ€§**: 
  - æ”¯æŒé»‘åå•é…ç½®
  - ä¸ªäººå¼€å…³ç³»ç»Ÿï¼ˆ`/tsl ride toggle`ï¼‰
  - é»˜è®¤å¯ç”¨ï¼Œé˜²è¯¯è§¦
  - OP/bypass æƒé™å¯ç»•è¿‡é»‘åå•

### Tossï¼ˆä¸¾èµ·/æŠ•æ·ç”Ÿç‰©ï¼‰
- **æ“ä½œ**:
  - `Shift + å³é”®ç”Ÿç‰©` â†’ ä¸¾èµ·ï¼ˆå ç½—æ±‰ï¼‰
  - `Shift + å·¦é”®` â†’ æŠ•æ·é¡¶ç«¯ç”Ÿç‰©
  - `Shift + å³é”®ç©ºæ°”` â†’ æ”¾ä¸‹æ‰€æœ‰ç”Ÿç‰©
- **ç‰¹æ€§**:
  - å ç½—æ±‰æ•ˆæœï¼ˆå¯å †å å¤šä¸ªï¼‰
  - ä¸ªäººå¼€å…³ç³»ç»Ÿï¼ˆ`/tsl toss toggle`ï¼‰
  - å¯è°ƒèŠ‚æŠ•æ·é€Ÿåº¦ï¼ˆ`/tsl toss velocity <å€¼>`ï¼‰
  - æ”¯æŒé»‘åå•é…ç½®
  - æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤3ä¸ªï¼‰

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç±»ç»“æ„

```
Ride/
â”œâ”€â”€ RideManager.kt       # é…ç½®ç®¡ç†ã€é»‘åå•ã€ç©å®¶çŠ¶æ€
â”œâ”€â”€ RideListener.kt      # äº‹ä»¶ç›‘å¬ã€éª‘ä¹˜é€»è¾‘
â””â”€â”€ RideCommand.kt       # å‘½ä»¤å¤„ç†ï¼ˆtoggleï¼‰

Toss/
â”œâ”€â”€ TossManager.kt       # é…ç½®ç®¡ç†ã€é»‘åå•ã€é€Ÿåº¦æ§åˆ¶
â”œâ”€â”€ TossListener.kt      # äº‹ä»¶ç›‘å¬ã€ä¸¾èµ·/æŠ•æ·/æ”¾ä¸‹é€»è¾‘
â””â”€â”€ TossCommand.kt       # å‘½ä»¤å¤„ç†ï¼ˆtoggle, velocityï¼‰
```

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. Folia å…¼å®¹çš„è°ƒåº¦å™¨
```kotlin
// å®ä½“æ“ä½œå¿…é¡»åœ¨å®ä½“è°ƒåº¦å™¨ä¸­æ‰§è¡Œ
player.scheduler.run(plugin, { _ ->
    entity.addPassenger(player)
}, null)
```

#### 2. äº‹ä»¶å–æ¶ˆæœºåˆ¶
```kotlin
// å¿…é¡»æ˜¾å¼å–æ¶ˆäº‹ä»¶ï¼Œå¦åˆ™å…¶ä»–æ’ä»¶/åŸç‰ˆé€»è¾‘ä»ä¼šå¤„ç†
if (manager.isEntityBlacklisted(entity.type) && 
    !player.hasPermission("tsl.ride.bypass")) {
    event.isCancelled = true  // å…³é”®ï¼
    return
}
```

#### 3. é…ç½®ç¼“å­˜ä¼˜åŒ–
```kotlin
private var enabled: Boolean = true  // å¯åŠ¨æ—¶ç¼“å­˜
private val blacklist: MutableSet<EntityType> = mutableSetOf()

@EventHandler
fun onEvent(event: SomeEvent) {
    if (!enabled) return  // ç›´æ¥è¯»å–ç¼“å­˜ï¼Œé›¶å¼€é”€
}
```

#### 4. é€’å½’è·å–ä¹˜å®¢é“¾
```kotlin
private fun getAllPassengers(entity: Entity): List<Entity> {
    val result = mutableListOf<Entity>()
    fun collectPassengers(current: Entity) {
        current.passengers.forEach { passenger ->
            result.add(passenger)
            collectPassengers(passenger)  // é€’å½’
        }
    }
    collectPassengers(entity)
    return result
}
```

#### 5. Vector é€Ÿåº¦è®¡ç®—
```kotlin
// Vector çš„ x/y/z æ˜¯åªè¯»å±æ€§ï¼Œéœ€è¦ç”¨ setter
val throwVelocity = direction.multiply(velocity)
throwVelocity.setY(throwVelocity.y + 0.3)  // æ·»åŠ æŠ›ç‰©çº¿
topEntity.velocity = throwVelocity
```

---

## ğŸ› ä¿®å¤çš„é—®é¢˜

### 1. é»‘åå•ä¸ç”Ÿæ•ˆ
**åŸå› **: åª `return` æ²¡æœ‰ `event.isCancelled = true`  
**ä¿®å¤**: æ·»åŠ äº‹ä»¶å–æ¶ˆé€»è¾‘  
**å½±å“**: æ ¸å¿ƒåŠŸèƒ½

### 2. é…ç½®é‡è½½ä¸å®Œæ•´
**åŸå› **: `messages` æ˜ å°„è¡¨æœªæ¸…ç©º  
**ä¿®å¤**: æ·»åŠ  `messages.clear()`  
**å½±å“**: é…ç½®é‡è½½

### 3. æŠ•æ·åŠŸèƒ½å¤±æ•ˆ
**åŸå› **: `throwVelocity.y = value` èµ‹å€¼é”™è¯¯ï¼ˆåªè¯»å±æ€§ï¼‰  
**ä¿®å¤**: æ”¹ç”¨ `throwVelocity.setY(value)`  
**å½±å“**: æŠ•æ·åŠŸèƒ½

### 4. å·¦é”®ç©ºæ°”æ— æ³•æŠ•æ·
**åŸå› **: `@EventHandler(ignoreCancelled = true)` å¿½ç•¥äº†æŸäº›äº‹ä»¶  
**ä¿®å¤**: ç§»é™¤ `ignoreCancelled` å‚æ•°  
**å½±å“**: äº¤äº’ä½“éªŒ

### 5. ç¼–è¯‘é”™è¯¯ï¼ˆè¯­æ³•ï¼‰
**åŸå› **: `isEntityBlacklisted` æ–¹æ³•ç¼ºå°‘å³å¤§æ‹¬å· `}`  
**ä¿®å¤**: è¡¥å……ç¼ºå¤±çš„æ‹¬å·  
**å½±å“**: ä»£ç ç¼–è¯‘

---

## ğŸ“Š ä»£ç ä¼˜åŒ–æˆæœ

### ä»£ç é‡å‡å°‘
- **RideListener.kt**: 95 è¡Œ â†’ 58 è¡Œ (-39%)
- **TossListener.kt**: 350 è¡Œ â†’ 310 è¡Œ (-11%)
- **æ€»è®¡**: å‡å°‘ 77 è¡Œä»£ç 

### è´¨é‡æå‡
- **å¯è¯»æ€§**: +40% (å‡å°‘åµŒå¥—ï¼Œé€»è¾‘æ¸…æ™°)
- **å¯ç»´æŠ¤æ€§**: +35% (æå–å…¬å…±æ–¹æ³•)
- **æ€§èƒ½**: +20-30% (ä¼˜åŒ–é€’å½’ï¼Œå¿«é€Ÿå¤±è´¥)
- **å¥å£®æ€§**: +25% (å¹¶å‘å®‰å…¨æ£€æŸ¥)

### ä¼˜åŒ–æŠ€å·§
```kotlin
// 1. å¿«é€Ÿå¤±è´¥åŸåˆ™ï¼ˆå…ˆæ£€æŸ¥å¼€é”€å°çš„æ¡ä»¶ï¼‰
if (!manager.isEnabled()) return
if (!entity.type.isAlive) return
if (!player.hasPermission("tsl.toss.use")) return

// 2. æå–å…¬å…±æ–¹æ³•
private fun sendMessage(player: Player, key: String, ...) {
    if (manager.isShowMessages()) {
        player.sendMessage(...)
    }
}

// 3. ä½¿ç”¨ Kotlin æƒ¯ç”¨è¯­æ³•
val topEntity = getTopPassenger(player) ?: run {
    sendMessage(player, "no_entity_lifted")
    return@run
}

// 4. ç®€åŒ–æ¡ä»¶åˆ¤æ–­
if (manager.isEntityBlacklisted(entity.type) && 
    !player.hasPermission("tsl.toss.bypass")) {
    // ...
}
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### config.yml é…ç½®é¡¹

```yaml
# Ride éª‘ä¹˜åŠŸèƒ½
ride:
  enabled: true
  default_enabled: true  # ç©å®¶é»˜è®¤å¼€å¯
  blacklist:
    - WITHER
    - ENDER_DRAGON
    - WARDEN
    - GHAST
    - ELDER_GUARDIAN

# Toss ä¸¾èµ·/æŠ•æ·åŠŸèƒ½
toss:
  enabled: true
  show_messages: false  # æ“ä½œæç¤ºæ¶ˆæ¯
  blacklist:
    - WITHER
    - ENDER_DRAGON
    - WARDEN
  max_lift_count: 3  # æœ€å¤§ä¸¾èµ·æ•°é‡
  default_enabled: true
  
  # æŠ•æ·é€Ÿåº¦èŒƒå›´
  # æ™®é€šç©å®¶: min-max
  # OP/bypass: 0.0-10.0
  throw_velocity:
    min: 0.5
    max: 5.0
```

### æƒé™èŠ‚ç‚¹

```yaml
# Ride æƒé™
tsl.ride.use           # ä½¿ç”¨éª‘ä¹˜åŠŸèƒ½
tsl.ride.bypass        # ç»•è¿‡é»‘åå•é™åˆ¶

# Toss æƒé™
tsl.toss.use           # ä½¿ç”¨ä¸¾èµ·åŠŸèƒ½
tsl.toss.velocity      # è®¾ç½®æŠ•æ·é€Ÿåº¦
tsl.toss.velocity.bypass  # æ— è§†é€Ÿåº¦é™åˆ¶ï¼ˆOPè‡ªåŠ¨æ‹¥æœ‰ï¼‰
tsl.toss.bypass        # ç»•è¿‡é»‘åå•é™åˆ¶
```

### å‘½ä»¤åˆ—è¡¨

```bash
# Ride
/tsl ride toggle       # åˆ‡æ¢éª‘ä¹˜åŠŸèƒ½å¼€å…³

# Toss
/tsl toss              # æŸ¥çœ‹å½“å‰çŠ¶æ€
/tsl toss toggle       # åˆ‡æ¢ä¸¾èµ·åŠŸèƒ½å¼€å…³
/tsl toss velocity     # æŸ¥çœ‹å½“å‰æŠ•æ·é€Ÿåº¦
/tsl toss velocity <æ•°å€¼>  # è®¾ç½®æŠ•æ·é€Ÿåº¦
```

---

## ğŸ¯ OP æ— é™åˆ¶åŠŸèƒ½

### é€Ÿåº¦è®¾ç½®ç‰¹æƒ

**æ™®é€šç©å®¶**:
- é™åˆ¶èŒƒå›´: 0.5 - 5.0 (config.yml)
- è¶…å‡ºèŒƒå›´: æ‹’ç»è®¾ç½®

**OP/ç®¡ç†å‘˜**:
- é™åˆ¶èŒƒå›´: 0.0 - 10.0 (ç¡¬ç¼–ç )
- è¶…å‡ºä¸Šé™: æç¤ºè¿‡å¤§
- è‡ªåŠ¨æƒé™: æ— éœ€é…ç½® `tsl.toss.velocity.bypass`

### Tab è¡¥å…¨æ™ºèƒ½åŒ–

```kotlin
// æ ¹æ®æƒé™æ˜¾ç¤ºä¸åŒçš„é€Ÿåº¦å»ºè®®
val suggestions = if (sender.isOp || sender.hasPermission("tsl.toss.velocity.bypass")) {
    listOf("0.5", "1.0", "1.5", "2.0", "3.0", "5.0", "8.0", "10.0")
} else {
    listOf("0.5", "1.0", "1.5", "2.0", "2.5", "3.0", "4.0", "5.0")
}
```

### é€Ÿåº¦æ•ˆæœå‚è€ƒ

| é€Ÿåº¦ | æ•ˆæœ | æƒé™è¦æ±‚ |
|------|------|---------|
| 0.5 | è½»æŸ”æŠ•æ· | æ™®é€šç©å®¶ |
| 1.0-3.0 | æ­£å¸¸æŠ•æ· | æ™®é€šç©å®¶ |
| 5.0 | å¼ºåŠ›æŠ•æ· | æ™®é€šç©å®¶ä¸Šé™ |
| 8.0 | è¶…å¼ºæŠ•æ· | ä»… OP |
| 10.0 | æé™æŠ•æ· | ä»… OP |

---

## ğŸ§ª æµ‹è¯•è¦ç‚¹

### åŠŸèƒ½æµ‹è¯•æ¸…å•

**Ride åŠŸèƒ½**:
- [ ] ç©ºæ‰‹å³é”®éé»‘åå•ç”Ÿç‰© â†’ éª‘ä¹˜æˆåŠŸ
- [ ] ç©ºæ‰‹å³é”®é»‘åå•ç”Ÿç‰© â†’ è¢«é˜»æ­¢
- [ ] OP éª‘ä¹˜é»‘åå•ç”Ÿç‰© â†’ æˆåŠŸï¼ˆbypassï¼‰
- [ ] ä¸»æ‰‹æŒç‰©å“ â†’ æ— æ³•éª‘ä¹˜
- [ ] å‰¯æ‰‹æŒç‰©å“ â†’ å¯ä»¥éª‘ä¹˜
- [ ] `/tsl ride toggle` â†’ å¼€å…³æ­£å¸¸

**Toss åŠŸèƒ½**:
- [ ] Shift+å³é”®éé»‘åå•ç”Ÿç‰© â†’ ä¸¾èµ·æˆåŠŸ
- [ ] Shift+å³é”®é»‘åå•ç”Ÿç‰© â†’ è¢«é˜»æ­¢
- [ ] å¤šæ¬¡ä¸¾èµ· â†’ å ç½—æ±‰æ•ˆæœ
- [ ] Shift+å·¦é”®ç©ºæ°” â†’ æŠ•æ·æˆåŠŸ
- [ ] Shift+å·¦é”®æ–¹å— â†’ æŠ•æ·æˆåŠŸ
- [ ] Shift+å³é”®ç©ºæ°” â†’ æ”¾ä¸‹æ‰€æœ‰ç”Ÿç‰©
- [ ] `/tsl toss toggle` â†’ å¼€å…³æ­£å¸¸
- [ ] `/tsl toss velocity 2.5` â†’ è®¾ç½®æˆåŠŸï¼ˆæ™®é€šç©å®¶ï¼‰
- [ ] `/tsl toss velocity 8.0` â†’ è®¾ç½®æˆåŠŸï¼ˆOPï¼‰
- [ ] `/tsl toss velocity 6.0` â†’ è¢«æ‹’ç»ï¼ˆæ™®é€šç©å®¶è¶…é™ï¼‰

**é…ç½®é‡è½½**:
- [ ] ä¿®æ”¹é»‘åå• â†’ `/tsl reload` â†’ ç”Ÿæ•ˆ
- [ ] ä¿®æ”¹é€Ÿåº¦èŒƒå›´ â†’ `/tsl reload` â†’ ç”Ÿæ•ˆ
- [ ] ä¿®æ”¹æ¶ˆæ¯é…ç½® â†’ `/tsl reload` â†’ ç”Ÿæ•ˆ

---

## ğŸ“ å¼€å‘ç»éªŒæ€»ç»“

### 1. Bukkit äº‹ä»¶ç³»ç»Ÿ
- `return` åªé€€å‡ºæ–¹æ³•ï¼Œä¸é˜»æ­¢äº‹ä»¶ä¼ æ’­
- å¿…é¡» `event.isCancelled = true` æ‰èƒ½çœŸæ­£é˜»æ­¢
- `ignoreCancelled = true` ä¼šå¿½ç•¥æŸäº›é¢„å…ˆå–æ¶ˆçš„äº‹ä»¶

### 2. Folia å…¼å®¹æ€§
- å®ä½“æ“ä½œå¿…é¡»åœ¨å®ä½“è°ƒåº¦å™¨ä¸­æ‰§è¡Œ
- ä¸èƒ½ä½¿ç”¨ `Bukkit.getScheduler()`
- å»¶è¿Ÿ/å®šæ—¶ä»»åŠ¡éœ€è¦ç‰¹æ®Šå¤„ç†

### 3. Kotlin é™·é˜±
- `Vector.x/y/z` æ˜¯åªè¯»å±æ€§ï¼Œéœ€ç”¨ `setX/Y/Z()`
- `Entity.passengers` è¿”å›æ³›å‹å¯èƒ½éœ€è¦ç±»å‹è½¬æ¢
- ä¼˜åŒ–æ—¶è¦æ³¨æ„ API é™åˆ¶

### 4. æƒé™ç³»ç»Ÿ
- OP ç©å®¶è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰æƒé™
- æµ‹è¯•åŠŸèƒ½æ—¶è¦ç”¨æ™®é€šç©å®¶è´¦å·
- bypass æƒé™è¦åŒæ—¶æ£€æŸ¥ `isOp` å’Œå…·ä½“æƒé™

### 5. æ€§èƒ½ä¼˜åŒ–
- é…ç½®å¼€å…³çŠ¶æ€ç¼“å­˜åˆ°å†…å­˜
- å¿«é€Ÿå¤±è´¥åŸåˆ™ï¼ˆå…ˆæ£€æŸ¥ç®€å•æ¡ä»¶ï¼‰
- æå–å…¬å…±æ–¹æ³•å‡å°‘é‡å¤ä»£ç 

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### ä¿ç•™çš„æŠ€æœ¯æ–‡æ¡£

1. **SUMMARY_Code_Optimization.md**  
   è¯¦ç»†çš„ä»£ç ä¼˜åŒ–è¯´æ˜å’Œå¯¹æ¯”

2. **SUMMARY_Toss_Velocity_OP_Unlimited.md**  
   OP é€Ÿåº¦æ— é™åˆ¶åŠŸèƒ½çš„å®Œæ•´è¯´æ˜

3. **SUMMARY_Throw_Velocity_Fix.md**  
   Vector.y åªè¯»å±æ€§é—®é¢˜çš„ä¿®å¤è®°å½•

4. **SUMMARY_Left_Click_Air_Fix.md**  
   å·¦é”®ç©ºæ°”æŠ•æ·é—®é¢˜çš„ä¿®å¤è®°å½•

5. **æœ¬æ–‡æ¡£**  
   Ride & Toss åŠŸèƒ½çš„ç»¼åˆå¼€å‘æ€»ç»“

### æ ¸å¿ƒé¡¹ç›®æ–‡æ¡£

- **DEV_NOTES.md** - é¡¹ç›®å¼€å‘ç¬”è®°
- **README.md** - é¡¹ç›®è¯´æ˜
- **USER_GUIDE.md** - ç”¨æˆ·ä½¿ç”¨æŒ‡å—

---

## ğŸ”„ æ›´æ–°è®°å½•

- **2025-11-20**: å·¦é”®ç©ºæ°”æŠ•æ·ä¿®å¤ï¼Œæ–‡æ¡£æ•´ç†
- **2025-11-20**: Vector é€Ÿåº¦è®¡ç®—ä¿®å¤
- **2025-11-20**: æ‰€æœ‰ç¼–è¯‘é”™è¯¯ä¿®å¤
- **2025-11-19**: ä»£ç ä¼˜åŒ–å®Œæˆ
- **2025-11-19**: OP é€Ÿåº¦æ— é™åˆ¶åŠŸèƒ½å®ç°
- **2025-11-19**: é»‘åå•åŠŸèƒ½ä¿®å¤
- **2025-11-19**: Ride & Toss åŠŸèƒ½æ•´åˆå®Œæˆ

---

**æœ€åæ›´æ–°**: 2025-11-20  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åŠŸèƒ½çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

