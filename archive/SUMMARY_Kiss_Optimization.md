# Kiss 功能优化调整总结

**日期**: 2025-11-24  
**调整类型**: 功能优化

---

## 调整需求

根据 `新功能.md` 的要求，对 Kiss 模块进行以下调整：

1. ✅ 删除冷却时间提示
2. ✅ 删除"未开启kiss功能"的提示
3. ✅ 当玩家关闭kiss功能时，不进行检测
4. ✅ 所有权限默认拥有（除了bypass）
5. ✅ 即使玩家关闭了功能，也可以被其他玩家kiss

---

## 修改内容

### 1. KissCommand.kt

**修改前的逻辑**：
```kotlin
// 权限检查
if (!sender.hasPermission("tsl.kiss.use")) { ... }

// 个人开关检查
if (!manager.isPlayerEnabled(sender.uniqueId)) { 
    提示"你的亲吻功能已禁用" 
}

// 冷却检查（带提示）
if (manager.isInCooldown(...)) {
    提示"请等待 X 秒后再使用"
}

// 目标玩家开关检查
if (!manager.isPlayerEnabled(target.uniqueId)) {
    提示"XXX 拒绝被亲吻"
}
```

**修改后的逻辑**：
```kotlin
// 冷却检查（静默，不提示）
if (manager.isInCooldown(...) && !sender.hasPermission("tsl.kiss.bypass")) {
    return  // 静默返回，不提示
}

// 查找目标玩家
// 不能亲自己
// 执行亲吻（不检查任何开关状态）
```

**移除的检查**：
- ❌ 权限检查 `tsl.kiss.use`
- ❌ 个人开关检查（发起者）
- ❌ 冷却时间提示
- ❌ 目标玩家开关检查

**保留的检查**：
- ✅ 冷却时间限制（静默）
- ✅ bypass 权限检查
- ✅ 目标玩家是否在线
- ✅ 不能亲自己

---

### 2. KissListener.kt

**修改前的逻辑**：
```kotlin
// 权限检查
if (!player.hasPermission("tsl.kiss.use.click")) return

// 个人开关检查
if (!manager.isPlayerEnabled(player.uniqueId)) {
    提示"你的亲吻功能已禁用"
}

// 冷却检查（带提示）
if (manager.isInCooldown(...)) {
    提示"请等待 X 秒后再使用"
}

// 目标玩家开关检查
if (!manager.isPlayerEnabled(entity.uniqueId)) {
    提示"XXX 拒绝被亲吻"
}
```

**修改后的逻辑**：
```kotlin
// 快速检查：Shift、目标是玩家、功能启用

// 冷却检查（静默）
if (manager.isInCooldown(...) && !sender.hasPermission("tsl.kiss.bypass")) {
    return  // 静默返回
}

// 不能亲自己
// 执行亲吻（不检查任何开关状态）
```

**移除的检查**：
- ❌ 权限检查 `tsl.kiss.use.click`
- ❌ 个人开关检查（发起者）
- ❌ 冷却时间提示
- ❌ 目标玩家开关检查

---

### 3. config.yml

**删除的消息配置**：
```yaml
# 移除以下不再使用的消息
no_permission: "..."        # 不再检查权限
player_disabled: "..."      # 不再检查发起者开关
target_disabled: "..."      # 不再检查目标开关
cooldown: "..."            # 不再提示冷却
```

**保留的消息配置**：
```yaml
disabled: "..."             # 功能禁用提示
console_only: "..."         # 控制台执行提示
player_not_found: "..."     # 玩家不在线
cannot_kiss_self: "..."     # 不能亲自己
kiss_sent: "..."           # 发起者收到的消息
kiss_received: "..."       # 目标收到的消息
toggle_enabled: "..."      # 开关切换消息
toggle_disabled: "..."     # 开关切换消息
usage: "..."               # 用法说明
```

---

## 功能行为变化

### 调整前

| 场景 | 行为 |
|------|------|
| 玩家A关闭了kiss功能 | ❌ 无法亲吻别人，提示"你的功能已禁用" |
| 玩家B关闭了kiss功能 | ❌ 无法被亲吻，提示"XXX拒绝被亲吻" |
| 玩家无 `tsl.kiss.use` 权限 | ❌ 无法使用命令，提示"无权限" |
| 玩家无 `tsl.kiss.use.click` 权限 | ❌ 无法使用快捷键 |
| 冷却中 | ❌ 无法亲吻，提示"请等待X秒" |

### 调整后

| 场景 | 行为 |
|------|------|
| 玩家A关闭了kiss功能 | ✅ **仍可以亲吻别人**（开关不影响） |
| 玩家B关闭了kiss功能 | ✅ **仍可以被亲吻**（开关不影响） |
| 任何玩家 | ✅ **默认拥有所有权限**（除bypass） |
| 冷却中 | ⚠️ **静默拒绝**（无提示，直接不执行） |
| 有 bypass 权限 | ✅ **无视冷却限制** |

---

## 个人开关功能的新定义

### 调整前
- `toggle` 开关控制：能否亲吻别人 + 能否被别人亲吻

### 调整后
- `toggle` 开关**不再生效**（保留命令但无实际作用）
- 所有玩家都可以：
  - ✅ 亲吻任何人
  - ✅ 被任何人亲吻
- 只有冷却时间限制（静默）

> **注意**：虽然 `/tsl kiss toggle` 命令还在，但它不再影响亲吻行为。可以考虑在后续版本中完全移除此命令。

---

## 权限变化

### 调整前
| 权限 | 说明 | 默认 |
|------|------|------|
| `tsl.kiss.use` | 使用命令 | ❌ OP |
| `tsl.kiss.use.click` | 使用快捷键 | ❌ OP |
| `tsl.kiss.bypass` | 无视冷却 | ❌ OP |

### 调整后
| 权限 | 说明 | 默认 |
|------|------|------|
| ~~`tsl.kiss.use`~~ | ~~使用命令~~ | ✅ **所有人** |
| ~~`tsl.kiss.use.click`~~ | ~~使用快捷键~~ | ✅ **所有人** |
| `tsl.kiss.bypass` | 无视冷却 | ❌ OP |

**实际效果**：
- 所有玩家默认可以使用 Kiss 功能
- 只有 OP 或有 bypass 权限的玩家可以无视冷却

---

## 用户体验变化

### 优势
1. ✅ **更简单** - 无需配置权限，所有人都能用
2. ✅ **更流畅** - 没有各种提示打断体验
3. ✅ **更友好** - 不会被"拒绝"，增加互动性
4. ✅ **更安静** - 冷却限制静默执行

### 注意事项
1. ⚠️ 无法防止被骚扰（之前的开关失效）
2. ⚠️ 冷却中无提示（玩家可能不知道为什么没反应）
3. ⚠️ toggle 命令保留但无用（可能需要文档说明）

---

## 测试要点

请测试以下场景：

### 基本功能
- ✅ 任何玩家使用 `/tsl kiss <玩家>` 都能亲吻
- ✅ 任何玩家使用 `Shift + 右键` 都能亲吻
- ✅ 冷却时间静默生效（连续亲吻时第二次无反应）
- ✅ bypass 权限可以无视冷却

### 边界情况
- ✅ 关闭功能的玩家仍可以亲吻别人
- ✅ 关闭功能的玩家仍可以被别人亲吻
- ✅ 冷却中不会有任何提示
- ✅ 不能亲自己（仍有提示）
- ✅ 亲吻离线玩家（仍有提示）

---

## 修改的文件

1. ✅ `Kiss/KissCommand.kt` - 移除权限和开关检查
2. ✅ `Kiss/KissListener.kt` - 移除权限和开关检查
3. ✅ `config.yml` - 删除不再使用的消息配置

---

## 总结

Kiss 功能已按照新需求完成优化：

1. ✅ **简化了逻辑** - 移除了复杂的权限和开关检查
2. ✅ **提升了体验** - 静默处理冷却，无打扰提示
3. ✅ **更加开放** - 所有玩家都可以自由互动
4. ✅ **保留核心** - 冷却机制和bypass权限仍然有效

**核心理念**：Kiss 功能从"可选的互动"变为"默认的社交功能"，降低了使用门槛，提升了趣味性。

