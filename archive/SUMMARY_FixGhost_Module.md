# FixGhost æ¨¡å—å¼€å‘æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

ä¸º TSLplugins æ’ä»¶æ–°å¢äº† **FixGhostï¼ˆå¹½çµæ–¹å—æ¸…ç†ï¼‰** åŠŸèƒ½æ¨¡å—ï¼Œå…è®¸æ™®é€šç©å®¶åœ¨ Folia 1.21.8 æœåŠ¡å™¨ä¸Šè‡ªåŠ©æ¸…ç†é™„è¿‘çš„å¹½çµæ–¹å—ï¼ˆ`moving_piston`ï¼‰ï¼Œæ— éœ€ OP æƒé™ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **å‘½ä»¤**: `/tsl fixghost [åŠå¾„]`
- **é»˜è®¤åŠå¾„**: 5 æ ¼
- **æœ€å¤§åŠå¾„**: 5 æ ¼ï¼ˆå¯é…ç½®ï¼Œé˜²æ­¢æ»¥ç”¨ï¼‰
- **ç›®æ ‡æ–¹å—**: `minecraft:moving_piston`ï¼ˆæ´»å¡æ¨åŠ¨æ—¶äº§ç”Ÿçš„å¹½çµæ–¹å—ï¼‰
- **æ‰«æèŒƒå›´**: ä»¥ç©å®¶ä¸ºä¸­å¿ƒçš„ç«‹æ–¹ä½“åŒºåŸŸ `[-r, r] x [-r, r] x [-r, r]`

### å®‰å…¨ç‰¹æ€§
- âœ… **Folia åŸç”Ÿæ”¯æŒ** - ä½¿ç”¨ Entity Scheduler ç¡®ä¿çº¿ç¨‹å®‰å…¨
- âœ… **åŒºå—åŠ è½½æ£€æµ‹** - ä¸ä¼šå¼ºåˆ¶åŠ è½½æœªåŠ è½½çš„åŒºå—
- âœ… **æƒé™æ§åˆ¶** - `tsl.fixghost.use`ï¼ˆé»˜è®¤ trueï¼‰
- âœ… **å†·å´æœºåˆ¶** - é˜²æ­¢é¢‘ç¹ä½¿ç”¨ï¼ˆé»˜è®¤ 5 ç§’ï¼‰
- âœ… **é…ç½®åŒ–** - æ‰€æœ‰å‚æ•°å‡å¯é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/main/kotlin/org/tsl/tSLplugins/
â””â”€â”€ FixGhost/
    â”œâ”€â”€ FixGhostManager.kt      # é…ç½®ç®¡ç†å™¨
    â””â”€â”€ FixGhostCommand.kt      # å‘½ä»¤å¤„ç†å™¨

src/main/resources/
â”œâ”€â”€ config.yml                  # æ·»åŠ  fixghost é…ç½®èŠ‚
â””â”€â”€ plugin.yml                  # æ·»åŠ æƒé™å’Œå‘½ä»¤è¯´æ˜
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. FixGhostManager.kt
**èŒè´£**: é…ç½®åŠ è½½å’Œç®¡ç†

**æ ¸å¿ƒæ–¹æ³•**:
- `loadConfig()` - ä» config.yml åŠ è½½é…ç½®
- `isEnabled()` - æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨
- `getDefaultRadius()` / `getMaxRadius()` - è·å–æ‰«æåŠå¾„
- `getCooldown()` - è·å–å†·å´æ—¶é—´
- `getMessage()` - è·å–æ ¼å¼åŒ–çš„æ¶ˆæ¯ï¼ˆæ”¯æŒå ä½ç¬¦å’Œé¢œè‰²ä»£ç ï¼‰

**é…ç½®ç¼“å­˜**:
```kotlin
private var enabled: Boolean = true
private var defaultRadius: Int = 5
private var maxRadius: Int = 5
private var cooldown: Long = 0L
private val messages: MutableMap<String, String> = mutableMapOf()
```

---

### 2. FixGhostCommand.kt
**èŒè´£**: å‘½ä»¤å¤„ç†å’Œæ–¹å—æ¸…ç†

**å…³é”®å®ç°**:
```kotlin
// ä½¿ç”¨ Folia Entity Schedulerï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
sender.scheduler.run(plugin, { _ ->
    val playerLoc = sender.location
    val world = sender.world
    var count = 0

    // æ‰«æç«‹æ–¹ä½“åŒºåŸŸ
    for (x in startX..endX) {
        for (y in startY..endY) {
            for (z in startZ..endZ) {
                val block = world.getBlockAt(x, y, z)
                
                // æ£€æŸ¥åŒºå—æ˜¯å¦åŠ è½½ï¼ˆé¿å…å¼ºåˆ¶åŠ è½½ï¼‰
                if (!block.chunk.isLoaded) continue
                
                // æ¸…ç†å¹½çµæ–¹å—
                if (block.type == Material.MOVING_PISTON) {
                    block.type = Material.AIR
                    count++
                }
            }
        }
    }
    
    sender.sendMessage("å·²æ¸…ç† $count ä¸ªå¹½çµæ–¹å—")
}, null)
```

**åŠŸèƒ½æ£€æŸ¥**:
- åŠŸèƒ½å¯ç”¨æ£€æŸ¥
- ç©å®¶èº«ä»½éªŒè¯
- æƒé™æ£€æŸ¥ `tsl.fixghost.use`
- å†·å´æ—¶é—´æ£€æŸ¥
- å‚æ•°è§£æå’ŒéªŒè¯

**Tab è¡¥å…¨**:
```kotlin
override fun tabComplete(...): List<String> {
    if (args.size == 1) {
        // æä¾› 1-5 çš„åŠå¾„å»ºè®®
        return (1..manager.getMaxRadius()).map { it.toString() }
            .filter { it.startsWith(args[0]) }
    }
    return emptyList()
}
```

---

## ğŸ“ é…ç½®æ–‡ä»¶

### config.yml
```yaml
# ========================================
# FixGhost å¹½çµæ–¹å—æ¸…ç†åŠŸèƒ½é…ç½®
# ========================================
fixghost:
  # æ˜¯å¦å¯ç”¨ FixGhost åŠŸèƒ½
  enabled: true

  # é»˜è®¤æ‰«æåŠå¾„ï¼ˆå•ä½ï¼šæ–¹å—ï¼‰
  default-radius: 5

  # æœ€å¤§æ‰«æåŠå¾„ï¼ˆå•ä½ï¼šæ–¹å—ï¼Œé˜²æ­¢æ»¥ç”¨ï¼‰
  max-radius: 5

  # å†·å´æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
  cooldown: 5.0

  # æ¶ˆæ¯é…ç½®
  messages:
    # å‘½ä»¤å‰ç¼€
    prefix: "&e[FixGhost]&r "
    # åŠŸèƒ½å·²ç¦ç”¨
    disabled: "%prefix%&cå¹½çµæ–¹å—æ¸…ç†åŠŸèƒ½å·²ç¦ç”¨"
    # æ²¡æœ‰æƒé™
    no-permission: "%prefix%&cä½ æ²¡æœ‰æƒé™ä½¿ç”¨æ­¤å‘½ä»¤"
    # ä»…ç©å®¶å¯ç”¨
    console-only: "%prefix%&cæ­¤å‘½ä»¤åªèƒ½ç”±ç©å®¶æ‰§è¡Œ"
    # å†·å´ä¸­
    cooldown: "%prefix%&cè¯·ç­‰å¾… &e%cooldown% &cç§’åå†ä½¿ç”¨"
    # æ¸…ç†æˆåŠŸ
    success: "%prefix%&aå·²æ¸…ç†ä½ é™„è¿‘ &e%radius% &aæ ¼èŒƒå›´å†…çš„ &e%count% &aä¸ªå¹½çµæ–¹å—"
```

**é…ç½®ç‰ˆæœ¬**: `config-version: 13` â†’ `14`

---

### plugin.yml
```yaml
commands:
  tsl:
    usage: |
      ...
      /tsl fixghost [åŠå¾„]
      ...

permissions:
  tsl.fixghost.use:
    description: ä½¿ç”¨å¹½çµæ–¹å—æ¸…ç†åŠŸèƒ½çš„æƒé™
    default: true
```

---

## ğŸ”— é›†æˆç‚¹

### TSLplugins.kt
```kotlin
// 1. å¯¼å…¥
import org.tsl.tSLplugins.FixGhost.FixGhostManager
import org.tsl.tSLplugins.FixGhost.FixGhostCommand

// 2. å£°æ˜ç®¡ç†å™¨
private lateinit var fixGhostManager: FixGhostManager

// 3. åˆå§‹åŒ–
fixGhostManager = FixGhostManager(this)

// 4. æ³¨å†Œå‘½ä»¤
dispatcher.registerSubCommand("fixghost", FixGhostCommand(this, fixGhostManager))

// 5. é‡è½½æ”¯æŒ
fun reloadFixGhostManager() {
    fixGhostManager.loadConfig()
}
```

### ReloadCommand.kt
```kotlin
// æ·»åŠ é‡è½½è°ƒç”¨
plugin.reloadFixGhostManager()
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç©å®¶ä½¿ç”¨
```bash
# ä½¿ç”¨é»˜è®¤åŠå¾„ï¼ˆ5æ ¼ï¼‰æ¸…ç†
/tsl fixghost

# æŒ‡å®šåŠå¾„ï¼ˆ3æ ¼ï¼‰æ¸…ç†
/tsl fixghost 3

# è¶…å‡ºæœ€å¤§åŠå¾„ä¼šè‡ªåŠ¨é™åˆ¶åˆ°æœ€å¤§å€¼
/tsl fixghost 10  # å®é™…ä½¿ç”¨ 5 æ ¼
```

### é¢„æœŸè¾“å‡º
```
[FixGhost] å·²æ¸…ç†ä½ é™„è¿‘ 5 æ ¼èŒƒå›´å†…çš„ 3 ä¸ªå¹½çµæ–¹å—
```

---

## ğŸ›¡ï¸ å®‰å…¨æ€§ä¿éšœ

### Folia å…¼å®¹æ€§
- âœ… ä½¿ç”¨ `player.scheduler.run()` ç¡®ä¿æ–¹å—æ“ä½œåœ¨æ­£ç¡®çš„çº¿ç¨‹
- âœ… æ£€æŸ¥åŒºå—åŠ è½½çŠ¶æ€ï¼Œé¿å… `Cannot asynchronously load chunks` é”™è¯¯
- âœ… æ“ä½œé™åˆ¶åœ¨ç©å®¶æ‰€åœ¨ Region å†…

### æ€§èƒ½ä¼˜åŒ–
- âœ… é…ç½®ç¼“å­˜ï¼ˆå¯åŠ¨/é‡è½½æ—¶åŠ è½½ï¼Œè¿è¡Œæ—¶é›¶å¼€é”€ï¼‰
- âœ… æœ€å¤§åŠå¾„é™åˆ¶ï¼ˆé»˜è®¤ 5 æ ¼ï¼Œæœ€å¤šæ‰«æ 11Â³ = 1331 ä¸ªæ–¹å—ï¼‰
- âœ… å†·å´æœºåˆ¶ï¼ˆé˜²æ­¢é¢‘ç¹è°ƒç”¨ï¼‰
- âœ… ä»…æ‰«æå·²åŠ è½½åŒºå—

### æƒé™æ§åˆ¶
- âœ… æƒé™èŠ‚ç‚¹ `tsl.fixghost.use`ï¼ˆé»˜è®¤æ‰€æœ‰ç©å®¶å¯ç”¨ï¼‰
- âœ… å¯é€šè¿‡ LuckPerms ç­‰æƒé™æ’ä»¶ç²¾ç»†æ§åˆ¶
- âœ… å¯é€šè¿‡é…ç½®æ–‡ä»¶å®Œå…¨ç¦ç”¨åŠŸèƒ½

---

## ğŸ“Š æŠ€æœ¯å¯¹æ¯”

| å¯¹æ¯”é¡¹ | ä¼ ç»Ÿæ–¹æ¡ˆ | FixGhost æ¨¡å— |
|--------|---------|--------------|
| æƒé™è¦æ±‚ | OP æˆ– `/fill` æƒé™ | `tsl.fixghost.use`ï¼ˆæ™®é€šç©å®¶ï¼‰ |
| ä½¿ç”¨å¤æ‚åº¦ | éœ€è¦ç²¾ç¡®åæ ‡ | ä¸€æ¡ç®€å•å‘½ä»¤ |
| Folia å…¼å®¹ | æ˜“å‡ºé”™ | åŸç”Ÿæ”¯æŒ |
| å®‰å…¨æ€§ | é«˜é£é™©ï¼ˆå¯ç ´åå»ºç­‘ï¼‰ | ä»…æ¸…ç†å¹½çµæ–¹å— |
| æ€§èƒ½å½±å“ | ä¾èµ–å®ç° | é«˜åº¦ä¼˜åŒ– |

---

## âœ… æµ‹è¯•æ¸…å•

- [x] é…ç½®æ–‡ä»¶æ­£ç¡®åŠ è½½
- [x] å‘½ä»¤æƒé™æ£€æŸ¥
- [x] å†·å´æœºåˆ¶ç”Ÿæ•ˆ
- [x] åŠå¾„å‚æ•°è§£æ
- [x] æ–¹å—æ¸…ç†é€»è¾‘
- [x] Tab è¡¥å…¨åŠŸèƒ½
- [x] é‡è½½å‘½ä»¤æ”¯æŒ
- [x] Folia çº¿ç¨‹å®‰å…¨
- [x] æœªåŠ è½½åŒºå—è·³è¿‡
- [x] æ¶ˆæ¯æ ¼å¼åŒ–å’Œé¢œè‰²ä»£ç 

---

## ğŸ¨ ä»£ç é£æ ¼

### éµå¾ªé¡¹ç›®è§„èŒƒ
- âœ… Manager-Command æ¶æ„æ¨¡å¼
- âœ… é…ç½®ç¼“å­˜æœºåˆ¶
- âœ… ç»Ÿä¸€çš„æ¶ˆæ¯å¤„ç†ï¼ˆå‰ç¼€ + å ä½ç¬¦ + é¢œè‰²ä»£ç ï¼‰
- âœ… SubCommandHandler æ¥å£å®ç°
- âœ… KDoc æ³¨é‡Š
- âœ… Kotlin ä»£ç é£æ ¼

### å‘½åè§„èŒƒ
- ç±»åï¼š`FixGhostManager`, `FixGhostCommand`
- åŒ…åï¼š`org.tsl.tSLplugins.FixGhost`
- é…ç½®èŠ‚ï¼š`fixghost`
- æƒé™èŠ‚ç‚¹ï¼š`tsl.fixghost.use`
- å‘½ä»¤ï¼š`/tsl fixghost`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **éœ€æ±‚æ–‡æ¡£**: `éœ€æ±‚.md` - è¯¦ç»†åŠŸèƒ½éœ€æ±‚
- **å¼€å‘æŒ‡å—**: `å¼€å‘è€…æŒ‡å—.md` - é¡¹ç›®æ¶æ„å’Œè§„èŒƒ
- **é…ç½®æ–‡ä»¶**: `config.yml` - å®Œæ•´é…ç½®ç¤ºä¾‹
- **æƒé™æ–‡ä»¶**: `plugin.yml` - æƒé™å’Œå‘½ä»¤å®šä¹‰

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ç›‘æ§**
   - æ·»åŠ æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
   - è®°å½•æ‰«æçš„æ–¹å—æ•°é‡

2. **åŠŸèƒ½æ‰©å±•**
   - æ”¯æŒæ¸…ç†å…¶ä»–ç±»å‹çš„"é—®é¢˜æ–¹å—"
   - æ·»åŠ ç®¡ç†å‘˜å‘½ä»¤ï¼ˆæŒ‡å®šç©å®¶ã€æ›´å¤§åŠå¾„ï¼‰

3. **ç”¨æˆ·ä½“éªŒ**
   - æ·»åŠ æ¸…ç†è¿›åº¦æç¤ºï¼ˆæ‰«æä¸­...ï¼‰
   - æ”¯æŒ ActionBar æˆ– BossBar æ˜¾ç¤ºè¿›åº¦

4. **ç»Ÿè®¡åŠŸèƒ½**
   - è®°å½•ç©å®¶æ¸…ç†æ¬¡æ•°
   - PlaceholderAPI å˜é‡æ”¯æŒ

---

## ğŸ“… å¼€å‘ä¿¡æ¯

- **å¼€å‘æ—¥æœŸ**: 2025-11-29
- **æ’ä»¶ç‰ˆæœ¬**: TSLplugins 1.0
- **é…ç½®ç‰ˆæœ¬**: 13 â†’ 14
- **ç›®æ ‡æœåŠ¡ç«¯**: MC Folia/Luminol 1.21.8
- **Kotlin ç‰ˆæœ¬**: 1.9.21

---

## âœ¨ æ€»ç»“

FixGhost æ¨¡å—æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é«˜æ€§èƒ½ã€Folia åŸç”Ÿå…¼å®¹çš„å¹½çµæ–¹å—æ¸…ç†è§£å†³æ–¹æ¡ˆï¼Œå®Œç¾èå…¥ TSLplugins çš„æ•´ä½“æ¶æ„ã€‚é€šè¿‡ç®€å•çš„å‘½ä»¤ï¼Œæ™®é€šç©å®¶å³å¯å®‰å…¨åœ°æ¸…ç†æ¸¸æˆä¸­çš„å¹½çµæ–¹å—é—®é¢˜ï¼Œæ— éœ€ OP æƒé™ï¼Œæå¤§æå‡äº†æœåŠ¡å™¨çš„ç”¨æˆ·ä½“éªŒã€‚

**æ ¸å¿ƒä¼˜åŠ¿**:
- ğŸ¯ ç®€å•æ˜“ç”¨ - ä¸€æ¡å‘½ä»¤è§£å†³é—®é¢˜
- ğŸ›¡ï¸ å®‰å…¨å¯æ§ - æƒé™ã€å†·å´ã€åŠå¾„é™åˆ¶
- âš¡ é«˜æ€§èƒ½ - é…ç½®ç¼“å­˜ã€äº‹ä»¶é©±åŠ¨
- ğŸ”§ å¯é…ç½® - æ‰€æœ‰å‚æ•°å‡å¯è°ƒæ•´
- ğŸŒ Folia å…¼å®¹ - åŸç”Ÿæ”¯æŒå¤šçº¿ç¨‹æœåŠ¡ç«¯

