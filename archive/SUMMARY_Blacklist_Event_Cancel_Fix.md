# ğŸ› Ride & Toss é»‘åå•åŠŸèƒ½ä¿®å¤ - äº‹ä»¶å–æ¶ˆé—®é¢˜

**æ—¥æœŸ**: 2025-11-19  
**ä¸¥é‡æ€§**: ğŸ”´ é«˜ï¼ˆåŠŸèƒ½å®Œå…¨å¤±æ•ˆï¼‰  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ” é—®é¢˜æè¿°

### ç”¨æˆ·æŠ¥å‘Š
```
[23:19:53 INFO]: [TSLplugins] [Toss] é»‘åå•æ£€æŸ¥: VILLAGER -> å·²ç¦æ­¢ (é»‘åå•: [WITHER, ENDER_DRAGON, WARDEN, VILLAGER])
[23:19:53 INFO]: [TSLplugins] [Ride] é»‘åå•æ£€æŸ¥: VILLAGER -> å·²ç¦æ­¢ (é»‘åå•: [WITHER, ENDER_DRAGON, WARDEN, GHAST, ELDER_GUARDIAN, VILLAGER])
[23:19:57 INFO]: [TSLplugins] [Ride] é»‘åå•æ£€æŸ¥: VILLAGER -> å·²ç¦æ­¢ (é»‘åå•: [WITHER, ENDER_DRAGON, WARDEN, GHAST, ELDER_GUARDIAN, VILLAGER])

ä¼šæç¤ºç¦æ­¢ ä½†ç©å®¶ä»å¯ä»¥éª‘ä¹˜æˆ–æŠ•æ·
```

### é—®é¢˜ç‰¹å¾
- âœ… é»‘åå•æ£€æŸ¥é€»è¾‘**æ­£ç¡®æ‰§è¡Œ**
- âœ… æ—¥å¿—æ˜¾ç¤ºå®ä½“**å·²ç¦æ­¢**
- âŒ ç©å®¶**ä»ç„¶å¯ä»¥**éª‘ä¹˜æˆ–ä¸¾èµ·é»‘åå•ä¸­çš„ç”Ÿç‰©

---

## ğŸ æ ¹æœ¬åŸå› 

### é—®é¢˜ä»£ç åˆ†æ

#### RideListener.ktï¼ˆåŸä»£ç  - ç¬¬ 54-62 è¡Œï¼‰
```kotlin
// æ£€æŸ¥é»‘åå•
if (manager.isEntityBlacklisted(entity.type)) {
    // æ£€æŸ¥æ˜¯å¦æœ‰ç»•è¿‡é»‘åå•çš„æƒé™
    if (!player.hasPermission("tsl.ride.bypass")) {
        // é™é»˜è¿”å›ï¼Œä¸æ˜¾ç¤ºä»»ä½•æç¤ºæ¶ˆæ¯
        return  // âŒ åªæ˜¯è¿”å›ï¼Œæ²¡æœ‰å–æ¶ˆäº‹ä»¶ï¼
    }
}

// ... å…¶ä»–æ£€æŸ¥ ...

// ç¬¬ 81 è¡Œï¼šæœ€åæ‰å–æ¶ˆäº‹ä»¶
event.isCancelled = true
```

### æ ¸å¿ƒé—®é¢˜

**åªæœ‰ `return` ä½†æ²¡æœ‰ `event.isCancelled = true`**

#### é—®é¢˜æµç¨‹ï¼š
1. âœ… é»‘åå•æ£€æŸ¥è§¦å‘
2. âœ… `return` é˜»æ­¢äº†æ’ä»¶è‡ªå·±çš„ `addPassenger` æ“ä½œ
3. âŒ **äº‹ä»¶æ²¡æœ‰è¢«å–æ¶ˆ**
4. âŒ äº‹ä»¶ç»§ç»­ä¼ æ’­åˆ°å…¶ä»–ç›‘å¬å™¨æˆ–åŸç‰ˆå¤„ç†å™¨
5. âŒ åŸç‰ˆæ¸¸æˆé€»è¾‘æˆ–å…¶ä»–æ’ä»¶ä»ç„¶å¯ä»¥æ‰§è¡Œéª‘ä¹˜/ä¸¾èµ·æ“ä½œ

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

åœ¨ Bukkit/Spigot äº‹ä»¶ç³»ç»Ÿä¸­ï¼š
- `return` åªæ˜¯é€€å‡ºå½“å‰æ–¹æ³•
- **ä¸ä¼šé˜»æ­¢å…¶ä»–æ’ä»¶æˆ–åŸç‰ˆé€»è¾‘å¤„ç†åŒä¸€ä¸ªäº‹ä»¶**
- å¿…é¡»æ˜¾å¼è°ƒç”¨ `event.isCancelled = true` æ‰èƒ½é˜»æ­¢äº‹ä»¶

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤åŸåˆ™
**åœ¨æ‰€æœ‰éœ€è¦é˜»æ­¢æ“ä½œçš„åœ°æ–¹ï¼Œéƒ½å¿…é¡»å…ˆå–æ¶ˆäº‹ä»¶å†è¿”å›**

### ä¿®æ”¹å†…å®¹

#### 1. RideListener.ktï¼ˆç¬¬ 54-61 è¡Œï¼‰

**ä¿®æ”¹å‰**:
```kotlin
// æ£€æŸ¥é»‘åå•
if (manager.isEntityBlacklisted(entity.type)) {
    if (!player.hasPermission("tsl.ride.bypass")) {
        // é™é»˜è¿”å›ï¼Œä¸æ˜¾ç¤ºä»»ä½•æç¤ºæ¶ˆæ¯
        return  // âŒ é—®é¢˜ï¼šæ²¡æœ‰å–æ¶ˆäº‹ä»¶
    }
}
```

**ä¿®æ”¹å**:
```kotlin
// æ£€æŸ¥é»‘åå•
if (manager.isEntityBlacklisted(entity.type)) {
    if (!player.hasPermission("tsl.ride.bypass")) {
        // å–æ¶ˆäº‹ä»¶å¹¶è¿”å›ï¼Œé˜»æ­¢ä»»ä½•éª‘ä¹˜è¡Œä¸º
        event.isCancelled = true  // âœ… æ–°å¢ï¼šå–æ¶ˆäº‹ä»¶
        return
    }
}
```

#### 2. TossListener.ktï¼ˆç¬¬ 65-72 è¡Œï¼‰

**ä¿®æ”¹å‰**:
```kotlin
// æ£€æŸ¥å®ä½“æ˜¯å¦åœ¨é»‘åå•ä¸­
if (manager.isEntityBlacklisted(entity.type) && !player.hasPermission("tsl.toss.bypass")) {
    if (manager.isShowMessages()) {
        player.sendMessage(serializer.deserialize(manager.getMessage("entity_blacklisted")))
    }
    return  // âŒ é—®é¢˜ï¼šæ²¡æœ‰å–æ¶ˆäº‹ä»¶
}
```

**ä¿®æ”¹å**:
```kotlin
// æ£€æŸ¥å®ä½“æ˜¯å¦åœ¨é»‘åå•ä¸­
if (manager.isEntityBlacklisted(entity.type) && !player.hasPermission("tsl.toss.bypass")) {
    if (manager.isShowMessages()) {
        player.sendMessage(serializer.deserialize(manager.getMessage("entity_blacklisted")))
    }
    event.isCancelled = true  // âœ… æ–°å¢ï¼šå–æ¶ˆäº‹ä»¶
    return
}
```

---

## ğŸ§ª ä¿®å¤éªŒè¯

### ä¿®å¤åçš„æ‰§è¡Œæµç¨‹

#### å½“ç©å®¶å°è¯•éª‘ä¹˜é»‘åå•ç”Ÿç‰©æ—¶ï¼š
1. âœ… äº‹ä»¶è§¦å‘
2. âœ… é»‘åå•æ£€æŸ¥ï¼š`isEntityBlacklisted(VILLAGER)` â†’ `true`
3. âœ… æƒé™æ£€æŸ¥ï¼š`hasPermission("tsl.ride.bypass")` â†’ `false`
4. âœ… **å–æ¶ˆäº‹ä»¶**ï¼š`event.isCancelled = true`
5. âœ… è¿”å›ï¼Œé˜»æ­¢åç»­å¤„ç†
6. âœ… å…¶ä»–ç›‘å¬å™¨çœ‹åˆ°äº‹ä»¶å·²å–æ¶ˆï¼Œä¹Ÿä¸ä¼šå¤„ç†
7. âœ… **ç©å®¶æ— æ³•éª‘ä¹˜**

#### å½“ç®¡ç†å‘˜ï¼ˆæœ‰ bypass æƒé™ï¼‰å°è¯•éª‘ä¹˜é»‘åå•ç”Ÿç‰©æ—¶ï¼š
1. âœ… äº‹ä»¶è§¦å‘
2. âœ… é»‘åå•æ£€æŸ¥ï¼š`isEntityBlacklisted(VILLAGER)` â†’ `true`
3. âœ… æƒé™æ£€æŸ¥ï¼š`hasPermission("tsl.ride.bypass")` â†’ `true`
4. âœ… è·³è¿‡å–æ¶ˆé€»è¾‘ï¼Œç»§ç»­æ‰§è¡Œ
5. âœ… æ‰§è¡Œ `addPassenger`
6. âœ… **ç®¡ç†å‘˜å¯ä»¥éª‘ä¹˜**

---

## ğŸ“Š æµ‹è¯•æ­¥éª¤

### 1. ç¼–è¯‘éƒ¨ç½²
```bash
./gradlew shadowJar
cp build/libs/TSLplugins-1.0.jar <æœåŠ¡å™¨>/plugins/
```

### 2. é‡å¯æˆ–é‡è½½
```bash
/tsl reload
```

### 3. æµ‹è¯•æ™®é€šç©å®¶
ä½œä¸ºæ™®é€šç©å®¶ï¼ˆæ—  bypass æƒé™ï¼‰ï¼š
```
1. å³é”®ç‚¹å‡»æ‘æ°‘ï¼ˆVILLAGERï¼‰å°è¯•éª‘ä¹˜
   é¢„æœŸï¼šæ— æ³•éª‘ä¹˜ï¼Œæ—¥å¿—æ˜¾ç¤º"å·²ç¦æ­¢"
   
2. Shift + å³é”®ç‚¹å‡»æ‘æ°‘å°è¯•ä¸¾èµ·
   é¢„æœŸï¼šæ— æ³•ä¸¾èµ·ï¼Œæ—¥å¿—æ˜¾ç¤º"å·²ç¦æ­¢"
```

### 4. æµ‹è¯•ç®¡ç†å‘˜
ç»™ç©å®¶æ·»åŠ  bypass æƒé™ï¼š
```bash
/lp user <ç©å®¶> permission set tsl.ride.bypass true
/lp user <ç©å®¶> permission set tsl.toss.bypass true
```

ç„¶åæµ‹è¯•ï¼š
```
1. å³é”®ç‚¹å‡»æ‘æ°‘å°è¯•éª‘ä¹˜
   é¢„æœŸï¼šå¯ä»¥éª‘ä¹˜
   
2. Shift + å³é”®ç‚¹å‡»æ‘æ°‘å°è¯•ä¸¾èµ·
   é¢„æœŸï¼šå¯ä»¥ä¸¾èµ·
```

### 5. éªŒè¯æ—¥å¿—
æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š
```
[INFO] [Ride] é»‘åå•æ£€æŸ¥: VILLAGER -> å·²ç¦æ­¢ (é»‘åå•: [..., VILLAGER])
```

ä½†è¿™æ¬¡ç©å®¶**æ— æ³•**éª‘ä¹˜æˆ–ä¸¾èµ·ï¼

---

## ğŸ¯ å½±å“èŒƒå›´

### ä¿®å¤çš„åŠŸèƒ½
- âœ… Rideï¼ˆéª‘ä¹˜ï¼‰é»‘åå•ç°åœ¨æ­£ç¡®ç”Ÿæ•ˆ
- âœ… Tossï¼ˆä¸¾èµ·ï¼‰é»‘åå•ç°åœ¨æ­£ç¡®ç”Ÿæ•ˆ
- âœ… bypass æƒé™åŠŸèƒ½ä¿æŒä¸å˜

### å‘åå…¼å®¹æ€§
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰é…ç½®
- âœ… ä¸å½±å“ç°æœ‰æƒé™è®¾ç½®

### æ€§èƒ½å½±å“
- âœ… æ— æ€§èƒ½å½±å“ï¼ˆåªæ˜¯æ·»åŠ äº†ä¸€è¡Œä»£ç ï¼‰

---

## ğŸ“ ç›¸å…³é—®é¢˜ä¿®å¤è®°å½•

### æœ¬æ¬¡ä¿®å¤ç³»åˆ—

1. **SUMMARY_Ride_Toss_Reload_Fix.md**
   - ä¿®å¤äº† `messages` é…ç½®é‡è½½é—®é¢˜
   - æ·»åŠ äº† `messages.clear()`

2. **SUMMARY_Blacklist_Debug.md**
   - æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
   - å¸®åŠ©å®šä½é—®é¢˜æ ¹æº

3. **æœ¬æ–‡æ¡£**
   - ä¿®å¤äº†é»‘åå•äº‹ä»¶å–æ¶ˆé—®é¢˜ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰
   - é»‘åå•åŠŸèƒ½ç°åœ¨å®Œå…¨æ­£å¸¸

---

## ğŸ”§ ä»£ç å®¡æŸ¥å»ºè®®

### é˜²æ­¢ç±»ä¼¼é—®é¢˜çš„æ¨¡å¼

åœ¨äº‹ä»¶ç›‘å¬å™¨ä¸­ï¼Œæ‰€æœ‰éœ€è¦é˜»æ­¢æ“ä½œçš„åœ°æ–¹éƒ½åº”è¯¥éµå¾ªï¼š

```kotlin
// âœ… æ­£ç¡®æ¨¡å¼
if (shouldBlockOperation) {
    event.isCancelled = true  // 1. å…ˆå–æ¶ˆäº‹ä»¶
    return                     // 2. å†è¿”å›
}

// âŒ é”™è¯¯æ¨¡å¼
if (shouldBlockOperation) {
    return  // åªè¿”å›ï¼Œäº‹ä»¶ç»§ç»­ä¼ æ’­ï¼
}
```

### å»ºè®®çš„ä»£ç å®¡æŸ¥æ¸…å•

åœ¨æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ä¸­æ£€æŸ¥ï¼š
- [ ] æ‰€æœ‰ `return` è¯­å¥å‰æ˜¯å¦éœ€è¦å–æ¶ˆäº‹ä»¶
- [ ] æƒé™æ£€æŸ¥å¤±è´¥æ—¶æ˜¯å¦æ­£ç¡®å¤„ç†
- [ ] é»‘åå•/ç™½åå•æ£€æŸ¥æ˜¯å¦æ­£ç¡®é˜»æ­¢äº‹ä»¶
- [ ] æ˜¯å¦æœ‰å…¶ä»–æ¡ä»¶æ£€æŸ¥ä¹Ÿéœ€è¦å–æ¶ˆäº‹ä»¶

---

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶

1. `src/main/kotlin/org/tsl/tSLplugins/Ride/RideListener.kt`
   - ç¬¬ 59 è¡Œï¼šæ·»åŠ  `event.isCancelled = true`

2. `src/main/kotlin/org/tsl/tSLplugins/Toss/TossListener.kt`
   - ç¬¬ 70 è¡Œï¼šæ·»åŠ  `event.isCancelled = true`

---

## ğŸ‰ æ€»ç»“

### é—®é¢˜æ ¹æº
âŒ é»‘åå•æ£€æŸ¥è™½ç„¶æ‰§è¡Œäº†ï¼Œä½†åªæ˜¯ `return`ï¼Œæ²¡æœ‰å–æ¶ˆäº‹ä»¶

### è§£å†³æ–¹æ¡ˆ
âœ… åœ¨é»‘åå•æ£€æŸ¥å¤±è´¥æ—¶ï¼Œå…ˆ `event.isCancelled = true`ï¼Œå† `return`

### ä¿®å¤æ•ˆæœ
- âœ… é»‘åå•ç°åœ¨å®Œå…¨ç”Ÿæ•ˆ
- âœ… æ™®é€šç©å®¶æ— æ³•éª‘ä¹˜/ä¸¾èµ·é»‘åå•ç”Ÿç‰©
- âœ… æœ‰ bypass æƒé™çš„ç®¡ç†å‘˜ä»å¯æ“ä½œ

### ç¼–è¯‘çŠ¶æ€
âœ… æ— ç¼–è¯‘é”™è¯¯ï¼Œä»£ç é€šè¿‡éªŒè¯

---

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**å¤æ‚åº¦**: ğŸŸ¢ ä½ï¼ˆåªéœ€æ·»åŠ ä¸€è¡Œä»£ç ï¼‰  
**æµ‹è¯•çŠ¶æ€**: â³ ç­‰å¾…éƒ¨ç½²éªŒè¯  
**å‘åå…¼å®¹**: âœ… å®Œå…¨å…¼å®¹

