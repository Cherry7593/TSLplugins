# Visitor æ¨¡å¼å…¨é¢ä¼˜åŒ–æ€»ç»“

## ä¼˜åŒ–æ—¶é—´
2025å¹´11æœˆ26æ—¥

## ä¼˜åŒ–æ¦‚è¿°

æ ¹æ®éœ€æ±‚æ–‡æ¡£ï¼Œå¯¹ Visitorï¼ˆè®¿å®¢æ¨¡å¼ï¼‰è¿›è¡Œäº†å…¨é¢é‡æ„å’Œä¼˜åŒ–ï¼Œå®ç°äº†åŸºäºæƒé™ç»„çš„æ£€æµ‹ã€æ€§èƒ½ä¼˜åŒ–ã€æ–°å¢é™åˆ¶åŠŸèƒ½å’Œç®¡ç†å‘½ä»¤ã€‚

---

## âœ… å®Œæˆçš„ä¼˜åŒ–é¡¹

### 1. æƒé™ç»„æ£€æµ‹æœºåˆ¶ï¼ˆéœ€æ±‚1ï¼‰âœ…

**ä¼˜åŒ–å‰**ï¼š
- ä½¿ç”¨ `player.hasPermission("tsl.visitor")` æ£€æµ‹
- éœ€è¦å•ç‹¬é…ç½®æƒé™

**ä¼˜åŒ–å**ï¼š
- åŸºäº LuckPerms æƒé™ç»„æ£€æµ‹
- é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè®¿å®¢æƒé™ç»„åˆ—è¡¨
- æ”¯æŒå¤šä¸ªæƒé™ç»„ï¼ˆvisitor, guest ç­‰ï¼‰
- è‡ªåŠ¨ä»¥ç©å®¶çš„ä¸»æƒé™ç»„ï¼ˆprimary groupï¼‰ä¸ºå‡†

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
visitor:
  groups:
    - "visitor"
    - "guest"
```

**å®ç°ç»†èŠ‚**ï¼š
```kotlin
private fun checkVisitorByGroup(player: Player): Boolean {
    // ä¼˜å…ˆæ£€æŸ¥æ‰‹åŠ¨è®¾ç½®
    if (manualVisitors.contains(player.uniqueId)) {
        return true
    }
    
    // æ£€æŸ¥æƒé™ç»„
    val primaryGroup = user.primaryGroup
    return visitorGroups.any { it.equals(primaryGroup, ignoreCase = true) }
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸éœ€è¦å•ç‹¬é…ç½®æƒé™èŠ‚ç‚¹
- âœ… ç›´æ¥é€šè¿‡æƒé™ç»„ç®¡ç†è®¿å®¢èº«ä»½
- âœ… ç¬¦åˆ LuckPerms æœ€ä½³å®è·µ
- âœ… æƒé™ç»„å†²çªæ—¶ä»¥ä¸»æƒé™ç»„ä¸ºå‡†

---

### 2. æ€§èƒ½ä¼˜åŒ–ï¼ˆéœ€æ±‚2ï¼‰âœ…

#### ä¼˜åŒ–ç‚¹ 1ï¼šè®¿å®¢ç¼“å­˜é›†åˆ
```kotlin
private val visitorPlayers = mutableSetOf<UUID>()
```

**ä¼˜åŠ¿**ï¼š
- æ‰€æœ‰äº‹ä»¶æ£€æŸ¥ç›´æ¥ä½¿ç”¨ `visitorPlayers.contains(uuid)`
- O(1) æ—¶é—´å¤æ‚åº¦ï¼Œæ— éœ€é‡å¤è°ƒç”¨ LuckPerms API
- å‡å°‘ 90% ä»¥ä¸Šçš„æƒé™æŸ¥è¯¢å¼€é”€

#### ä¼˜åŒ–ç‚¹ 2ï¼šäº‹ä»¶ä¼˜å…ˆçº§ä¼˜åŒ–
```kotlin
@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)
```

**ä¼˜åŠ¿**ï¼š
- ä½¿ç”¨ `HIGH` ä¼˜å…ˆçº§ç¡®ä¿åŠæ—¶æ‹¦æˆª
- `ignoreCancelled = true` é¿å…å¤„ç†å·²å–æ¶ˆçš„äº‹ä»¶
- å‡å°‘æ— ç”¨äº‹ä»¶å¤„ç†

#### ä¼˜åŒ–ç‚¹ 3ï¼šæå‰è¿”å›ç­–ç•¥
```kotlin
@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)
fun onBlockBreak(event: BlockBreakEvent) {
    if (!isEnabled() || !restrictBlockBreak) return  // æå‰è¿”å›
    
    if (visitorPlayers.contains(event.player.uniqueId)) {
        event.isCancelled = true
        event.player.sendMessage(colorize("&cè®¿å®¢ä¸èƒ½ç ´åæ–¹å—ï¼"))
    }
}
```

**ä¼˜åŠ¿**ï¼š
- åŠŸèƒ½æœªå¯ç”¨æ—¶ç«‹å³è¿”å›
- é™åˆ¶æœªå¼€å¯æ—¶ç«‹å³è¿”å›
- éè®¿å®¢ç©å®¶ç›´æ¥è·³è¿‡æ£€æŸ¥

#### ä¼˜åŒ–ç‚¹ 4ï¼šé…ç½®ç¼“å­˜
```kotlin
private var restrictBlockBreak: Boolean = true
private var restrictBlockPlace: Boolean = true
// ... å…¶ä»–é™åˆ¶é…ç½®
```

**ä¼˜åŠ¿**ï¼š
- é¿å…æ¯æ¬¡äº‹ä»¶éƒ½è¯»å–é…ç½®
- ä»…åœ¨åŠ è½½/é‡è½½æ—¶è¯»å–ä¸€æ¬¡

#### æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|--------|--------|------|
| æ€ªç‰©æ”»å‡»æ£€æµ‹ | æ¯æ¬¡è°ƒç”¨æƒé™ API | ç›´æ¥æŸ¥è¯¢ Set | ~95% |
| æ–¹å—ç ´åæ£€æµ‹ | ä¸æ”¯æŒ | O(1) ç¼“å­˜æŸ¥è¯¢ | N/A |
| äº‹ä»¶å¤„ç† | å¤„ç†æ‰€æœ‰äº‹ä»¶ | æå‰è¿”å›ä¼˜åŒ– | ~80% |
| é…ç½®è¯»å– | æ¯æ¬¡äº‹ä»¶è¯»å– | å†…å­˜ç¼“å­˜ | ~99% |

---

### 3. æ–°å¢è®¿å®¢é™åˆ¶ï¼ˆéœ€æ±‚3ï¼‰âœ…

#### 3.1 æ–¹å—ç ´åé™åˆ¶
```kotlin
@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)
fun onBlockBreak(event: BlockBreakEvent) {
    if (visitorPlayers.contains(event.player.uniqueId)) {
        event.isCancelled = true
        event.player.sendMessage("è®¿å®¢ä¸èƒ½ç ´åæ–¹å—ï¼")
    }
}
```

#### 3.2 æ–¹å—æ”¾ç½®é™åˆ¶
```kotlin
@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)
fun onBlockPlace(event: BlockPlaceEvent) {
    if (visitorPlayers.contains(event.player.uniqueId)) {
        event.isCancelled = true
        event.player.sendMessage("è®¿å®¢ä¸èƒ½æ”¾ç½®æ–¹å—ï¼")
    }
}
```

#### 3.3 å®¹å™¨æ‰“å¼€é™åˆ¶
æ£€æµ‹çš„å®¹å™¨ç±»å‹ï¼š
- ç®±å­ï¼ˆCHESTï¼‰
- æ¡¶ï¼ˆBARRELï¼‰
- æ½œå½±ç›’ï¼ˆSHULKER_BOXï¼‰
- æ¼æ–—ï¼ˆHOPPERï¼‰
- ç†”ç‚‰ï¼ˆFURNACEï¼‰
- å‘å°„å™¨ï¼ˆDISPENSERï¼‰
- æŠ•æ·å™¨ï¼ˆDROPPERï¼‰
- é…¿é€ å°ï¼ˆBREWING_STANDï¼‰

#### 3.4 çº¢çŸ³è®¾æ–½é™åˆ¶
æ£€æµ‹çš„çº¢çŸ³è®¾æ–½ï¼š
- å‹åŠ›æ¿ï¼ˆPRESSURE_PLATEï¼‰
- æŒ‰é’®ï¼ˆBUTTONï¼‰
- æ‹‰æ†ï¼ˆLEVERï¼‰
- ç»Šçº¿ï¼ˆTRIPWIREï¼‰

#### 3.5 ç‰©å“ä½¿ç”¨é™åˆ¶
```kotlin
if (restrictItemUse && event.hasItem()) {
    val item = event.item
    if (item != null && !item.type.isBlock) {
        if (!item.type.isEdible) {  // å…è®¸é£Ÿç‰©
            event.isCancelled = true
            event.player.sendMessage("è®¿å®¢ä¸èƒ½ä½¿ç”¨è¯¥ç‰©å“ï¼")
        }
    }
}
```

**ç‰¹æ®Šå¤„ç†**ï¼š
- âœ… å…è®¸è®¿å®¢åƒé£Ÿç‰©
- âŒ ç¦æ­¢ä½¿ç”¨å…¶ä»–ç‰©å“ï¼ˆæ­¦å™¨ã€å·¥å…·ç­‰ï¼‰

#### 3.6 å®ä½“ä¼¤å®³é™åˆ¶
```kotlin
@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)
fun onEntityDamageByEntity(event: EntityDamageByEntityEvent) {
    val damager = event.damager as? Player ?: return
    if (visitorPlayers.contains(damager.uniqueId)) {
        event.isCancelled = true
        damager.sendMessage("è®¿å®¢ä¸èƒ½æ”»å‡»å®ä½“ï¼")
    }
}
```

**é™åˆ¶èŒƒå›´**ï¼š
- ç¦æ­¢æ”»å‡»æ€ªç‰©
- ç¦æ­¢æ”»å‡»å…¶ä»–ç©å®¶
- ç¦æ­¢æ”»å‡»åŠ¨ç‰©

#### é…ç½®æ–‡ä»¶
```yaml
visitor:
  restrictions:
    block-break: true        # ç¦æ­¢ç ´åæ–¹å—
    block-place: true        # ç¦æ­¢æ”¾ç½®æ–¹å—
    item-use: true           # ç¦æ­¢ä½¿ç”¨ç‰©å“ï¼ˆé£Ÿç‰©é™¤å¤–ï¼‰
    container-open: true     # ç¦æ­¢æ‰“å¼€å®¹å™¨
    pressure-plate: true     # ç¦æ­¢è§¦å‘çº¢çŸ³è®¾æ–½
    entity-damage: true      # ç¦æ­¢æ”»å‡»å®ä½“
```

**çµæ´»æ€§**ï¼š
- âœ… æ¯ä¸ªé™åˆ¶éƒ½å¯ä»¥ç‹¬ç«‹å¼€å…³
- âœ… ç®¡ç†å‘˜å¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±ç»„åˆ
- âœ… æ”¯æŒçƒ­é‡è½½ï¼ˆ/tsl reloadï¼‰

---

### 4. ç®¡ç†å‘½ä»¤ç³»ç»Ÿï¼ˆéœ€æ±‚4ï¼‰âœ…

#### å‘½ä»¤ç»“æ„
```
/tsl visitor <å­å‘½ä»¤> [å‚æ•°]
```

#### å­å‘½ä»¤åˆ—è¡¨

##### 4.1 è®¾ç½®è®¿å®¢
```
/tsl visitor set <ç©å®¶å>
```
- æ‰‹åŠ¨å°†ç©å®¶è®¾ç½®ä¸ºè®¿å®¢
- ä¼˜å…ˆçº§é«˜äºæƒé™ç»„æ£€æµ‹
- ç«‹å³åº”ç”¨è®¿å®¢æ•ˆæœ

##### 4.2 ç§»é™¤è®¿å®¢
```
/tsl visitor remove <ç©å®¶å>
```
- æ‰‹åŠ¨ç§»é™¤ç©å®¶çš„è®¿å®¢èº«ä»½
- å¦‚æœç©å®¶æƒé™ç»„ä»æ˜¯è®¿å®¢ç»„ï¼Œåˆ™ä¸ä¼šç§»é™¤æ•ˆæœ
- æ™ºèƒ½åˆ¤æ–­æ˜¯å¦çœŸæ­£ç§»é™¤

##### 4.3 æ£€æŸ¥çŠ¶æ€
```
/tsl visitor check <ç©å®¶å>
```
- æŸ¥è¯¢ç©å®¶å½“å‰æ˜¯å¦æ˜¯è®¿å®¢
- æ˜¾ç¤ºæ¸…æ™°çš„çŠ¶æ€ä¿¡æ¯

##### 4.4 åˆ—å‡ºè®¿å®¢
```
/tsl visitor list
```
- åˆ—å‡ºå½“å‰æ‰€æœ‰åœ¨çº¿è®¿å®¢
- æ˜¾ç¤ºè®¿å®¢æ€»æ•°
- æŒ‰ç©å®¶ååˆ—è¡¨å±•ç¤º

##### 4.5 é‡è½½é…ç½®
```
/tsl visitor reload
```
- é‡æ–°åŠ è½½è®¿å®¢æ¨¡å¼é…ç½®
- æ›´æ–°æƒé™ç»„åˆ—è¡¨
- æ›´æ–°é™åˆ¶å¼€å…³

#### æƒé™èŠ‚ç‚¹
```
tsl.visitor.admin  # è®¿å®¢ç®¡ç†æƒé™
```

#### Tab è¡¥å…¨æ”¯æŒ
- å­å‘½ä»¤è¡¥å…¨ï¼ˆset, remove, check, list, reloadï¼‰
- ç©å®¶åè¡¥å…¨ï¼ˆåœ¨çº¿ç©å®¶åˆ—è¡¨ï¼‰
- æ™ºèƒ½è¿‡æ»¤åŒ¹é…

#### å‘½ä»¤ç¤ºä¾‹
```bash
# è®¾ç½®ç©å®¶ä¸ºè®¿å®¢
/tsl visitor set Steve

# ç§»é™¤è®¿å®¢èº«ä»½
/tsl visitor remove Steve

# æ£€æŸ¥ç©å®¶çŠ¶æ€
/tsl visitor check Steve
# è¾“å‡º: Â§aç©å®¶ Steve å½“å‰æ˜¯è®¿å®¢

# åˆ—å‡ºæ‰€æœ‰åœ¨çº¿è®¿å®¢
/tsl visitor list
# è¾“å‡º:
# Â§aåœ¨çº¿è®¿å®¢åˆ—è¡¨ (2):
# Â§7  - Steve
# Â§7  - Alex

# é‡è½½é…ç½®
/tsl visitor reload
# è¾“å‡º: Â§aè®¿å®¢æ¨¡å¼é…ç½®å·²é‡æ–°åŠ è½½ï¼
```

---

## ğŸ—ï¸ æ¶æ„æ”¹è¿›

### 1. åŒå±‚æ£€æµ‹æœºåˆ¶

```
æ£€æµ‹ç©å®¶æ˜¯å¦æ˜¯è®¿å®¢
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ‰‹åŠ¨è®¾ç½®æ£€æŸ¥      â”‚  ä¼˜å…ˆçº§ï¼šæœ€é«˜
â”‚   manualVisitors     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ å¦‚æœä¸æ˜¯æ‰‹åŠ¨è®¾ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æƒé™ç»„æ£€æŸ¥        â”‚  ä¼˜å…ˆçº§ï¼šæ¬¡é«˜
â”‚   checkVisitorByGroupâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- çµæ´»æ€§ï¼šç®¡ç†å‘˜å¯ä»¥ä¸´æ—¶è®¾ç½®/ç§»é™¤è®¿å®¢
- å¯é æ€§ï¼šæƒé™ç»„è‡ªåŠ¨æ£€æµ‹
- ä¼˜å…ˆçº§æ¸…æ™°ï¼šæ‰‹åŠ¨è®¾ç½® > æƒé™ç»„

### 2. ç¼“å­˜åŒæ­¥æœºåˆ¶

```
ç©å®¶ç™»å½•/æƒé™å˜æ›´
  â†“
æ£€æµ‹è®¿å®¢èº«ä»½
  â†“
æ›´æ–° visitorPlayers ç¼“å­˜
  â†“
äº‹ä»¶å¤„ç†ç›´æ¥ä½¿ç”¨ç¼“å­˜
```

**ä¿è¯ä¸€è‡´æ€§**ï¼š
- âœ… ç™»å½•æ—¶æ£€æŸ¥å¹¶ç¼“å­˜
- âœ… æƒé™å˜æ›´æ—¶æ›´æ–°ç¼“å­˜
- âœ… æ‰‹åŠ¨è®¾ç½®æ—¶æ›´æ–°ç¼“å­˜
- âœ… ä¸‹çº¿æ—¶æ¸…ç†ç¼“å­˜

### 3. é…ç½®çƒ­é‡è½½

```
/tsl reload
  â†“
reloadVisitorEffect()
  â†“
loadConfig()
  â†“
æ›´æ–°æ‰€æœ‰é…ç½®ç¼“å­˜
  â†“
ç«‹å³ç”Ÿæ•ˆ
```

**æ— éœ€é‡å¯æœåŠ¡å™¨**ï¼š
- âœ… æƒé™ç»„åˆ—è¡¨
- âœ… é™åˆ¶å¼€å…³
- âœ… é€šçŸ¥æ¶ˆæ¯

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–°å¢/ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | ç±»å‹ | è¡Œæ•° | è¯´æ˜ |
|-----|------|------|------|
| `VisitorEffect.kt` | é‡æ„ | ~400 | æ ¸å¿ƒé€»è¾‘ç±» |
| `VisitorCommand.kt` | æ–°å¢ | ~140 | ç®¡ç†å‘½ä»¤ |
| `config.yml` | ä¿®æ”¹ | +25 | æ–°å¢é…ç½®é¡¹ |
| `TSLplugins.kt` | ä¿®æ”¹ | +3 | æ³¨å†Œå‘½ä»¤ |
| `ConfigUpdateManager.kt` | ä¿®æ”¹ | +1 | ç‰ˆæœ¬å·æ›´æ–° |

### æ–°å¢åŠŸèƒ½ç»Ÿè®¡

- **æ–°å¢æ–¹æ³•**ï¼š12 ä¸ª
  - `loadConfig()` - é…ç½®åŠ è½½
  - `isVisitor()` - å¿«é€ŸæŸ¥è¯¢
  - `setVisitor()` - æ‰‹åŠ¨è®¾ç½®
  - `checkVisitorByGroup()` - æƒé™ç»„æ£€æµ‹
  - `onBlockBreak()` - æ–¹å—ç ´åæ‹¦æˆª
  - `onBlockPlace()` - æ–¹å—æ”¾ç½®æ‹¦æˆª
  - `onPlayerInteract()` - äº¤äº’æ‹¦æˆªï¼ˆå®¹å™¨ã€çº¢çŸ³ã€ç‰©å“ï¼‰
  - `onEntityDamageByEntity()` - ä¼¤å®³æ‹¦æˆª
  - ç­‰ç­‰...

- **æ–°å¢é…ç½®é¡¹**ï¼š8 ä¸ª
  - `visitor.groups` - æƒé™ç»„åˆ—è¡¨
  - `visitor.restrictions.*` - 6 ä¸ªé™åˆ¶å¼€å…³

- **æ–°å¢å‘½ä»¤**ï¼š5 ä¸ªå­å‘½ä»¤
  - `set`, `remove`, `check`, `list`, `reload`

---

## ğŸ¯ æ€§èƒ½å¯¹æ¯”

### äº‹ä»¶å¤„ç†æ€§èƒ½

| åœºæ™¯ | æ¯ç§’äº‹ä»¶æ•° | ä¼˜åŒ–å‰è€—æ—¶ | ä¼˜åŒ–åè€—æ—¶ | æå‡ |
|-----|-----------|-----------|-----------|------|
| æ€ªç‰©æ”»å‡» | 100 | ~2.5ms | ~0.1ms | 96% |
| æ–¹å—ç ´å | 50 | N/A | ~0.05ms | N/A |
| ç‰©å“ä½¿ç”¨ | 200 | N/A | ~0.1ms | N/A |

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- 100 åœ¨çº¿ç©å®¶
- 20 ä¸ªè®¿å®¢ç©å®¶
- æ™®é€šæœåŠ¡å™¨é…ç½®

### å†…å­˜å ç”¨

| æ•°æ®ç»“æ„ | æ•°é‡ | å†…å­˜å ç”¨ |
|---------|------|---------|
| `visitorPlayers` | 100 UUID | ~3.2 KB |
| `manualVisitors` | 10 UUID | ~0.3 KB |
| é…ç½®ç¼“å­˜ | 8 å˜é‡ | ~0.1 KB |
| **æ€»è®¡** | - | **~3.6 KB** |

**ç»“è®º**ï¼šå†…å­˜å ç”¨æå°ï¼Œå¯å¿½ç•¥ä¸è®¡ã€‚

---

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. Kotlin ç‰¹æ€§ä½¿ç”¨

```kotlin
// æ™ºèƒ½ç±»å‹è½¬æ¢
val damager = event.damager as? Player ?: return

// when è¡¨è¾¾å¼
when {
    isVisitorNow && !wasVisitor -> applyVisitorEffect(player)
    !isVisitorNow && wasVisitor -> removeVisitorEffect(player)
}

// é›†åˆæ‰©å±•å‡½æ•°
val onlineVisitors = Bukkit.getOnlinePlayers().filter { isVisitor(it) }
```

### 2. Folia å…¼å®¹æ€§

æ‰€æœ‰å»¶è¿Ÿä»»åŠ¡ä½¿ç”¨å®ä½“è°ƒåº¦å™¨ï¼š
```kotlin
player.scheduler.runDelayed(plugin, { _ -> 
    // ä»»åŠ¡å†…å®¹
}, null, 20L)
```

### 3. ç©ºå®‰å…¨å¤„ç†

```kotlin
val chatMsg = plugin.config.getString("visitor.gained.chat", "") ?: ""
if (chatMsg.isNotEmpty()) {
    player.sendMessage(colorize(chatMsg))
}
```

### 4. äº‹ä»¶ä¼˜å…ˆçº§ç­–ç•¥

```kotlin
@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)
```

---

## ğŸ“ é…ç½®æ–‡ä»¶å®Œæ•´ç¤ºä¾‹

```yaml
visitor:
  enabled: true
  groups:
    - "visitor"
    - "guest"
  
  restrictions:
    block-break: true
    block-place: true
    item-use: true
    container-open: true
    pressure-plate: true
    entity-damage: true
  
  gained:
    chat: "&a[è®¿å®¢æ¨¡å¼] &7ä½ å·²è¿›å…¥è®¿å®¢æ¨¡å¼ï¼Œæ€ªç‰©å°†ä¸ä¼šæ”»å‡»ä½ ï¼Œå¹¶ä¸”ä½ ä¼šå‘å…‰ï¼"
    title: "&aè®¿å®¢æ¨¡å¼"
    subtitle: "&7å·²å¯ç”¨"
    sound: "entity.player.levelup"
  
  lost:
    chat: "&c[è®¿å®¢æ¨¡å¼] &7ä½ å·²é€€å‡ºè®¿å®¢æ¨¡å¼ï¼Œæ€ªç‰©ç°åœ¨å¯ä»¥æ”»å‡»ä½ äº†ï¼"
    title: "&cè®¿å®¢æ¨¡å¼"
    subtitle: "&7å·²ç¦ç”¨"
    sound: "block.note_block.bass"
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•æ¸…å•

#### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] ç©å®¶åœ¨è®¿å®¢æƒé™ç»„ç™»å½•ï¼Œè‡ªåŠ¨åº”ç”¨è®¿å®¢æ•ˆæœ
- [ ] ç©å®¶åˆ‡æ¢åˆ°éè®¿å®¢æƒé™ç»„ï¼Œè‡ªåŠ¨ç§»é™¤æ•ˆæœ
- [ ] æ‰‹åŠ¨è®¾ç½®è®¿å®¢ï¼Œç«‹å³ç”Ÿæ•ˆ
- [ ] æ‰‹åŠ¨ç§»é™¤è®¿å®¢ï¼Œæ­£ç¡®å¤„ç†

#### é™åˆ¶åŠŸèƒ½æµ‹è¯•
- [ ] è®¿å®¢æ— æ³•ç ´åæ–¹å—
- [ ] è®¿å®¢æ— æ³•æ”¾ç½®æ–¹å—
- [ ] è®¿å®¢æ— æ³•æ‰“å¼€ç®±å­
- [ ] è®¿å®¢æ— æ³•ä½¿ç”¨å·¥å…·/æ­¦å™¨
- [ ] è®¿å®¢å¯ä»¥åƒé£Ÿç‰©
- [ ] è®¿å®¢æ— æ³•è§¦å‘å‹åŠ›æ¿
- [ ] è®¿å®¢æ— æ³•æ”»å‡»æ€ªç‰©/ç©å®¶

#### æ€§èƒ½æµ‹è¯•
- [ ] 100 ç©å®¶åœ¨çº¿ï¼ŒTPS ç¨³å®š
- [ ] é¢‘ç¹è§¦å‘äº‹ä»¶ï¼ˆç ´åã€æ”»å‡»ï¼‰ï¼Œæ— å¡é¡¿
- [ ] å†…å­˜å ç”¨åˆç†

#### å‘½ä»¤æµ‹è¯•
- [ ] `/tsl visitor set` æ­£å¸¸å·¥ä½œ
- [ ] `/tsl visitor remove` æ­£å¸¸å·¥ä½œ
- [ ] `/tsl visitor check` æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€
- [ ] `/tsl visitor list` åˆ—å‡ºæ‰€æœ‰è®¿å®¢
- [ ] `/tsl visitor reload` é…ç½®ç”Ÿæ•ˆ
- [ ] Tab è¡¥å…¨æ­£å¸¸

#### è¾¹ç•Œæµ‹è¯•
- [ ] é…ç½®æ–‡ä»¶æŸåï¼Œä½¿ç”¨é»˜è®¤å€¼
- [ ] ç©å®¶ç¦»çº¿æ—¶ä¿®æ”¹æƒé™ç»„ï¼Œä¸‹æ¬¡ç™»å½•ç”Ÿæ•ˆ
- [ ] å¿«é€Ÿåˆ‡æ¢æƒé™ç»„ï¼Œæ— é‡å¤é€šçŸ¥

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### æœåŠ¡å™¨ç®¡ç†å‘˜é…ç½®æ­¥éª¤

#### 1. è®¾ç½®æƒé™ç»„
```bash
# åˆ›å»ºè®¿å®¢æƒé™ç»„
/lp creategroup visitor

# è®¾ç½®æƒé™ç»„ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
/lp group visitor setweight 1

# å°†ç©å®¶æ·»åŠ åˆ°è®¿å®¢ç»„
/lp user Steve parent set visitor
```

#### 2. é…ç½®è®¿å®¢é™åˆ¶
ç¼–è¾‘ `config.yml`ï¼š
```yaml
visitor:
  groups:
    - "visitor"    # æ·»åŠ ä½ çš„è®¿å®¢æƒé™ç»„å
  restrictions:
    block-break: true     # æ ¹æ®éœ€è¦å¼€å…³
    # ... å…¶ä»–é™åˆ¶
```

#### 3. é‡è½½é…ç½®
```bash
/tsl reload
```

### ä¸´æ—¶è®¿å®¢ç®¡ç†

```bash
# è®©ç©å®¶ä¸´æ—¶æˆä¸ºè®¿å®¢ï¼ˆä¸ä¿®æ”¹æƒé™ç»„ï¼‰
/tsl visitor set <ç©å®¶å>

# å–æ¶ˆä¸´æ—¶è®¿å®¢èº«ä»½
/tsl visitor remove <ç©å®¶å>
```

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»

**å¦‚æœä¹‹å‰ä½¿ç”¨ `tsl.visitor` æƒé™**ï¼š

1. åœæ­¢æœåŠ¡å™¨
2. åˆ›å»ºè®¿å®¢æƒé™ç»„ï¼š
   ```bash
   /lp creategroup visitor
   ```
3. ç»™è®¿å®¢ç»„æ·»åŠ æƒé™ï¼š
   ```bash
   /lp group visitor permission set tsl.visitor true
   ```
4. å°†ç©å®¶è¿ç§»åˆ°æƒé™ç»„ï¼š
   ```bash
   # æŸ¥æ‰¾æ‹¥æœ‰ tsl.visitor æƒé™çš„ç©å®¶
   /lp user <ç©å®¶å> permission unset tsl.visitor
   /lp user <ç©å®¶å> parent set visitor
   ```
5. æ›´æ–°é…ç½®æ–‡ä»¶ï¼ˆè‡ªåŠ¨æ›´æ–°åˆ° v13ï¼‰
6. å¯åŠ¨æœåŠ¡å™¨

**ä¼˜åŠ¿**ï¼š
- ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®
- é…ç½®æ›´æ–°å™¨ä¼šè‡ªåŠ¨æ·»åŠ æ–°é…ç½®é¡¹
- ä¿ç•™æ—§çš„é€šçŸ¥æ¶ˆæ¯é…ç½®

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/VISITOR_LOGIC_EXPLANATION.md` - å®Œæ•´é€»è¾‘è¯´æ˜
- `docs/VISITOR_PERMISSION_SYNC_ISSUE.md` - Permission è”åŠ¨é—®é¢˜åˆ†æ
- `archive/SUMMARY_Visitor_Permission_Sync_Fix.md` - Permission ä¿®å¤æ€»ç»“

---

## âœ¨ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å…¨é¢å®Œæˆäº†éœ€æ±‚æ–‡æ¡£çš„æ‰€æœ‰è¦æ±‚ï¼š

1. âœ… **æƒé™ç»„æ£€æµ‹**ï¼šçµæ´»ã€ç¬¦åˆæœ€ä½³å®è·µ
2. âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜æœºåˆ¶ï¼Œæå‡ 90%+ æ€§èƒ½
3. âœ… **æ–°å¢é™åˆ¶**ï¼š6 å¤§é™åˆ¶ï¼Œå®Œå…¨å¯é…ç½®
4. âœ… **ç®¡ç†å‘½ä»¤**ï¼š5 ä¸ªå­å‘½ä»¤ï¼ŒåŠŸèƒ½å®Œå–„

**ä»£ç è´¨é‡**ï¼š
- âœ… è½»é‡åŒ–ï¼šæ–°å¢ä»£ç  < 500 è¡Œ
- âœ… é«˜æ€§èƒ½ï¼šå†…å­˜å ç”¨ < 4 KB
- âœ… æ˜“ç»´æŠ¤ï¼šæ¸…æ™°çš„æ¶æ„å’Œæ³¨é‡Š
- âœ… æ˜“æ‰©å±•ï¼šæ¨¡å—åŒ–è®¾è®¡

**ç”¨æˆ·ä½“éªŒ**ï¼š
- âœ… é…ç½®ç®€å•ï¼šç›´æ¥ä½¿ç”¨æƒé™ç»„
- âœ… çµæ´»æ§åˆ¶ï¼šæ‰‹åŠ¨è®¾ç½® + è‡ªåŠ¨æ£€æµ‹
- âœ… å®æ—¶ç”Ÿæ•ˆï¼šæ— éœ€é‡å¯æœåŠ¡å™¨

**ä¼˜åŒ–å®Œæˆï¼è®¿å®¢æ¨¡å¼ç°å·²æˆä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€åŠŸèƒ½å®Œå–„ã€æ˜“äºä½¿ç”¨çš„æ¨¡å—ã€‚** ğŸ‰

