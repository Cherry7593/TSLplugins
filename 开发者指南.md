# TSLplugins - å¼€å‘è€…æŒ‡å—

> æ¶æ„è®¾è®¡ã€ä»£ç è§„èŒƒã€å¼€å‘è¦ç‚¹ - ä¾›å¼€å‘è€…å’Œ AI ä½¿ç”¨

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [æ¨¡å—è¯¦è§£](#æ¨¡å—è¯¦è§£)
5. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
6. [é‡è¦æŠ€æœ¯ç‚¹](#é‡è¦æŠ€æœ¯ç‚¹)
7. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
8. [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
9. [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯

```kotlin
// é¡¹ç›®ä¿¡æ¯
name: TSLplugins
version: 1.0
language: Kotlin 1.9.21
target: Paper/Folia 1.21.8
java: 21
build: Gradle 8.5 + Kotlin DSL
config-version: 10
```

### è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–** - æ¯ä¸ªåŒ…æ˜¯ç‹¬ç«‹åŠŸèƒ½æ¨¡å—
2. **å³æ’å³ç”¨** - æ¨¡å—äº’ä¸ä¾èµ–ï¼Œå¯å•ç‹¬ç¦ç”¨
3. **äº‹ä»¶é©±åŠ¨** - ä½¿ç”¨ Bukkit/Folia äº‹ä»¶ç³»ç»Ÿ
4. **é…ç½®é©±åŠ¨** - æ‰€æœ‰è¡Œä¸ºå¯é…ç½®
5. **é…ç½®ç¼“å­˜** - å¯åŠ¨/reload æ—¶è¯»å–ï¼Œäº‹ä»¶å¤„ç†é›¶å¼€é”€

### æ ¸å¿ƒç‰¹æ€§

- âœ… Folia åŸç”Ÿæ”¯æŒï¼ˆæ— è½®è¯¢ä»»åŠ¡ï¼‰
- âœ… é…ç½®çƒ­é‡è½½ï¼ˆæ— éœ€é‡å¯ï¼‰
- âœ… æ™ºèƒ½é…ç½®æ›´æ–°ï¼ˆè‡ªåŠ¨åˆå¹¶æ–°é…ç½®ï¼‰
- âœ… PDC æ•°æ®æŒä¹…åŒ–ï¼ˆç©å®¶é…ç½®æ°¸ä¹…ä¿å­˜ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆé…ç½®ç¼“å­˜ã€äº‹ä»¶é©±åŠ¨ï¼‰

---

## æ ¸å¿ƒæ¶æ„

### é¡¹ç›®ç»“æ„

```
src/main/kotlin/org/tsl/tSLplugins/
â”‚
â”œâ”€â”€ ========== æ ¸å¿ƒç³»ç»Ÿæ–‡ä»¶ï¼ˆæ ¹ç›®å½•ï¼‰==========
â”œâ”€â”€ TSLplugins.kt                # ä¸»ç±»ï¼šåˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
â”œâ”€â”€ TSLCommand.kt                # å‘½ä»¤åˆ†å‘å™¨ï¼šç»Ÿä¸€å…¥å£ /tsl
â”œâ”€â”€ ReloadCommand.kt             # é‡è½½å‘½ä»¤ï¼šé‡è½½æ‰€æœ‰æ¨¡å—é…ç½®
â”œâ”€â”€ ConfigUpdateManager.kt       # é…ç½®æ›´æ–°ï¼šç‰ˆæœ¬æ§åˆ¶å’Œè‡ªåŠ¨æ›´æ–°
â”œâ”€â”€ PlayerDataManager.kt         # PDC ç®¡ç†å™¨ï¼šç©å®¶æ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ TSLPlaceholderExpansion.kt   # PAPI æ‰©å±•ï¼šæ•´åˆæ‰€æœ‰æ¨¡å—å˜é‡
â”‚
â”œâ”€â”€ Alias/                     # å‘½ä»¤åˆ«å
â”‚   â”œâ”€â”€ AliasManager.kt        # ç®¡ç†å™¨ï¼šåŠ è½½é…ç½®
â”‚   â”œâ”€â”€ AliasCommand.kt        # å‘½ä»¤ï¼šé‡è½½
â”‚   â””â”€â”€ DynamicAliasCommand.kt # åŠ¨æ€æ³¨å†Œ
â”‚
â”œâ”€â”€ Maintenance/               # ç»´æŠ¤æ¨¡å¼
â”‚   â”œâ”€â”€ MaintenanceManager.kt           # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ MaintenanceCommand.kt           # å‘½ä»¤
â”‚   â”œâ”€â”€ MaintenanceLoginListener.kt     # ç™»å½•æ‹¦æˆª
â”‚   â”œâ”€â”€ MaintenanceMotdListener.kt      # MOTD ä¿®æ”¹
â”‚   â””â”€â”€ MaintenancePermissionListener.kt # æƒé™æ£€æŸ¥
â”‚
â”œâ”€â”€ Scale/                     # ä½“å‹è°ƒæ•´
â”‚   â”œâ”€â”€ ScaleManager.kt        # ç®¡ç†å™¨
â”‚   â””â”€â”€ ScaleCommand.kt        # å‘½ä»¤
â”‚
â”œâ”€â”€ Hat/                       # å¸½å­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ HatManager.kt          # ç®¡ç†å™¨
â”‚   â””â”€â”€ HatCommand.kt          # å‘½ä»¤
â”‚
â”œâ”€â”€ Ping/                      # å»¶è¿ŸæŸ¥è¯¢
â”‚   â”œâ”€â”€ PingManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ PingCommand.kt         # å‘½ä»¤
â”‚   â””â”€â”€ PingPaginator.kt       # åˆ†é¡µæ˜¾ç¤º
â”‚
â”œâ”€â”€ Toss/                      # ç”Ÿç‰©ä¸¾èµ·
â”‚   â”œâ”€â”€ TossManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ TossCommand.kt         # å‘½ä»¤
â”‚   ï¿½ï¿½ï¿½â”€â”€ TossListener.kt        # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ Ride/                      # ç”Ÿç‰©éª‘ä¹˜
â”‚   â”œâ”€â”€ RideManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ RideCommand.kt         # å‘½ä»¤
â”‚   â””â”€â”€ RideListener.kt        # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ BabyLock/                  # æ°¸ä¹…å¹¼å¹´
â”‚   â”œâ”€â”€ BabyLockManager.kt     # ç®¡ç†å™¨
â”‚   â””â”€â”€ BabyLockListener.kt    # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ Kiss/                      # ç©å®¶äº²å»
â”‚   â”œâ”€â”€ KissManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ KissCommand.kt         # å‘½ä»¤
â”‚   â”œâ”€â”€ KissExecutor.kt        # æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ KissListener.kt        # ç›‘å¬å™¨
â”‚   â””â”€â”€ KissPlaceholder.kt     # PAPI æ‰©å±•
â”‚
â”œâ”€â”€ Freeze/                    # ç©å®¶å†»ç»“
â”‚   â”œâ”€â”€ FreezeManager.kt       # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ FreezeCommand.kt       # å‘½ä»¤
â”‚   â””â”€â”€ FreezeListener.kt      # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ Advancement/               # æˆå°±è¿‡æ»¤
â”‚   â”œâ”€â”€ AdvancementCount.kt    # ç»Ÿè®¡
â”‚   â”œâ”€â”€ AdvancementMessage.kt  # æ¶ˆæ¯è¿‡æ»¤
â”‚   â””â”€â”€ AdvancementCommand.kt  # å‘½ä»¤
â”‚
â”œâ”€â”€ Visitor/                   # è®¿å®¢ä¿æŠ¤
â”‚   â””â”€â”€ VisitorEffect.kt       # æ•ˆæœç®¡ç†
â”‚
â”œâ”€â”€ Permission/                # æƒé™æ£€æµ‹
â”‚   â””â”€â”€ PermissionChecker.kt   # æ£€æµ‹å™¨
â”‚
â”œâ”€â”€ Farmprotect/               # å†œç”°ä¿æŠ¤
â”‚   â””â”€â”€ FarmProtect.kt         # ç›‘å¬å™¨
â”‚
â””â”€â”€ Motd/                      # å‡ç©å®¶
    â””â”€â”€ FakePlayerMotd.kt      # MOTD ä¿®æ”¹
```

### æ¶æ„æ¨¡å¼

#### Manager-Command-Listener æ¨¡å¼

```kotlin
// æ ‡å‡†æ¨¡å—ç»“æ„
Module/
â”œâ”€â”€ ModuleManager.kt    # é…ç½®ç®¡ç†ã€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ ModuleCommand.kt    # å‘½ä»¤å¤„ç†ã€æƒé™æ£€æŸ¥
â””â”€â”€ ModuleListener.kt   # äº‹ä»¶ç›‘å¬ã€ä¸šåŠ¡é€»è¾‘
```

**Managerï¼ˆç®¡ç†å™¨ï¼‰**ï¼š
- åŠ è½½å’Œç¼“å­˜é…ç½®
- ç®¡ç†æ¨¡å—çŠ¶æ€
- æä¾›å·¥å…·æ–¹æ³•

**Commandï¼ˆå‘½ä»¤å¤„ç†å™¨ï¼‰**ï¼š
- å®ç° `SubCommandHandler` æ¥å£
- å¤„ç†å‘½ä»¤é€»è¾‘
- æä¾› Tab è¡¥å…¨

**Listenerï¼ˆç›‘å¬å™¨ï¼‰**ï¼š
- ç›‘å¬ Bukkit äº‹ä»¶
- æ‰§è¡Œä¸šåŠ¡é€»è¾‘
- è°ƒç”¨ Manager æ–¹æ³•

---

## æŠ€æœ¯æ ˆ

### è¯­è¨€å’Œå·¥å…·

```kotlin
// Kotlin
version: 1.9.21
jvmTarget: 21

// Gradle
version: 8.5
dsl: Kotlin DSL

// Shadow
version: 8.1.1  // æ‰“åŒ… Kotlin æ ‡å‡†åº“
```

### æ ¸å¿ƒä¾èµ–

```kotlin
// å¿…éœ€
compileOnly("io.papermc.paper:paper-api:1.21.8-R0.1-SNAPSHOT")
implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")

// å¯é€‰
compileOnly("net.luckperms:api:5.4")          // è®¿å®¢ä¿æŠ¤
compileOnly("me.clip:placeholderapi:2.11.6")  // å˜é‡æ”¯æŒ
```

### Maven ä»“åº“

```kotlin
repositories {
    mavenCentral()
    maven("https://repo.papermc.io/repository/maven-public/")
    maven("https://repo.extendedclip.com/content/repositories/placeholderapi/")
}
```

---

## æ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### ä¸ºä»€ä¹ˆè¿™äº›æ–‡ä»¶æ”¾åœ¨æ ¹ç›®å½•ï¼Ÿ

æ ¹ç›®å½•çš„æ–‡ä»¶æ˜¯**è·¨æ¨¡å—çš„æ ¸å¿ƒç³»ç»Ÿ**ï¼Œå®ƒä»¬ä¸å±äºä»»ä½•å•ä¸€åŠŸèƒ½æ¨¡å—ï¼Œè€Œæ˜¯ä¸ºæ‰€æœ‰æ¨¡å—æä¾›åŸºç¡€æœåŠ¡ï¼š

- âœ… **TSLplugins.kt** - ä¸»ç±»ï¼Œåˆå§‹åŒ–å’Œç®¡ç†æ‰€æœ‰æ¨¡å—
- âœ… **TSLCommand.kt** - å‘½ä»¤åˆ†å‘å™¨ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰å­å‘½ä»¤
- âœ… **ReloadCommand.kt** - é‡è½½ç³»ç»Ÿï¼Œé‡è½½æ‰€æœ‰æ¨¡å—é…ç½®
- âœ… **ConfigUpdateManager.kt** - é…ç½®ç‰ˆæœ¬æ§åˆ¶ï¼Œè‡ªåŠ¨æ›´æ–°é…ç½®æ–‡ä»¶
- âœ… **PlayerDataManager.kt** - PDC æ•°æ®ç®¡ç†ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç©å®¶æ•°æ®
- âœ… **TSLPlaceholderExpansion.kt** - PAPI æ‰©å±•ï¼Œæ•´åˆæ‰€æœ‰æ¨¡å—çš„å˜é‡

è¿™äº›æ–‡ä»¶æ˜¯**æ•´ä¸ªæ’ä»¶çš„åŸºç¡€è®¾æ–½**ï¼Œå¦‚æœæ”¾åœ¨æŸä¸ªåŠŸèƒ½æ¨¡å—åŒ…å†…ä¼šå¯¼è‡´ï¼š
- âŒ æ¶æ„æ··ä¹±ï¼ˆåŸºç¡€è®¾æ–½ä¸åº”å±äºä¸šåŠ¡æ¨¡å—ï¼‰
- âŒ å¾ªç¯ä¾èµ–é—®é¢˜
- âŒ éš¾ä»¥ç†è§£ç³»ç»Ÿå±‚æ¬¡

---

### 1. TSLplugins.kt - ä¸»ç±»

**ä½œç”¨**ï¼šæ’ä»¶çš„å…¥å£ç‚¹ï¼Œè´Ÿè´£åˆå§‹åŒ–å’Œç®¡ç†æ‰€æœ‰æ¨¡å—ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- åˆå§‹åŒ–é…ç½®æ›´æ–°ç®¡ç†å™¨
- åˆå§‹åŒ– PDC æ•°æ®ç®¡ç†å™¨
- æ³¨å†Œæ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„ Managerã€Commandã€Listener
- æ³¨å†Œ PlaceholderAPI æ‰©å±•
- æä¾›é‡è½½æ¥å£ç»™ ReloadCommand

**ä»£ç ç»“æ„**ï¼š
```kotlin
class TSLplugins : JavaPlugin() {
    // 1. å£°æ˜æ‰€æœ‰ Manager
    private lateinit var kissManager: KissManager
    private lateinit var freezeManager: FreezeManager
    // ...
    
    override fun onEnable() {
        // 2. é…ç½®æ›´æ–°æ£€æŸ¥
        ConfigUpdateManager(this).checkAndUpdate()
        reloadConfig()
        
        // 3. åˆå§‹åŒ–æ ¸å¿ƒç³»ç»Ÿ
        playerDataManager = PlayerDataManager(this)
        
        // 4. åˆå§‹åŒ–å„ä¸ªæ¨¡å—
        kissManager = KissManager(this, playerDataManager)
        // ...
        
        // 5. æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
        server.pluginManager.registerEvents(...)
        
        // 6. æ³¨å†Œå‘½ä»¤
        val dispatcher = TSLCommand()
        dispatcher.registerSubCommand("kiss", KissCommand(...))
        // ...
        
        // 7. æ³¨å†Œ PAPI æ‰©å±•
        TSLPlaceholderExpansion(...).register()
    }
    
    // 8. æä¾›é‡è½½æ–¹æ³•
    fun reloadKissManager() {
        kissManager.loadConfig()
    }
}
```

**å¼€å‘è¦ç‚¹**ï¼š
- âš ï¸ æ·»åŠ æ–°æ¨¡å—æ—¶å¿…é¡»åœ¨æ­¤ç±»ä¸­åˆå§‹åŒ–
- âš ï¸ å¿…é¡»æä¾›å¯¹åº”çš„ `reloadXxxManager()` æ–¹æ³•
- âš ï¸ æ³¨æ„åˆå§‹åŒ–é¡ºåºï¼ˆæœ‰ä¾èµ–çš„ååˆå§‹åŒ–ï¼‰

---

### 2. TSLCommand.kt - å‘½ä»¤åˆ†å‘å™¨

**ä½œç”¨**ï¼šç»Ÿä¸€çš„å‘½ä»¤å…¥å£ï¼Œå°† `/tsl <å­å‘½ä»¤>` åˆ†å‘ç»™å„ä¸ªæ¨¡å—çš„å‘½ä»¤å¤„ç†å™¨ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- æ³¨å†Œæ‰€æœ‰å­å‘½ä»¤å¤„ç†å™¨
- åˆ†å‘å‘½ä»¤åˆ°å¯¹åº”çš„ Handler
- æä¾›ç»Ÿä¸€çš„ Tab è¡¥å…¨
- æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

**ä»£ç ç»“æ„**ï¼š
```kotlin
class TSLCommand : CommandExecutor, TabCompleter {
    private val subCommands = mutableMapOf<String, SubCommandHandler>()
    
    fun registerSubCommand(name: String, handler: SubCommandHandler) {
        subCommands[name.lowercase()] = handler
    }
    
    override fun onCommand(...): Boolean {
        if (args.isEmpty()) {
            showHelp(sender)
            return true
        }
        
        val subCommand = args[0].lowercase()
        val handler = subCommands[subCommand]
        
        return if (handler != null) {
            handler.handle(sender, command, label, args.drop(1).toTypedArray())
        } else {
            sender.sendMessage("æœªçŸ¥å‘½ä»¤")
            true
        }
    }
}
```

**å¼€å‘è¦ç‚¹**ï¼š
- âœ… æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„å‘½ä»¤éƒ½é€šè¿‡æ­¤ç±»æ³¨å†Œ
- âœ… æ–°å¢å‘½ä»¤æ—¶åœ¨ `TSLplugins.kt` ä¸­è°ƒç”¨ `registerSubCommand()`
- âœ… å‘½ä»¤å¤„ç†å™¨å¿…é¡»å®ç° `SubCommandHandler` æ¥å£

---

### 3. ReloadCommand.kt - é‡è½½ç³»ç»Ÿ

**ä½œç”¨**ï¼šé‡è½½æ‰€æœ‰æ¨¡å—çš„é…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡å™¨ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- é‡è½½ä¸»é…ç½®æ–‡ä»¶
- è°ƒç”¨æ‰€æœ‰ Manager çš„ `loadConfig()` æ–¹æ³•
- é‡æ–°åŠ è½½åˆ«åç³»ç»Ÿ
- æ˜¾ç¤ºé‡è½½ç»“æœ

**ä»£ç ç»“æ„**ï¼š
```kotlin
class ReloadCommand(private val plugin: TSLplugins) : SubCommandHandler {
    
    override fun handle(...): Boolean {
        // 1. æƒé™æ£€æŸ¥
        if (!sender.hasPermission("tsl.reload")) {
            sender.sendMessage("æ— æƒé™")
            return true
        }
        
        // 2. é‡è½½ä¸»é…ç½®
        plugin.reloadConfig()
        
        // 3. é‡è½½æ‰€æœ‰æ¨¡å—
        plugin.reloadKissManager()
        plugin.reloadFreezeManager()
        plugin.reloadTossManager()
        plugin.reloadRideManager()
        plugin.reloadScaleManager()
        plugin.reloadHatManager()
        plugin.reloadPingManager()
        plugin.reloadBabyLockManager()
        plugin.reloadMaintenanceManager()
        
        // 4. é‡è½½ç‰¹æ®Šç³»ç»Ÿ
        val aliasCount = plugin.reloadAliasManager()
        
        // 5. æ˜¾ç¤ºç»“æœ
        sender.sendMessage("é…ç½®é‡è½½å®Œæˆï¼")
        sender.sendMessage("- å·²é‡è½½ $aliasCount ä¸ªå‘½ä»¤åˆ«å")
        
        return true
    }
}
```

**å¼€å‘è¦ç‚¹**ï¼š
- âš ï¸ **è¿™æ˜¯æœ€é‡è¦çš„è·¨æ¨¡å—æ–‡ä»¶**
- âš ï¸ æ·»åŠ æ–°æ¨¡å—æ—¶**å¿…é¡»**åœ¨æ­¤å¤„æ·»åŠ é‡è½½è°ƒç”¨
- âš ï¸ é‡è½½é¡ºåºï¼šä¸»é…ç½® â†’ å„æ¨¡å— Manager â†’ ç‰¹æ®Šç³»ç»Ÿ
- âš ï¸ å¿…é¡»æä¾›é‡è½½åé¦ˆç»™ç”¨æˆ·

**ä¸ºä»€ä¹ˆé‡è½½å¾ˆé‡è¦ï¼Ÿ**
- é…ï¿½ï¿½ç¼“å­˜æœºåˆ¶éœ€è¦æ‰‹åŠ¨åˆ·æ–°
- é¿å…é¢‘ç¹é‡å¯æœåŠ¡å™¨
- æä¾›æ›´å¥½çš„ç®¡ç†ä½“éªŒ

---

### 4. ConfigUpdateManager.kt - é…ç½®ç‰ˆæœ¬æ§åˆ¶

**ä½œç”¨**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œæ›´æ–°é…ç½®æ–‡ä»¶ç‰ˆæœ¬ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- æ£€æµ‹é…ç½®æ–‡ä»¶ç‰ˆæœ¬
- å¤‡ä»½æ—§é…ç½®
- åˆå¹¶æ–°æ—§é…ç½®ï¼ˆä¿ç•™ç”¨æˆ·å€¼ï¼Œæ·»åŠ æ–°é…ç½®é¡¹ï¼‰
- ä¿ç•™æ³¨é‡Šå’Œæ ¼å¼

**ç‰ˆæœ¬æ§åˆ¶**ï¼š
```kotlin
companion object {
    const val CURRENT_CONFIG_VERSION = 10  // âš ï¸ å½“å‰ç‰ˆæœ¬
}
```

**æ›´æ–°æµç¨‹**ï¼š
```
1. æ£€æµ‹ç‰ˆæœ¬ä¸ä¸€è‡´
2. å¤‡ä»½åˆ° config.yml.backup
3. è¯»å–é»˜è®¤é…ç½®ï¼ˆä¿ç•™æ³¨é‡Šï¼‰
4. è¯»å–ç”¨æˆ·é…ç½®å€¼
5. åˆå¹¶é…ç½®
6. ä¿å­˜æ–°é…ç½®
```

**å¼€å‘è¦ç‚¹**ï¼š
- âš ï¸ ä¿®æ”¹é…ç½®æ–‡ä»¶åå¿…é¡»é€’å¢ `CURRENT_CONFIG_VERSION`
- âš ï¸ åœ¨ `TSLplugins.onEnable()` ä¸­ç¬¬ä¸€ä¸ªæ‰§è¡Œ
- âš ï¸ ç¡®ä¿åœ¨ `reloadConfig()` ä¹‹å‰è¿è¡Œ

---

### 5. PlayerDataManager.kt - PDC æ•°æ®ç®¡ç†

**ä½œç”¨**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ¨¡å—çš„ç©å®¶æŒä¹…åŒ–æ•°æ®ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- å®šä¹‰æ‰€æœ‰ PDC Keysï¼ˆé¿å…é”®åå†²çªï¼‰
- æä¾›ç»Ÿä¸€çš„æ•°æ®è¯»å†™æ¥å£
- æ”¯æŒå¤šç§æ•°æ®ç±»å‹

**ä»£ç ç»“æ„**ï¼š
```kotlin
class PlayerDataManager(private val plugin: JavaPlugin) {
    
    // ===== PDC Keys å®šä¹‰ =====
    private val kissToggleKey = NamespacedKey(plugin, "kiss_toggle")
    private val rideToggleKey = NamespacedKey(plugin, "ride_toggle")
    private val tossToggleKey = NamespacedKey(plugin, "toss_toggle")
    private val tossVelocityKey = NamespacedKey(plugin, "toss_velocity")
    
    // ===== Kiss åŠŸèƒ½ =====
    fun getKissToggle(player: Player, defaultValue: Boolean = true): Boolean {
        val pdc = player.persistentDataContainer
        return if (pdc.has(kissToggleKey, PersistentDataType.BOOLEAN)) {
            pdc.get(kissToggleKey, PersistentDataType.BOOLEAN) ?: defaultValue
        } else {
            defaultValue
        }
    }
    
    fun setKissToggle(player: Player, enabled: Boolean) {
        player.persistentDataContainer.set(
            kissToggleKey,
            PersistentDataType.BOOLEAN,
            enabled
        )
    }
    
    // ===== å…¶ä»–åŠŸèƒ½æ•°æ®... =====
}
```

**å¼€å‘è¦ç‚¹**ï¼š
- âš ï¸ æ‰€æœ‰ PDC æ•°æ®å¿…é¡»é€šè¿‡æ­¤ç±»ç®¡ç†
- âš ï¸ é”®åæ ¼å¼ï¼š`tsl:åŠŸèƒ½å_æ•°æ®å`
- âš ï¸ æ–°å¢æ•°æ®å­˜å‚¨æ—¶åœ¨æ­¤ç±»æ·»åŠ æ–¹æ³•
- âš ï¸ Manager é€šè¿‡ä¾èµ–æ³¨å…¥ä½¿ç”¨æ­¤ç±»

**ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€ç®¡ç†ï¼Ÿ**
- é¿å…é”®åå†²çª
- ç®€åŒ–æ•°æ®è®¿é—®ä»£ç 
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

---

### 6. TSLPlaceholderExpansion.kt - PAPI å˜é‡æ•´åˆ

**ä½œç”¨**ï¼šæ•´åˆæ‰€æœ‰æ¨¡å—çš„ PlaceholderAPI å˜é‡ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- æ³¨å†Œæ’ä»¶æ ‡è¯†ç¬¦ `%tsl_xxx%`
- å¤„ç†æ‰€æœ‰æ¨¡å—çš„å˜é‡è¯·æ±‚
- æä¾›ç»Ÿä¸€çš„å˜é‡æ¥å£

**ä»£ç ç»“æ„**ï¼š
```kotlin
class TSLPlaceholderExpansion(
    private val plugin: JavaPlugin,
    private val countHandler: AdvancementCount,
    private val pingManager: PingManager?,
    private val kissManager: KissManager?,
    private val rideManager: RideManager?,
    private val tossManager: TossManager?
) : PlaceholderExpansion() {
    
    override fun getIdentifier(): String = "tsl"
    override fun getVersion(): String = "1.0"
    
    override fun onRequest(player: OfflinePlayer?, params: String): String? {
        // Ping å˜é‡ï¼ˆå…¨å±€ï¼‰
        if (params == "ping") {
            return pingManager?.getAveragePing()?.toString() ?: "N/A"
        }
        
        // éœ€è¦ç©å®¶çš„å˜é‡
        if (player == null) return null
        
        // æˆå°±ç»Ÿè®¡
        if (params == "adv_count") {
            return countHandler.getAdvancementCount(player.player ?: return null).toString()
        }
        
        // Kiss ç»Ÿè®¡
        when (params) {
            "kiss_count" -> return kissManager?.getKissCount(player.uniqueId)?.toString()
            "kissed_count" -> return kissManager?.getKissedCount(player.uniqueId)?.toString()
            "kiss_toggle" -> { /* ... */ }
        }
        
        // å…¶ä»–æ¨¡å—å˜é‡...
        
        return null
    }
}
```

**æ”¯æŒçš„å˜é‡**ï¼š
- `%tsl_ping%` - æœåŠ¡å™¨å¹³å‡å»¶è¿Ÿ
- `%tsl_adv_count%` - ç©å®¶æˆå°±æ•°é‡
- `%tsl_kiss_count%` - äº²å»æ¬¡æ•°
- `%tsl_kissed_count%` - è¢«äº²å»æ¬¡æ•°
- `%tsl_kiss_toggle%` - Kiss å¼€å…³çŠ¶æ€
- `%tsl_ride_toggle%` - Ride å¼€å…³çŠ¶æ€
- `%tsl_toss_toggle%` - Toss å¼€å…³çŠ¶æ€
- `%tsl_toss_velocity%` - Toss æŠ•æ·é€Ÿåº¦

**å¼€å‘è¦ç‚¹**ï¼š
- âš ï¸ æ‰€æœ‰ PAPI å˜é‡éƒ½åœ¨æ­¤ç±»ä¸­å¤„ç†
- âš ï¸ æ–°å¢å˜é‡æ—¶åœ¨ `onRequest()` æ–¹æ³•ä¸­æ·»åŠ 
- âš ï¸ åœ¨ `TSLplugins.kt` ä¸­æ³¨å†Œæ­¤æ‰©å±•
- âš ï¸ Manager éœ€è¦æä¾›å¯¹åº”çš„æ•°æ®è®¿é—®æ–¹æ³•

**ä¸ºä»€ä¹ˆæ•´åˆåˆ°ä¸€ä¸ªç±»ï¼Ÿ**
- é¿å…æ³¨å†Œå¤šä¸ªæ‰©å±•ï¼ˆæ€§èƒ½ï¼‰
- ç»Ÿä¸€ç®¡ç†å˜é‡ï¼ˆç»´æŠ¤æ€§ï¼‰
- ç»Ÿä¸€æ ‡è¯†ç¬¦ `tsl`ï¼ˆç”¨æˆ·ä½“éªŒï¼‰

---

### æ ¹ç›®å½•æ–‡ä»¶çš„ä¾èµ–å…³ç³»

```
TSLplugins.kt (ä¸»ç±»)
    â”œâ”€â”€ ä¾èµ– â†’ ConfigUpdateManager.kt (é…ç½®æ›´æ–°)
    â”œâ”€â”€ ä¾èµ– â†’ PlayerDataManager.kt (æ•°æ®ç®¡ç†)
    â”œâ”€â”€ ä¾èµ– â†’ TSLCommand.kt (å‘½ä»¤åˆ†å‘)
    â”œâ”€â”€ ä¾èµ– â†’ ReloadCommand.kt (é‡è½½ç³»ç»Ÿ)
    â”œâ”€â”€ ä¾èµ– â†’ TSLPlaceholderExpansion.kt (PAPI)
    â””â”€â”€ ä¾èµ– â†’ å„æ¨¡å—çš„ Manager/Command/Listener

TSLCommand.kt (å‘½ä»¤åˆ†å‘å™¨)
    â””â”€â”€ ä¾èµ– â†’ å„æ¨¡å—çš„ Command (å®ç° SubCommandHandler)

ReloadCommand.kt (é‡è½½ç³»ç»Ÿ)
    â””â”€â”€ ä¾èµ– â†’ TSLplugins (è°ƒç”¨å„æ¨¡å—çš„ reload æ–¹æ³•)

PlayerDataManager.kt (PDC ç®¡ç†)
    â””â”€â”€ è¢«ä¾èµ– â† å„æ¨¡å—çš„ Manager

TSLPlaceholderExpansion.kt (PAPI)
    â””â”€â”€ ä¾èµ– â†’ å„æ¨¡å—çš„ Manager (è·å–æ•°æ®)

ConfigUpdateManager.kt (é…ç½®æ›´æ–°)
    â””â”€â”€ ç‹¬ç«‹è¿è¡Œï¼ˆä»…è¢« TSLplugins è°ƒç”¨ä¸€æ¬¡ï¼‰
```

---

## æ¨¡å—è¯¦è§£

### é…ç½®ç¼“å­˜æ¨¡å¼ï¼ˆé‡è¦ï¼ï¼‰

**æ‰€æœ‰æ¨¡å—éƒ½ä½¿ç”¨é…ç½®ç¼“å­˜**ï¼Œè¿™æ˜¯æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–ï¼š

```kotlin
class FeatureManager(private val plugin: JavaPlugin) {
    // âœ… ç¼“å­˜é…ç½®å€¼
    private var enabled: Boolean = true
    private var maxValue: Int = 10
    private val blacklist: MutableSet<EntityType> = mutableSetOf()
    
    init {
        loadConfig()
    }
    
    // âœ… åŠ è½½é…ç½®åˆ°ç¼“å­˜
    fun loadConfig() {
        val config = plugin.config
        enabled = config.getBoolean("feature.enabled", true)
        maxValue = config.getInt("feature.max_value", 10)
        
        // åŠ è½½é›†åˆç±»å‹
        blacklist.clear()
        config.getStringList("feature.blacklist").forEach { name ->
            try {
                blacklist.add(EntityType.valueOf(name.uppercase()))
            } catch (e: IllegalArgumentException) {
                plugin.logger.warning("æ— æ•ˆçš„å®ä½“ç±»å‹: $name")
            }
        }
    }
    
    // âœ… ç›´æ¥è¯»å–ç¼“å­˜ï¼ˆé›¶å¼€é”€ï¼‰
    fun isEnabled(): Boolean = enabled
    fun getMaxValue(): Int = maxValue
    fun isBlacklisted(type: EntityType): Boolean = blacklist.contains(type)
}
```

**Listener ä½¿ç”¨ç¼“å­˜**ï¼š

```kotlin
class FeatureListener(
    private val plugin: JavaPlugin,
    private val manager: FeatureManager
) : Listener {
    
    @EventHandler
    fun onSomeEvent(event: SomeEvent) {
        // âœ… ç›´æ¥è¯»å–ç¼“å­˜ï¼Œé›¶å¼€é”€
        if (!manager.isEnabled()) return
        
        // âœ… é»‘åå•æ£€æŸ¥ä¹Ÿæ˜¯ç¼“å­˜
        if (manager.isBlacklisted(entity.type)) return
        
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ç¼“å­˜ï¼Ÿ**

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| ç›´æ¥è¯»å– config | å§‹ç»ˆæœ€æ–° | I/O å¼€é”€å¤§ï¼Œæ€§èƒ½å·® |
| **é…ç½®ç¼“å­˜** | **é›¶å¼€é”€ï¼Œæ€§èƒ½æœ€ä½³** | éœ€è¦æ‰‹åŠ¨é‡è½½ |

**é‡è½½æœºåˆ¶**ï¼š

```kotlin
// TSLplugins.kt
fun reloadFeatureManager() {
    featureManager.loadConfig()  // åˆ·æ–°ç¼“å­˜
}

// ReloadCommand.kt
plugin.reloadFeatureManager()  // é‡è½½æ—¶è°ƒç”¨
```

---

### SubCommandHandler æ¥å£

æ‰€æœ‰å‘½ä»¤å¤„ç†å™¨å¿…é¡»å®ç°æ­¤æ¥å£ï¼š

```kotlin
interface SubCommandHandler {
    fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean
    
    fun tabComplete(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): List<String>
    
    fun getDescription(): String = ""
}
```

**å®ç°ç¤ºä¾‹**ï¼š

```kotlin
class FeatureCommand(
    private val manager: FeatureManager
) : SubCommandHandler {
    
    override fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean {
        // 1. åŠŸèƒ½æ£€æŸ¥
        if (!manager.isEnabled()) {
            sender.sendMessage("åŠŸèƒ½å·²ç¦ç”¨")
            return true
        }
        
        // 2. ç©å®¶æ£€æŸ¥
        if (sender !is Player) {
            sender.sendMessage("ä»…ç©å®¶å¯ç”¨")
            return true
        }
        
        // 3. æƒé™æ£€æŸ¥
        if (!sender.hasPermission("tsl.feature.use")) {
            sender.sendMessage("æ— æƒé™")
            return true
        }
        
        // 4. å‚æ•°è§£æ
        when {
            args.isEmpty() -> showUsage(sender)
            args[0].equals("toggle", ignoreCase = true) -> handleToggle(sender)
            else -> showUsage(sender)
        }
        
        return true
    }
    
    override fun tabComplete(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): List<String> {
        if (!manager.isEnabled()) return emptyList()
        
        return when (args.size) {
            1 -> listOf("toggle", "status").filter { 
                it.startsWith(args[0], ignoreCase = true) 
            }
            else -> emptyList()
        }
    }
    
    override fun getDescription(): String = "åŠŸèƒ½å‘½ä»¤"
}
```

---

### Folia è°ƒåº¦å™¨ï¼ˆé‡è¦ï¼ï¼‰

Folia ä¸æ”¯æŒ Bukkit çš„ä¼ ç»Ÿè°ƒåº¦å™¨ï¼Œå¿…é¡»ä½¿ç”¨æ–°çš„ APIï¼š

#### å®ä½“è°ƒåº¦å™¨

```kotlin
// âœ… æ­£ç¡®ï¼šå®ä½“æ“ä½œä½¿ç”¨å®ä½“è°ƒåº¦å™¨
player.scheduler.run(plugin, { _ ->
    // å®ä½“ç›¸å…³æ“ä½œï¼ˆä¿®æ”¹èƒŒåŒ…ã€ä¼ é€ç­‰ï¼‰
    player.inventory.setHelmet(item)
    player.teleport(location)
}, null)

// âœ… å»¶è¿Ÿæ‰§è¡Œ
player.scheduler.runDelayed(plugin, { _ ->
    // å»¶è¿Ÿæ“ä½œ
}, null, 20L)  // å»¶è¿Ÿ 1 ç§’

// âœ… å®šæ—¶ä»»åŠ¡
player.scheduler.runAtFixedRate(plugin, { task ->
    if (!player.isOnline) {
        task.cancel()
        return@runAtFixedRate
    }
    // å®šæ—¶æ“ä½œ
}, null, 1L, 20L)  // å»¶è¿Ÿ 0.05 ç§’ï¼Œæ¯ç§’æ‰§è¡Œä¸€æ¬¡
```

#### å…¨å±€è°ƒåº¦å™¨

```kotlin
// âœ… æ­£ç¡®ï¼šå…¨å±€ä»»åŠ¡ä½¿ç”¨å…¨å±€è°ƒåº¦å™¨
Bukkit.getGlobalRegionScheduler().runAtFixedRate(plugin, { _ ->
    // å…¨å±€å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚è¿‡æœŸæ£€æŸ¥ï¼‰
}, 20L, 20L)  // å»¶è¿Ÿ 1 ç§’ï¼Œæ¯ç§’æ‰§è¡Œä¸€æ¬¡
```

#### âŒ é”™è¯¯ç¤ºä¾‹

```kotlin
// âŒ é”™è¯¯ï¼šFolia ä¸æ”¯æŒ
Bukkit.getScheduler().runTask(plugin, Runnable {
    // ...
})
```

---

### PDC æ•°æ®æŒä¹…åŒ–

ä½¿ç”¨ `PersistentDataContainer` ä¿å­˜ç©å®¶é…ç½®ï¼š

#### PlayerDataManager

```kotlin
class PlayerDataManager(private val plugin: JavaPlugin) {
    
    // PDC Keys
    private val kissToggleKey = NamespacedKey(plugin, "kiss_toggle")
    private val rideToggleKey = NamespacedKey(plugin, "ride_toggle")
    private val tossVelocityKey = NamespacedKey(plugin, "toss_velocity")
    
    // è¯»å–
    fun getKissToggle(player: Player, defaultValue: Boolean = true): Boolean {
        val pdc = player.persistentDataContainer
        return if (pdc.has(kissToggleKey, PersistentDataType.BOOLEAN)) {
            pdc.get(kissToggleKey, PersistentDataType.BOOLEAN) ?: defaultValue
        } else {
            defaultValue
        }
    }
    
    // å†™å…¥
    fun setKissToggle(player: Player, enabled: Boolean) {
        player.persistentDataContainer.set(
            kissToggleKey, 
            PersistentDataType.BOOLEAN, 
            enabled
        )
    }
}
```

#### Manager ä½¿ç”¨ PDC

```kotlin
class KissManager(
    private val plugin: JavaPlugin,
    private val dataManager: PlayerDataManager  // âœ… æ³¨å…¥
) {
    // âœ… ä» PDC è¯»å–
    fun isPlayerEnabled(player: Player): Boolean {
        return dataManager.getKissToggle(player, true)
    }
    
    // âœ… å†™å…¥ PDC
    fun togglePlayer(player: Player): Boolean {
        val current = isPlayerEnabled(player)
        val newStatus = !current
        dataManager.setKissToggle(player, newStatus)
        return newStatus
    }
}
```

**æ”¯æŒçš„æ•°æ®ç±»å‹**ï¼š
- `BOOLEAN` - å¸ƒå°”å€¼
- `INTEGER` - æ•´æ•°
- `DOUBLE` - åŒç²¾åº¦æµ®ç‚¹æ•°
- `STRING` - å­—ç¬¦ä¸²
- `BYTE_ARRAY` - å­—èŠ‚æ•°ç»„

---

### é…ç½®è‡ªåŠ¨æ›´æ–°

`ConfigUpdateManager` å®ç°é…ç½®ç‰ˆæœ¬æ§åˆ¶ï¼š

```kotlin
companion object {
    const val CURRENT_CONFIG_VERSION = 10  // âœ… æ¯æ¬¡æ›´æ–°é…ç½®æ—¶é€’å¢
}

fun checkAndUpdate(): Boolean {
    val configFile = File(plugin.dataFolder, "config.yml")
    val currentConfig = YamlConfiguration.loadConfiguration(configFile)
    val currentVersion = currentConfig.getInt("config-version", 0)
    
    // ç‰ˆæœ¬ä¸€è‡´ï¼Œæ— éœ€æ›´æ–°
    if (currentVersion == CURRENT_CONFIG_VERSION) {
        return false
    }
    
    // éœ€è¦æ›´æ–°
    // 1. å¤‡ä»½æ—§é…ç½®
    // 2. è¯»å–é»˜è®¤é…ç½®
    // 3. åˆå¹¶é…ç½®å€¼ï¼ˆä¿ç•™ç”¨æˆ·å€¼ï¼Œæ·»åŠ æ–°é…ç½®é¡¹ï¼‰
    // 4. ä¿å­˜æ–°é…ç½®
}
```

**æ›´æ–°é…ç½®æ–‡ä»¶æµç¨‹**ï¼š

1. ä¿®æ”¹ `src/main/resources/config.yml`
2. é€’å¢ `CURRENT_CONFIG_VERSION`
3. é‡æ–°æ„å»ºæ’ä»¶
4. å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°

---

## å¼€å‘è§„èŒƒ

### Kotlin ç¼–ç è§„èŒƒ

#### å‘½åè§„èŒƒ

```kotlin
// âœ… ç±»åï¼šPascalCase
class PlayerManager

// âœ… å‡½æ•°åï¼šcamelCase
fun loadConfig()
fun isEnabled()

// âœ… å˜é‡åï¼šcamelCase
val playerName: String
var isEnabled: Boolean

// âœ… å¸¸é‡ï¼šUPPER_SNAKE_CASE
const val MAX_PLAYERS = 100
const val CONFIG_VERSION = 10

// âœ… åŒ…åï¼šlowercase
package org.tsl.tslplugins.feature
```

#### ç©ºå®‰å…¨

```kotlin
// âœ… ä½¿ç”¨å®‰å…¨è°ƒç”¨
val name = player?.name ?: "Unknown"

// âœ… ä½¿ç”¨ let
player?.let {
    it.sendMessage("Hello")
}

// âŒ é¿å… !!ï¼ˆé™¤éç¡®å®šä¸ä¸º nullï¼‰
val name = player!!.name  // ä¸æ¨è
```

#### å±æ€§è®¿é—®

```kotlin
// âœ… Kotlin é£æ ¼ï¼šå±æ€§è®¿é—®
val name = player.name
val health = player.health

// âŒ Java é£æ ¼ï¼šgetter æ–¹æ³•
val name = player.getName()  // ä¸æ¨è
```

#### å­—ç¬¦ä¸²æ¨¡æ¿

```kotlin
// âœ… å­—ç¬¦ä¸²æ¨¡æ¿
val message = "ç©å®¶ $name åŠ å…¥äº†æœåŠ¡å™¨"
val info = "ç©å®¶ ${player.name} çš„å»¶è¿Ÿæ˜¯ ${player.ping}ms"

// âŒ å­—ç¬¦ä¸²æ‹¼æ¥
val message = "ç©å®¶ " + name + " åŠ å…¥äº†æœåŠ¡å™¨"  // ä¸æ¨è
```

#### Lambda è¡¨è¾¾å¼

```kotlin
// âœ… Lambda ç®€åŒ–
players.filter { it.health > 10 }
      .map { it.name }
      .forEach { println(it) }

// âœ… it å‚æ•°
list.forEach { item ->
    println(item)
}

// âœ… ç®€åŒ–ï¼ˆå•ä¸ªå‚æ•°ï¼‰
list.forEach {
    println(it)
}
```

#### æ•°æ®ç±»

```kotlin
// âœ… æ•°æ®ç±»ï¼ˆè‡ªåŠ¨ç”Ÿæˆ equals/hashCode/toStringï¼‰
data class PlayerInfo(
    val uuid: UUID,
    val name: String,
    val ping: Int
)
```

---

### æ—¥å¿—è§„èŒƒ

```kotlin
// âœ… ä½¿ç”¨ JavaPlugin.logger
plugin.logger.info("ä¿¡æ¯ï¼šæ¨¡å—å·²åŠ è½½")
plugin.logger.warning("è­¦å‘Šï¼šé…ç½®é¡¹ç¼ºå¤±")
plugin.logger.severe("é”™è¯¯ï¼šæ— æ³•åŠ è½½é…ç½®")

// âŒ é¿å…ä½¿ç”¨ println
println("...")  // ä¸æ¨è
```

---

### æ¶ˆæ¯å¤„ç†

```kotlin
// âœ… ä½¿ç”¨ Adventure API
import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer

val serializer = LegacyComponentSerializer.legacyAmpersand()
player.sendMessage(serializer.deserialize("&aæˆåŠŸï¼"))

// âœ… ä½¿ç”¨ Manager è·å–æ¶ˆæ¯
val message = manager.getMessage("key", "placeholder" to "value")
player.sendMessage(serializer.deserialize(message))
```

---

## é‡è¦æŠ€æœ¯ç‚¹

### Vector é€Ÿåº¦è®¾ç½®ï¼ˆKotlin ç‰¹æ€§ï¼‰

```kotlin
// âŒ é”™è¯¯ï¼šy æ˜¯åªè¯»å±æ€§
throwVelocity.y = throwVelocity.y + 0.3

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ setY æ–¹æ³•
throwVelocity.setY(throwVelocity.y + 0.3)
```

### äº‹ä»¶ä¼˜å…ˆçº§

```kotlin
// ä¸€èˆ¬ä½¿ç”¨ NORMAL
@EventHandler(priority = EventPriority.NORMAL)
fun onEvent(event: SomeEvent) { }

// éœ€è¦æœ€åå¤„ç†ä½¿ç”¨ HIGHEST
@EventHandler(priority = EventPriority.HIGHEST)
fun onEvent(event: SomeEvent) { }

// éœ€è¦å¿½ç•¥å·²å–æ¶ˆäº‹ä»¶
@EventHandler(ignoreCancelled = true)
fun onEvent(event: SomeEvent) { }
```

### å¹¶å‘å®‰å…¨

```kotlin
// âœ… ä½¿ç”¨ ConcurrentHashMap
private val data: MutableMap<UUID, Int> = ConcurrentHashMap()

// âœ… ä½¿ç”¨ CopyOnWriteArrayListï¼ˆè¯»å¤šå†™å°‘ï¼‰
private val listeners: MutableList<Listener> = CopyOnWriteArrayList()
```

### èµ„æºæ¸…ç†

```kotlin
// âœ… ç©å®¶é€€å‡ºæ—¶æ¸…ç†æ•°æ®
@EventHandler
fun onPlayerQuit(event: PlayerQuitEvent) {
    manager.cleanupPlayer(event.player.uniqueId)
}

// Manager ä¸­
fun cleanupPlayer(uuid: UUID) {
    cooldowns.remove(uuid)
    // æ³¨æ„ï¼šPDC æ•°æ®ä¸éœ€è¦æ¸…ç†ï¼ˆè‡ªåŠ¨æŒä¹…åŒ–ï¼‰
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### å·²ä¼˜åŒ–

1. âœ… **é…ç½®ç¼“å­˜æœºåˆ¶** - å¯åŠ¨/reload æ—¶è¯»å–ï¼Œäº‹ä»¶å¤„ç†é›¶å¼€é”€
2. âœ… **äº‹ä»¶é©±åŠ¨æ¶æ„** - æ— è½®è¯¢ä»»åŠ¡
3. âœ… **å¿«é€Ÿå¤±è´¥ä¼˜åŒ–** - å…ˆæ£€æŸ¥ç®€å•æ¡ä»¶
4. âœ… **Folia è°ƒåº¦å™¨** - åŸç”Ÿå¤šçº¿ç¨‹æ”¯æŒ
5. âœ… **PDC æ•°æ®æŒä¹…åŒ–** - å‡å°‘å†…å­˜å ç”¨

### å¿«é€Ÿå¤±è´¥ç¤ºä¾‹

```kotlin
@EventHandler
fun onEvent(event: SomeEvent) {
    // âœ… å…ˆæ£€æŸ¥ç®€å•æ¡ä»¶
    if (!manager.isEnabled()) return  // æœ€å¿«
    if (player.isSneaking) return     // æ¬¡å¿«
    if (!player.hasPermission("...")) return
    
    // æœ€åæ£€æŸ¥å¤æ‚æ¡ä»¶
    if (manager.isBlacklisted(entity.type)) return
    
    // ä¸šåŠ¡é€»è¾‘
}
```

---

## å¼€å‘æµç¨‹

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—å®Œæ•´æµç¨‹

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å—åŒ…ç»“æ„

```
NewFeature/
â”œâ”€â”€ NewFeatureManager.kt    # ç®¡ç†å™¨ï¼šé…ç½®å’ŒçŠ¶æ€ç®¡ç†
â”œâ”€â”€ NewFeatureCommand.kt    # å‘½ä»¤ï¼šç”¨æˆ·äº¤äº’
â””â”€â”€ NewFeatureListener.kt   # ç›‘å¬å™¨ï¼šäº‹ä»¶å¤„ç†
```

---

#### ç¬¬äºŒæ­¥ï¼šå®ç° Manager

```kotlin
package org.tsl.tSLplugins.NewFeature

import org.bukkit.plugin.java.JavaPlugin

class NewFeatureManager(private val plugin: JavaPlugin) {
    // é…ç½®ç¼“å­˜
    private var enabled: Boolean = true
    private var someValue: Int = 10
    private val messages: MutableMap<String, String> = mutableMapOf()
    
    init {
        loadConfig()
    }
    
    /**
     * åŠ è½½é…ç½®ï¼ˆå¯åŠ¨æ—¶å’Œé‡è½½æ—¶è°ƒç”¨ï¼‰
     */
    fun loadConfig() {
        val config = plugin.config
        
        // è¯»å–åŸºç¡€é…ç½®
        enabled = config.getBoolean("new_feature.enabled", true)
        someValue = config.getInt("new_feature.some_value", 10)
        
        // è¯»å–æ¶ˆæ¯é…ç½®
        val prefix = config.getString("new_feature.messages.prefix", "&6[NewFeature]&r ")
        messages.clear()
        val messagesSection = config.getConfigurationSection("new_feature.messages")
        if (messagesSection != null) {
            for (key in messagesSection.getKeys(false)) {
                if (key == "prefix") continue
                val rawMessage = messagesSection.getString(key) ?: ""
                messages[key] = rawMessage.replace("%prefix%", prefix)
            }
        }
        
        plugin.logger.info("[NewFeature] é…ç½®å·²åŠ è½½")
    }
    
    // æä¾›è®¿é—®æ–¹æ³•
    fun isEnabled(): Boolean = enabled
    fun getSomeValue(): Int = someValue
    fun getMessage(key: String): String? = messages[key]
}
```

---

#### ç¬¬ä¸‰æ­¥ï¼šå®ç° Command

```kotlin
package org.tsl.tSLplugins.NewFeature

import org.bukkit.command.Command
import org.bukkit.command.CommandSender
import org.bukkit.entity.Player
import org.tsl.tSLplugins.SubCommandHandler

class NewFeatureCommand(
    private val manager: NewFeatureManager
) : SubCommandHandler {
    
    override fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean {
        // 1. åŠŸèƒ½æ£€æŸ¥
        if (!manager.isEnabled()) {
            sender.sendMessage("Â§cåŠŸèƒ½å·²ç¦ç”¨")
            return true
        }
        
        // 2. ç©å®¶æ£€æŸ¥
        if (sender !is Player) {
            sender.sendMessage("Â§cä»…ç©å®¶å¯ç”¨")
            return true
        }
        
        // 3. æƒé™æ£€æŸ¥
        if (!sender.hasPermission("tsl.newfeature.use")) {
            sender.sendMessage("Â§cæ— æƒé™")
            return true
        }
        
        // 4. å‘½ä»¤é€»è¾‘
        sender.sendMessage("Â§aåŠŸèƒ½æ‰§è¡ŒæˆåŠŸï¼")
        
        return true
    }
    
    override fun tabComplete(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): List<String> {
        if (!manager.isEnabled()) return emptyList()
        
        return when (args.size) {
            1 -> listOf("toggle", "status").filter { 
                it.startsWith(args[0], ignoreCase = true) 
            }
            else -> emptyList()
        }
    }
    
    override fun getDescription(): String = "æ–°åŠŸèƒ½å‘½ä»¤"
}
```

---

#### ç¬¬å››æ­¥ï¼šå®ç° Listener

```kotlin
package org.tsl.tSLplugins.NewFeature

import org.bukkit.event.EventHandler
import org.bukkit.event.EventPriority
import org.bukkit.event.Listener
import org.bukkit.event.player.PlayerInteractEvent
import org.bukkit.plugin.java.JavaPlugin

class NewFeatureListener(
    private val plugin: JavaPlugin,
    private val manager: NewFeatureManager
) : Listener {
    
    @EventHandler(priority = EventPriority.NORMAL, ignoreCancelled = true)
    fun onPlayerInteract(event: PlayerInteractEvent) {
        // å¿«é€Ÿå¤±è´¥ä¼˜åŒ–
        if (!manager.isEnabled()) return
        
        val player = event.player
        
        // æƒé™æ£€æŸ¥
        if (!player.hasPermission("tsl.newfeature.use")) return
        
        // ä¸šåŠ¡é€»è¾‘
        // ...
    }
}
```

---

#### ç¬¬äº”æ­¥ï¼šâš ï¸ ä¿®æ”¹æ ¹ç›®å½•æ–‡ä»¶ - TSLplugins.kt

**è¿™æ˜¯æœ€å…³é”®çš„æ­¥éª¤ï¼**

```kotlin
// TSLplugins.kt

// 1. æ·»åŠ å¯¼å…¥
import org.tsl.tSLplugins.NewFeature.NewFeatureManager
import org.tsl.tSLplugins.NewFeature.NewFeatureCommand
import org.tsl.tSLplugins.NewFeature.NewFeatureListener

class TSLplugins : JavaPlugin() {
    
    // 2. å£°æ˜ Manager
    private lateinit var newFeatureManager: NewFeatureManager
    
    override fun onEnable() {
        // ...existing code...
        
        // 3. åˆå§‹åŒ–æ¨¡å—
        newFeatureManager = NewFeatureManager(this)
        val newFeatureListener = NewFeatureListener(this, newFeatureManager)
        pm.registerEvents(newFeatureListener, this)
        
        // ...existing code...
        
        // 4. æ³¨å†Œå‘½ä»¤
        getCommand("tsl")?.let { command ->
            val dispatcher = TSLCommand()
            
            // ...existing commands...
            dispatcher.registerSubCommand("newfeature", NewFeatureCommand(newFeatureManager))
            
            command.setExecutor(dispatcher)
            command.tabCompleter = dispatcher
        }
        
        // ...existing code...
    }
    
    // 5. âš ï¸ æ·»åŠ é‡è½½æ–¹æ³•ï¼ˆå¿…éœ€ï¼ï¼‰
    fun reloadNewFeatureManager() {
        newFeatureManager.loadConfig()
    }
}
```

---

#### ç¬¬å…­æ­¥ï¼šâš ï¸ ä¿®æ”¹æ ¹ç›®å½•æ–‡ä»¶ - ReloadCommand.kt

**æ‰€æœ‰æ¨¡å—çš„é‡è½½éƒ½åœ¨è¿™é‡Œï¼**

```kotlin
// ReloadCommand.kt

override fun handle(...): Boolean {
    // ...existing code...
    
    // é‡è½½ä¸»é…ç½®
    plugin.reloadConfig()
    
    // é‡è½½æ‰€æœ‰æ¨¡å—
    plugin.reloadKissManager()
    plugin.reloadFreezeManager()
    // ...existing reloads...
    
    // âš ï¸ æ·»åŠ æ–°æ¨¡å—çš„é‡è½½ï¼ˆå¿…éœ€ï¼ï¼‰
    plugin.reloadNewFeatureManager()
    
    // ...existing code...
    
    sender.sendMessage("Â§aé…ç½®é‡è½½å®Œæˆï¼")
    
    return true
}
```

**âš ï¸ é‡è¦æé†’**ï¼š
- å¦‚æœå¿˜è®°åœ¨ ReloadCommand ä¸­æ·»åŠ ï¼Œæ¨¡å—é…ç½®å°†æ— æ³•é‡è½½ï¼
- è¿™æ˜¯æ–°æ‰‹æœ€å®¹æ˜“å¿˜è®°çš„æ­¥éª¤ï¼

---

#### ç¬¬ä¸ƒæ­¥ï¼šæ·»åŠ é…ç½®

ä¿®æ”¹ `src/main/resources/config.yml`ï¼š

```yaml
# ========================================
# æ–°åŠŸèƒ½é…ç½®
# ========================================
new_feature:
  # æ˜¯å¦å¯ç”¨æ–°åŠŸèƒ½
  enabled: true
  
  # é…ç½®å€¼
  some_value: 10
  
  # æ¶ˆæ¯é…ç½®
  messages:
    prefix: "&6[NewFeature]&r "
    success: "%prefix%&aæ“ä½œæˆåŠŸï¼"
    failed: "%prefix%&cæ“ä½œå¤±è´¥ï¼"
```

---

#### ç¬¬å…«æ­¥ï¼šâš ï¸ æ›´æ–°é…ç½®ç‰ˆæœ¬ - ConfigUpdateManager.kt

**æ¯æ¬¡ä¿®æ”¹é…ç½®æ–‡ä»¶éƒ½å¿…é¡»åšï¼**

```kotlin
// ConfigUpdateManager.kt

companion object {
    // âš ï¸ é€’å¢ç‰ˆæœ¬å·ï¼ˆå½“å‰æ˜¯ 10ï¼Œæ”¹ä¸º 11ï¼‰
    const val CURRENT_CONFIG_VERSION = 11
}
```

**ä¸ºä»€ä¹ˆè¦é€’å¢ï¼Ÿ**
- æ’ä»¶å¯åŠ¨æ—¶ä¼šæ£€æµ‹ç‰ˆæœ¬
- ç‰ˆæœ¬ä¸ä¸€è‡´ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®
- ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶

---

#### ç¬¬ä¹æ­¥ï¼šï¼ˆå¯é€‰ï¼‰æ·»åŠ  PDC æ•°æ®å­˜å‚¨

å¦‚æœéœ€è¦ä¿å­˜ç©å®¶ä¸ªäººé…ç½®ï¼Œä¿®æ”¹ `PlayerDataManager.kt`ï¼š

```kotlin
// PlayerDataManager.kt

class PlayerDataManager(private val plugin: JavaPlugin) {
    
    // 1. å®šä¹‰ PDC Key
    private val newFeatureToggleKey = NamespacedKey(plugin, "newfeature_toggle")
    
    // 2. æ·»åŠ è¯»å–æ–¹æ³•
    fun getNewFeatureToggle(player: Player, defaultValue: Boolean = true): Boolean {
        val pdc = player.persistentDataContainer
        return if (pdc.has(newFeatureToggleKey, PersistentDataType.BOOLEAN)) {
            pdc.get(newFeatureToggleKey, PersistentDataType.BOOLEAN) ?: defaultValue
        } else {
            defaultValue
        }
    }
    
    // 3. æ·»åŠ å†™å…¥æ–¹æ³•
    fun setNewFeatureToggle(player: Player, enabled: Boolean) {
        player.persistentDataContainer.set(
            newFeatureToggleKey,
            PersistentDataType.BOOLEAN,
            enabled
        )
    }
}
```

ç„¶ååœ¨ Manager ä¸­ä½¿ç”¨ï¼š

```kotlin
class NewFeatureManager(
    private val plugin: JavaPlugin,
    private val dataManager: PlayerDataManager  // æ³¨å…¥
) {
    fun isPlayerEnabled(player: Player): Boolean {
        return dataManager.getNewFeatureToggle(player, true)
    }
}
```

---

#### ç¬¬åæ­¥ï¼šï¼ˆå¯é€‰ï¼‰æ·»åŠ  PAPI å˜é‡

å¦‚æœéœ€è¦ PlaceholderAPI æ”¯æŒï¼Œä¿®æ”¹ `TSLPlaceholderExpansion.kt`ï¼š

```kotlin
// TSLPlaceholderExpansion.kt

class TSLPlaceholderExpansion(
    private val plugin: JavaPlugin,
    // ...existing managers...
    private val newFeatureManager: NewFeatureManager?  // æ·»åŠ 
) : PlaceholderExpansion() {
    
    override fun onRequest(player: OfflinePlayer?, params: String): String? {
        // ...existing code...
        
        // æ·»åŠ æ–°å˜é‡
        if (newFeatureManager != null) {
            when (params) {
                "newfeature_status" -> {
                    return if (newFeatureManager.isEnabled()) "å¯ç”¨" else "ç¦ç”¨"
                }
                "newfeature_value" -> {
                    return newFeatureManager.getSomeValue().toString()
                }
            }
        }
        
        return null
    }
}
```

ç„¶ååœ¨ `TSLplugins.kt` ä¸­æ³¨å†Œæ—¶ä¼ å…¥ï¼š

```kotlin
TSLPlaceholderExpansion(
    this,
    countHandler,
    pingManager,
    kissManager,
    rideManager,
    tossManager,
    newFeatureManager  // æ·»åŠ 
).register()
```

---

### ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—æ—¶ï¼Œç¡®ä¿å®Œæˆä»¥ä¸‹æ‰€æœ‰æ­¥éª¤ï¼š

- [ ] åˆ›å»ºæ¨¡å—åŒ…ç»“æ„ï¼ˆManagerã€Commandã€Listenerï¼‰
- [ ] å®ç° Managerï¼ˆé…ç½®ç¼“å­˜ã€loadConfig æ–¹æ³•ï¼‰
- [ ] å®ç° Commandï¼ˆå®ç° SubCommandHandler æ¥å£ï¼‰
- [ ] å®ç° Listenerï¼ˆäº‹ä»¶å¤„ç†é€»è¾‘ï¼‰
- [ ] âš ï¸ ä¿®æ”¹ `TSLplugins.kt`ï¼ˆåˆå§‹åŒ–ã€æ³¨å†Œã€æ·»åŠ  reload æ–¹æ³•ï¼‰
- [ ] âš ï¸ ä¿®æ”¹ `ReloadCommand.kt`ï¼ˆæ·»åŠ é‡è½½è°ƒç”¨ï¼‰
- [ ] æ·»åŠ é…ç½®åˆ° `config.yml`
- [ ] âš ï¸ æ›´æ–° `ConfigUpdateManager.kt`ï¼ˆé€’å¢ CURRENT_CONFIG_VERSIONï¼‰
- [ ] ï¼ˆå¯é€‰ï¼‰ä¿®æ”¹ `PlayerDataManager.kt`ï¼ˆPDC æ•°æ®ï¼‰
- [ ] ï¼ˆå¯é€‰ï¼‰ä¿®æ”¹ `TSLPlaceholderExpansion.kt`ï¼ˆPAPI å˜é‡ï¼‰
- [ ] æµ‹è¯•åŠŸèƒ½ï¼ˆå¯åŠ¨ã€å‘½ä»¤ã€äº‹ä»¶ã€é‡è½½ï¼‰
- [ ] æ›´æ–° WIKI.mdï¼ˆç”¨æˆ·æ–‡æ¡£ï¼‰

**âš ï¸ æ ‡è®°çš„æ˜¯æœ€å®¹æ˜“å¿˜è®°ä½†å¿…é¡»åšçš„æ­¥éª¤ï¼**

---

### æ ¹ç›®å½•æ–‡ä»¶ä¿®æ”¹æ€»ç»“

| æ–‡ä»¶ | æ˜¯å¦å¿…æ”¹ | ä¿®æ”¹å†…å®¹ | è¯´æ˜ |
|------|---------|---------|------|
| **TSLplugins.kt** | âœ… å¿…é¡» | åˆå§‹åŒ–æ¨¡å—ã€æ³¨å†Œå‘½ä»¤ã€æ·»åŠ  reload æ–¹æ³• | æ ¸å¿ƒå…¥å£ |
| **ReloadCommand.kt** | âœ… å¿…é¡» | æ·»åŠ æ¨¡å—é‡è½½è°ƒç”¨ | é…ç½®çƒ­é‡è½½ |
| **ConfigUpdateManager.kt** | âœ… å¿…é¡» | é€’å¢é…ç½®ç‰ˆæœ¬å· | é…ç½®è‡ªåŠ¨æ›´æ–° |
| **PlayerDataManager.kt** | âšª å¯é€‰ | æ·»åŠ  PDC æ•°æ®æ–¹æ³• | ç©å®¶æ•°æ®æŒä¹…åŒ– |
| **TSLPlaceholderExpansion.kt** | âšª å¯é€‰ | æ·»åŠ  PAPI å˜é‡å¤„ç† | å˜é‡ç³»ç»Ÿ |
| **TSLCommand.kt** | âŒ ä¸æ”¹ | ï¼ˆè‡ªåŠ¨é€šè¿‡ TSLplugins æ³¨å†Œï¼‰ | å‘½ä»¤åˆ†å‘ |

---

### å¸¸è§é”™è¯¯

1. **å¿˜è®°åœ¨ ReloadCommand ä¸­æ·»åŠ é‡è½½**
   - ç—‡çŠ¶ï¼šé…ç½®ä¿®æ”¹å `/tsl reload` ä¸ç”Ÿæ•ˆ
   - è§£å†³ï¼šåœ¨ ReloadCommand.kt æ·»åŠ  `plugin.reloadXxxManager()`

2. **å¿˜è®°é€’å¢é…ç½®ç‰ˆæœ¬**
   - ç—‡çŠ¶ï¼šé…ç½®æ›´æ–°ä¸è‡ªåŠ¨åˆå¹¶
   - è§£å†³ï¼šä¿®æ”¹ ConfigUpdateManager ä¸­çš„ CURRENT_CONFIG_VERSION

3. **Manager æ²¡æœ‰ loadConfig æ–¹æ³•**
   - ç—‡çŠ¶ï¼šç¼–è¯‘é”™è¯¯
   - è§£å†³ï¼šæ‰€æœ‰ Manager å¿…é¡»æœ‰ `loadConfig()` æ–¹æ³•

4. **Command æ²¡æœ‰å®ç° SubCommandHandler**
   - ç—‡çŠ¶ï¼šæ— æ³•æ³¨å†Œåˆ°å‘½ä»¤åˆ†å‘å™¨
   - è§£å†³ï¼šå®ç° SubCommandHandler æ¥å£

5. **å¿˜è®°åœ¨ TSLplugins ä¸­åˆå§‹åŒ–**
   - ç—‡çŠ¶ï¼šæ¨¡å—å®Œå…¨ä¸å·¥ä½œ
   - è§£å†³ï¼šåœ¨ onEnable() ä¸­åˆå§‹åŒ–å¹¶æ³¨å†Œ

---

## è°ƒè¯•æŠ€å·§
```kotlin
// ConfigUpdateManager.kt
const val CURRENT_CONFIG_VERSION = 11  // é€’å¢
```

---

### æ„å»ºå’Œéƒ¨ç½²

```bash
# æ¸…ç†
./gradlew clean

# æ„å»ºï¼ˆåŒ…å« Kotlin æ ‡å‡†åº“ï¼‰
./gradlew shadowJar

# è¾“å‡º
build/libs/TSLplugins-1.0.jar

# Windows
gradlew.bat clean shadowJar
```

---

## è°ƒè¯•æŠ€å·§

### æ—¥å¿—è°ƒè¯•

```kotlin
// è°ƒè¯•ä¿¡æ¯
plugin.logger.info("[Debug] å˜é‡å€¼: $value")

// æ–¹æ³•è°ƒç”¨è¿½è¸ª
plugin.logger.info("[Trace] è¿›å…¥æ–¹æ³•: methodName")
```

### æ¡ä»¶æ–­ç‚¹

åœ¨ IntelliJ IDEA ä¸­ï¼š
1. åœ¨è¡Œå·å·¦ä¾§ç‚¹å‡»è®¾ç½®æ–­ç‚¹
2. å³é”®æ–­ç‚¹ â†’ Condition
3. è¾“å…¥æ¡ä»¶è¡¨è¾¾å¼

### æµ‹è¯•æ¨¡å¼

```kotlin
// åœ¨é…ç½®ä¸­æ·»åŠ è°ƒè¯•å¼€å…³
class Manager(private val plugin: JavaPlugin) {
    private var debug: Boolean = false
    
    fun loadConfig() {
        debug = plugin.config.getBoolean("debug", false)
    }
    
    private fun debugLog(message: String) {
        if (debug) {
            plugin.logger.info("[DEBUG] $message")
        }
    }
}
```

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é…ç½®ç¼“å­˜ï¼Ÿ

A: ç›´æ¥è¯»å– config ä¼šæœ‰ I/O å¼€é”€ï¼Œæ¯æ¬¡äº‹ä»¶éƒ½è¯»å–ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚é…ç½®ç¼“å­˜åœ¨å¯åŠ¨æ—¶è¯»å–ä¸€æ¬¡ï¼Œäº‹ä»¶å¤„ç†æ—¶ç›´æ¥è¯»å–å†…å­˜ï¼Œé›¶å¼€é”€ã€‚

### Q: ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ·æ–°ç¼“å­˜ï¼Ÿ

A: åªåœ¨æ‰§è¡Œ `/tsl reload` å‘½ä»¤æ—¶åˆ·æ–°ã€‚é…ç½®ä¿®æ”¹åä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œéœ€è¦æ‰‹åŠ¨é‡è½½ã€‚

### Q: PDC æ•°æ®ä»€ä¹ˆæ—¶å€™ä¿å­˜ï¼Ÿ

A: PDC æ•°æ®åœ¨è°ƒç”¨ `set()` æ–¹æ³•æ—¶ç«‹å³ä¿å­˜ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ·æ–°ã€‚æ•°æ®ä¿å­˜åœ¨ç©å®¶çš„ `.dat` æ–‡ä»¶ä¸­ã€‚

### Q: Folia å’Œ Paper æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A: Folia æ˜¯å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ Paperï¼Œä¸æ”¯æŒä¼ ç»Ÿçš„ `Bukkit.getScheduler()`ï¼Œå¿…é¡»ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ APIã€‚

### Q: å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Ÿ

A: ä½¿ç”¨ `ConcurrentHashMap` ç­‰å¹¶å‘é›†åˆï¼Œé¿å…åœ¨ä¸åŒçº¿ç¨‹é—´å…±äº«å¯å˜çŠ¶æ€ã€‚Folia çš„è°ƒåº¦å™¨å·²ç»å¤„ç†äº†å¤§éƒ¨åˆ†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

### Q: ä¸ºä»€ä¹ˆ Vector.y ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Ÿ

A: Kotlin ä¸­ Vector çš„åæ ‡æ˜¯åªè¯»å±æ€§ï¼Œå¿…é¡»ä½¿ç”¨ `setX/setY/setZ` æ–¹æ³•ä¿®æ”¹ã€‚

---

## å¿«é€Ÿå‚è€ƒ

### è·å–ç©å®¶å»¶è¿Ÿ

```kotlin
val ping = player.ping  // è¿”å› Intï¼ˆæ¯«ç§’ï¼‰
```

### æƒé™æ£€æŸ¥

```kotlin
if (player.hasPermission("tsl.feature.use")) {
    // æœ‰æƒé™
}
```

### å‘é€æ¶ˆæ¯

```kotlin
player.sendMessage(serializer.deserialize("&aæˆåŠŸï¼"))
```

### å®ä½“è°ƒåº¦å™¨

```kotlin
player.scheduler.run(plugin, { _ ->
    // å®ä½“æ“ä½œ
}, null)
```

### å…¨å±€è°ƒåº¦å™¨

```kotlin
Bukkit.getGlobalRegionScheduler().runAtFixedRate(plugin, { _ ->
    // å…¨å±€ä»»åŠ¡
}, 20L, 20L)
```

---

**æœ€åæ›´æ–°**: 2025-11-24  
**æ’ä»¶ç‰ˆæœ¬**: 1.0  
**é…ç½®ç‰ˆæœ¬**: 10

