# TSLplugins - å¼€å‘è€…æŒ‡å—

> æ¶æ„è®¾è®¡ã€ä»£ç è§„èŒƒã€å¼€å‘è¦ç‚¹ - ä¾›å¼€å‘è€…å’Œ AI ä½¿ç”¨

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [æ¨¡å—è¯¦è§£](#æ¨¡å—è¯¦è§£)
5. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
6. [é‡è¦æŠ€æœ¯ç‚¹](#é‡è¦æŠ€æœ¯ç‚¹)
7. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
8. [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
9. [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯

```kotlin
// é¡¹ç›®ä¿¡æ¯
name: TSLplugins
version: 1.0
language: Kotlin 1.9.21
target: Paper/Folia 1.21.8
java: 21
build: Gradle 8.5 + Kotlin DSL
config-version: 10
```

### è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–** - æ¯ä¸ªåŒ…æ˜¯ç‹¬ç«‹åŠŸèƒ½æ¨¡å—
2. **å³æ’å³ç”¨** - æ¨¡å—äº’ä¸ä¾èµ–ï¼Œå¯å•ç‹¬ç¦ç”¨
3. **äº‹ä»¶é©±åŠ¨** - ä½¿ç”¨ Bukkit/Folia äº‹ä»¶ç³»ç»Ÿ
4. **é…ç½®é©±åŠ¨** - æ‰€æœ‰è¡Œä¸ºå¯é…ç½®
5. **é…ç½®ç¼“å­˜** - å¯åŠ¨/reload æ—¶è¯»å–ï¼Œäº‹ä»¶å¤„ç†é›¶å¼€é”€

### æ ¸å¿ƒç‰¹æ€§

- âœ… Folia åŸç”Ÿæ”¯æŒï¼ˆæ— è½®è¯¢ä»»åŠ¡ï¼‰
- âœ… é…ç½®çƒ­é‡è½½ï¼ˆæ— éœ€é‡å¯ï¼‰
- âœ… æ™ºèƒ½é…ç½®æ›´æ–°ï¼ˆè‡ªåŠ¨åˆå¹¶æ–°é…ç½®ï¼‰
- âœ… PDC æ•°æ®æŒä¹…åŒ–ï¼ˆç©å®¶é…ç½®æ°¸ä¹…ä¿å­˜ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆé…ç½®ç¼“å­˜ã€äº‹ä»¶é©±åŠ¨ï¼‰

---

## æ ¸å¿ƒæ¶æ„

### é¡¹ç›®ç»“æ„

```
src/main/kotlin/org/tsl/tSLplugins/
â”œâ”€â”€ TSLplugins.kt              # ä¸»ç±»ï¼šåˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
â”œâ”€â”€ TSLCommand.kt              # å‘½ä»¤åˆ†å‘å™¨ï¼šç»Ÿä¸€å…¥å£
â”œâ”€â”€ ReloadCommand.kt           # é‡è½½å‘½ä»¤ï¼šé‡è½½æ‰€æœ‰æ¨¡å—
â”œâ”€â”€ ConfigUpdateManager.kt     # é…ç½®æ›´æ–°ï¼šç‰ˆæœ¬æ§åˆ¶
â”œâ”€â”€ PlayerDataManager.kt       # PDC ç®¡ç†å™¨ï¼šæ•°æ®æŒä¹…åŒ–
â”‚
â”œâ”€â”€ Alias/                     # å‘½ä»¤åˆ«å
â”‚   â”œâ”€â”€ AliasManager.kt        # ç®¡ç†å™¨ï¼šåŠ è½½é…ç½®
â”‚   â”œâ”€â”€ AliasCommand.kt        # å‘½ä»¤ï¼šé‡è½½
â”‚   â””â”€â”€ DynamicAliasCommand.kt # åŠ¨æ€æ³¨å†Œ
â”‚
â”œâ”€â”€ Maintenance/               # ç»´æŠ¤æ¨¡å¼
â”‚   â”œâ”€â”€ MaintenanceManager.kt           # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ MaintenanceCommand.kt           # å‘½ä»¤
â”‚   â”œâ”€â”€ MaintenanceLoginListener.kt     # ç™»å½•æ‹¦æˆª
â”‚   â”œâ”€â”€ MaintenanceMotdListener.kt      # MOTD ä¿®æ”¹
â”‚   â””â”€â”€ MaintenancePermissionListener.kt # æƒé™æ£€æŸ¥
â”‚
â”œâ”€â”€ Scale/                     # ä½“å‹è°ƒæ•´
â”‚   â”œâ”€â”€ ScaleManager.kt        # ç®¡ç†å™¨
â”‚   â””â”€â”€ ScaleCommand.kt        # å‘½ä»¤
â”‚
â”œâ”€â”€ Hat/                       # å¸½å­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ HatManager.kt          # ç®¡ç†å™¨
â”‚   â””â”€â”€ HatCommand.kt          # å‘½ä»¤
â”‚
â”œâ”€â”€ Ping/                      # å»¶è¿ŸæŸ¥è¯¢
â”‚   â”œâ”€â”€ PingManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ PingCommand.kt         # å‘½ä»¤
â”‚   â””â”€â”€ PingPaginator.kt       # åˆ†é¡µæ˜¾ç¤º
â”‚
â”œâ”€â”€ Toss/                      # ç”Ÿç‰©ä¸¾èµ·
â”‚   â”œâ”€â”€ TossManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ TossCommand.kt         # å‘½ä»¤
â”‚   ï¿½ï¿½ï¿½â”€â”€ TossListener.kt        # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ Ride/                      # ç”Ÿç‰©éª‘ä¹˜
â”‚   â”œâ”€â”€ RideManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ RideCommand.kt         # å‘½ä»¤
â”‚   â””â”€â”€ RideListener.kt        # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ BabyLock/                  # æ°¸ä¹…å¹¼å¹´
â”‚   â”œâ”€â”€ BabyLockManager.kt     # ç®¡ç†å™¨
â”‚   â””â”€â”€ BabyLockListener.kt    # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ Kiss/                      # ç©å®¶äº²å»
â”‚   â”œâ”€â”€ KissManager.kt         # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ KissCommand.kt         # å‘½ä»¤
â”‚   â”œâ”€â”€ KissExecutor.kt        # æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ KissListener.kt        # ç›‘å¬å™¨
â”‚   â””â”€â”€ KissPlaceholder.kt     # PAPI æ‰©å±•
â”‚
â”œâ”€â”€ Freeze/                    # ç©å®¶å†»ç»“
â”‚   â”œâ”€â”€ FreezeManager.kt       # ç®¡ç†å™¨
â”‚   â”œâ”€â”€ FreezeCommand.kt       # å‘½ä»¤
â”‚   â””â”€â”€ FreezeListener.kt      # ç›‘å¬å™¨
â”‚
â”œâ”€â”€ Advancement/               # æˆå°±è¿‡æ»¤
â”‚   â”œâ”€â”€ AdvancementCount.kt    # ç»Ÿè®¡
â”‚   â”œâ”€â”€ AdvancementMessage.kt  # æ¶ˆæ¯è¿‡æ»¤
â”‚   â””â”€â”€ AdvancementCommand.kt  # å‘½ä»¤
â”‚
â”œâ”€â”€ Visitor/                   # è®¿å®¢ä¿æŠ¤
â”‚   â””â”€â”€ VisitorEffect.kt       # æ•ˆæœç®¡ç†
â”‚
â”œâ”€â”€ Permission/                # æƒé™æ£€æµ‹
â”‚   â””â”€â”€ PermissionChecker.kt   # æ£€æµ‹å™¨
â”‚
â”œâ”€â”€ Farmprotect/               # å†œç”°ä¿æŠ¤
â”‚   â””â”€â”€ FarmProtect.kt         # ç›‘å¬å™¨
â”‚
â””â”€â”€ Motd/                      # å‡ç©å®¶
    â””â”€â”€ FakePlayerMotd.kt      # MOTD ä¿®æ”¹
```

### æ¶æ„æ¨¡å¼

#### Manager-Command-Listener æ¨¡å¼

```kotlin
// æ ‡å‡†æ¨¡å—ç»“æ„
Module/
â”œâ”€â”€ ModuleManager.kt    # é…ç½®ç®¡ç†ã€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ ModuleCommand.kt    # å‘½ä»¤å¤„ç†ã€æƒé™æ£€æŸ¥
â””â”€â”€ ModuleListener.kt   # äº‹ä»¶ç›‘å¬ã€ä¸šåŠ¡é€»è¾‘
```

**Managerï¼ˆç®¡ç†å™¨ï¼‰**ï¼š
- åŠ è½½å’Œç¼“å­˜é…ç½®
- ç®¡ç†æ¨¡å—çŠ¶æ€
- æä¾›å·¥å…·æ–¹æ³•

**Commandï¼ˆå‘½ä»¤å¤„ç†å™¨ï¼‰**ï¼š
- å®ç° `SubCommandHandler` æ¥å£
- å¤„ç†å‘½ä»¤é€»è¾‘
- æä¾› Tab è¡¥å…¨

**Listenerï¼ˆç›‘å¬å™¨ï¼‰**ï¼š
- ç›‘å¬ Bukkit äº‹ä»¶
- æ‰§è¡Œä¸šåŠ¡é€»è¾‘
- è°ƒç”¨ Manager æ–¹æ³•

---

## æŠ€æœ¯æ ˆ

### è¯­è¨€å’Œå·¥å…·

```kotlin
// Kotlin
version: 1.9.21
jvmTarget: 21

// Gradle
version: 8.5
dsl: Kotlin DSL

// Shadow
version: 8.1.1  // æ‰“åŒ… Kotlin æ ‡å‡†åº“
```

### æ ¸å¿ƒä¾èµ–

```kotlin
// å¿…éœ€
compileOnly("io.papermc.paper:paper-api:1.21.8-R0.1-SNAPSHOT")
implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")

// å¯é€‰
compileOnly("net.luckperms:api:5.4")          // è®¿å®¢ä¿æŠ¤
compileOnly("me.clip:placeholderapi:2.11.6")  // å˜é‡æ”¯æŒ
```

### Maven ä»“åº“

```kotlin
repositories {
    mavenCentral()
    maven("https://repo.papermc.io/repository/maven-public/")
    maven("https://repo.extendedclip.com/content/repositories/placeholderapi/")
}
```

---

## æ¨¡å—è¯¦è§£

### é…ç½®ç¼“å­˜æ¨¡å¼ï¼ˆé‡è¦ï¼ï¼‰

**æ‰€æœ‰æ¨¡å—éƒ½ä½¿ç”¨é…ç½®ç¼“å­˜**ï¼Œè¿™æ˜¯æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–ï¼š

```kotlin
class FeatureManager(private val plugin: JavaPlugin) {
    // âœ… ç¼“å­˜é…ç½®å€¼
    private var enabled: Boolean = true
    private var maxValue: Int = 10
    private val blacklist: MutableSet<EntityType> = mutableSetOf()
    
    init {
        loadConfig()
    }
    
    // âœ… åŠ è½½é…ç½®åˆ°ç¼“å­˜
    fun loadConfig() {
        val config = plugin.config
        enabled = config.getBoolean("feature.enabled", true)
        maxValue = config.getInt("feature.max_value", 10)
        
        // åŠ è½½é›†åˆç±»å‹
        blacklist.clear()
        config.getStringList("feature.blacklist").forEach { name ->
            try {
                blacklist.add(EntityType.valueOf(name.uppercase()))
            } catch (e: IllegalArgumentException) {
                plugin.logger.warning("æ— æ•ˆçš„å®ä½“ç±»å‹: $name")
            }
        }
    }
    
    // âœ… ç›´æ¥è¯»å–ç¼“å­˜ï¼ˆé›¶å¼€é”€ï¼‰
    fun isEnabled(): Boolean = enabled
    fun getMaxValue(): Int = maxValue
    fun isBlacklisted(type: EntityType): Boolean = blacklist.contains(type)
}
```

**Listener ä½¿ç”¨ç¼“å­˜**ï¼š

```kotlin
class FeatureListener(
    private val plugin: JavaPlugin,
    private val manager: FeatureManager
) : Listener {
    
    @EventHandler
    fun onSomeEvent(event: SomeEvent) {
        // âœ… ç›´æ¥è¯»å–ç¼“å­˜ï¼Œé›¶å¼€é”€
        if (!manager.isEnabled()) return
        
        // âœ… é»‘åå•æ£€æŸ¥ä¹Ÿæ˜¯ç¼“å­˜
        if (manager.isBlacklisted(entity.type)) return
        
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ç¼“å­˜ï¼Ÿ**

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| ç›´æ¥è¯»å– config | å§‹ç»ˆæœ€æ–° | I/O å¼€é”€å¤§ï¼Œæ€§èƒ½å·® |
| **é…ç½®ç¼“å­˜** | **é›¶å¼€é”€ï¼Œæ€§èƒ½æœ€ä½³** | éœ€è¦æ‰‹åŠ¨é‡è½½ |

**é‡è½½æœºåˆ¶**ï¼š

```kotlin
// TSLplugins.kt
fun reloadFeatureManager() {
    featureManager.loadConfig()  // åˆ·æ–°ç¼“å­˜
}

// ReloadCommand.kt
plugin.reloadFeatureManager()  // é‡è½½æ—¶è°ƒç”¨
```

---

### SubCommandHandler æ¥å£

æ‰€æœ‰å‘½ä»¤å¤„ç†å™¨å¿…é¡»å®ç°æ­¤æ¥å£ï¼š

```kotlin
interface SubCommandHandler {
    fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean
    
    fun tabComplete(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): List<String>
    
    fun getDescription(): String = ""
}
```

**å®ç°ç¤ºä¾‹**ï¼š

```kotlin
class FeatureCommand(
    private val manager: FeatureManager
) : SubCommandHandler {
    
    override fun handle(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): Boolean {
        // 1. åŠŸèƒ½æ£€æŸ¥
        if (!manager.isEnabled()) {
            sender.sendMessage("åŠŸèƒ½å·²ç¦ç”¨")
            return true
        }
        
        // 2. ç©å®¶æ£€æŸ¥
        if (sender !is Player) {
            sender.sendMessage("ä»…ç©å®¶å¯ç”¨")
            return true
        }
        
        // 3. æƒé™æ£€æŸ¥
        if (!sender.hasPermission("tsl.feature.use")) {
            sender.sendMessage("æ— æƒé™")
            return true
        }
        
        // 4. å‚æ•°è§£æ
        when {
            args.isEmpty() -> showUsage(sender)
            args[0].equals("toggle", ignoreCase = true) -> handleToggle(sender)
            else -> showUsage(sender)
        }
        
        return true
    }
    
    override fun tabComplete(
        sender: CommandSender,
        command: Command,
        label: String,
        args: Array<out String>
    ): List<String> {
        if (!manager.isEnabled()) return emptyList()
        
        return when (args.size) {
            1 -> listOf("toggle", "status").filter { 
                it.startsWith(args[0], ignoreCase = true) 
            }
            else -> emptyList()
        }
    }
    
    override fun getDescription(): String = "åŠŸèƒ½å‘½ä»¤"
}
```

---

### Folia è°ƒåº¦å™¨ï¼ˆé‡è¦ï¼ï¼‰

Folia ä¸æ”¯æŒ Bukkit çš„ä¼ ç»Ÿè°ƒåº¦å™¨ï¼Œå¿…é¡»ä½¿ç”¨æ–°çš„ APIï¼š

#### å®ä½“è°ƒåº¦å™¨

```kotlin
// âœ… æ­£ç¡®ï¼šå®ä½“æ“ä½œä½¿ç”¨å®ä½“è°ƒåº¦å™¨
player.scheduler.run(plugin, { _ ->
    // å®ä½“ç›¸å…³æ“ä½œï¼ˆä¿®æ”¹èƒŒåŒ…ã€ä¼ é€ç­‰ï¼‰
    player.inventory.setHelmet(item)
    player.teleport(location)
}, null)

// âœ… å»¶è¿Ÿæ‰§è¡Œ
player.scheduler.runDelayed(plugin, { _ ->
    // å»¶è¿Ÿæ“ä½œ
}, null, 20L)  // å»¶è¿Ÿ 1 ç§’

// âœ… å®šæ—¶ä»»åŠ¡
player.scheduler.runAtFixedRate(plugin, { task ->
    if (!player.isOnline) {
        task.cancel()
        return@runAtFixedRate
    }
    // å®šæ—¶æ“ä½œ
}, null, 1L, 20L)  // å»¶è¿Ÿ 0.05 ç§’ï¼Œæ¯ç§’æ‰§è¡Œä¸€æ¬¡
```

#### å…¨å±€è°ƒåº¦å™¨

```kotlin
// âœ… æ­£ç¡®ï¼šå…¨å±€ä»»åŠ¡ä½¿ç”¨å…¨å±€è°ƒåº¦å™¨
Bukkit.getGlobalRegionScheduler().runAtFixedRate(plugin, { _ ->
    // å…¨å±€å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚è¿‡æœŸæ£€æŸ¥ï¼‰
}, 20L, 20L)  // å»¶è¿Ÿ 1 ç§’ï¼Œæ¯ç§’æ‰§è¡Œä¸€æ¬¡
```

#### âŒ é”™è¯¯ç¤ºä¾‹

```kotlin
// âŒ é”™è¯¯ï¼šFolia ä¸æ”¯æŒ
Bukkit.getScheduler().runTask(plugin, Runnable {
    // ...
})
```

---

### PDC æ•°æ®æŒä¹…åŒ–

ä½¿ç”¨ `PersistentDataContainer` ä¿å­˜ç©å®¶é…ç½®ï¼š

#### PlayerDataManager

```kotlin
class PlayerDataManager(private val plugin: JavaPlugin) {
    
    // PDC Keys
    private val kissToggleKey = NamespacedKey(plugin, "kiss_toggle")
    private val rideToggleKey = NamespacedKey(plugin, "ride_toggle")
    private val tossVelocityKey = NamespacedKey(plugin, "toss_velocity")
    
    // è¯»å–
    fun getKissToggle(player: Player, defaultValue: Boolean = true): Boolean {
        val pdc = player.persistentDataContainer
        return if (pdc.has(kissToggleKey, PersistentDataType.BOOLEAN)) {
            pdc.get(kissToggleKey, PersistentDataType.BOOLEAN) ?: defaultValue
        } else {
            defaultValue
        }
    }
    
    // å†™å…¥
    fun setKissToggle(player: Player, enabled: Boolean) {
        player.persistentDataContainer.set(
            kissToggleKey, 
            PersistentDataType.BOOLEAN, 
            enabled
        )
    }
}
```

#### Manager ä½¿ç”¨ PDC

```kotlin
class KissManager(
    private val plugin: JavaPlugin,
    private val dataManager: PlayerDataManager  // âœ… æ³¨å…¥
) {
    // âœ… ä» PDC è¯»å–
    fun isPlayerEnabled(player: Player): Boolean {
        return dataManager.getKissToggle(player, true)
    }
    
    // âœ… å†™å…¥ PDC
    fun togglePlayer(player: Player): Boolean {
        val current = isPlayerEnabled(player)
        val newStatus = !current
        dataManager.setKissToggle(player, newStatus)
        return newStatus
    }
}
```

**æ”¯æŒçš„æ•°æ®ç±»å‹**ï¼š
- `BOOLEAN` - å¸ƒå°”å€¼
- `INTEGER` - æ•´æ•°
- `DOUBLE` - åŒç²¾åº¦æµ®ç‚¹æ•°
- `STRING` - å­—ç¬¦ä¸²
- `BYTE_ARRAY` - å­—èŠ‚æ•°ç»„

---

### é…ç½®è‡ªåŠ¨æ›´æ–°

`ConfigUpdateManager` å®ç°é…ç½®ç‰ˆæœ¬æ§åˆ¶ï¼š

```kotlin
companion object {
    const val CURRENT_CONFIG_VERSION = 10  // âœ… æ¯æ¬¡æ›´æ–°é…ç½®æ—¶é€’å¢
}

fun checkAndUpdate(): Boolean {
    val configFile = File(plugin.dataFolder, "config.yml")
    val currentConfig = YamlConfiguration.loadConfiguration(configFile)
    val currentVersion = currentConfig.getInt("config-version", 0)
    
    // ç‰ˆæœ¬ä¸€è‡´ï¼Œæ— éœ€æ›´æ–°
    if (currentVersion == CURRENT_CONFIG_VERSION) {
        return false
    }
    
    // éœ€è¦æ›´æ–°
    // 1. å¤‡ä»½æ—§é…ç½®
    // 2. è¯»å–é»˜è®¤é…ç½®
    // 3. åˆå¹¶é…ç½®å€¼ï¼ˆä¿ç•™ç”¨æˆ·å€¼ï¼Œæ·»åŠ æ–°é…ç½®é¡¹ï¼‰
    // 4. ä¿å­˜æ–°é…ç½®
}
```

**æ›´æ–°é…ç½®æ–‡ä»¶æµç¨‹**ï¼š

1. ä¿®æ”¹ `src/main/resources/config.yml`
2. é€’å¢ `CURRENT_CONFIG_VERSION`
3. é‡æ–°æ„å»ºæ’ä»¶
4. å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°

---

## å¼€å‘è§„èŒƒ

### Kotlin ç¼–ç è§„èŒƒ

#### å‘½åè§„èŒƒ

```kotlin
// âœ… ç±»åï¼šPascalCase
class PlayerManager

// âœ… å‡½æ•°åï¼šcamelCase
fun loadConfig()
fun isEnabled()

// âœ… å˜é‡åï¼šcamelCase
val playerName: String
var isEnabled: Boolean

// âœ… å¸¸é‡ï¼šUPPER_SNAKE_CASE
const val MAX_PLAYERS = 100
const val CONFIG_VERSION = 10

// âœ… åŒ…åï¼šlowercase
package org.tsl.tslplugins.feature
```

#### ç©ºå®‰å…¨

```kotlin
// âœ… ä½¿ç”¨å®‰å…¨è°ƒç”¨
val name = player?.name ?: "Unknown"

// âœ… ä½¿ç”¨ let
player?.let {
    it.sendMessage("Hello")
}

// âŒ é¿å… !!ï¼ˆé™¤éç¡®å®šä¸ä¸º nullï¼‰
val name = player!!.name  // ä¸æ¨è
```

#### å±æ€§è®¿é—®

```kotlin
// âœ… Kotlin é£æ ¼ï¼šå±æ€§è®¿é—®
val name = player.name
val health = player.health

// âŒ Java é£æ ¼ï¼šgetter æ–¹æ³•
val name = player.getName()  // ä¸æ¨è
```

#### å­—ç¬¦ä¸²æ¨¡æ¿

```kotlin
// âœ… å­—ç¬¦ä¸²æ¨¡æ¿
val message = "ç©å®¶ $name åŠ å…¥äº†æœåŠ¡å™¨"
val info = "ç©å®¶ ${player.name} çš„å»¶è¿Ÿæ˜¯ ${player.ping}ms"

// âŒ å­—ç¬¦ä¸²æ‹¼æ¥
val message = "ç©å®¶ " + name + " åŠ å…¥äº†æœåŠ¡å™¨"  // ä¸æ¨è
```

#### Lambda è¡¨è¾¾å¼

```kotlin
// âœ… Lambda ç®€åŒ–
players.filter { it.health > 10 }
      .map { it.name }
      .forEach { println(it) }

// âœ… it å‚æ•°
list.forEach { item ->
    println(item)
}

// âœ… ç®€åŒ–ï¼ˆå•ä¸ªå‚æ•°ï¼‰
list.forEach {
    println(it)
}
```

#### æ•°æ®ç±»

```kotlin
// âœ… æ•°æ®ç±»ï¼ˆè‡ªåŠ¨ç”Ÿæˆ equals/hashCode/toStringï¼‰
data class PlayerInfo(
    val uuid: UUID,
    val name: String,
    val ping: Int
)
```

---

### æ—¥å¿—è§„èŒƒ

```kotlin
// âœ… ä½¿ç”¨ JavaPlugin.logger
plugin.logger.info("ä¿¡æ¯ï¼šæ¨¡å—å·²åŠ è½½")
plugin.logger.warning("è­¦å‘Šï¼šé…ç½®é¡¹ç¼ºå¤±")
plugin.logger.severe("é”™è¯¯ï¼šæ— æ³•åŠ è½½é…ç½®")

// âŒ é¿å…ä½¿ç”¨ println
println("...")  // ä¸æ¨è
```

---

### æ¶ˆæ¯å¤„ç†

```kotlin
// âœ… ä½¿ç”¨ Adventure API
import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer

val serializer = LegacyComponentSerializer.legacyAmpersand()
player.sendMessage(serializer.deserialize("&aæˆåŠŸï¼"))

// âœ… ä½¿ç”¨ Manager è·å–æ¶ˆæ¯
val message = manager.getMessage("key", "placeholder" to "value")
player.sendMessage(serializer.deserialize(message))
```

---

## é‡è¦æŠ€æœ¯ç‚¹

### Vector é€Ÿåº¦è®¾ç½®ï¼ˆKotlin ç‰¹æ€§ï¼‰

```kotlin
// âŒ é”™è¯¯ï¼šy æ˜¯åªè¯»å±æ€§
throwVelocity.y = throwVelocity.y + 0.3

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ setY æ–¹æ³•
throwVelocity.setY(throwVelocity.y + 0.3)
```

### äº‹ä»¶ä¼˜å…ˆçº§

```kotlin
// ä¸€èˆ¬ä½¿ç”¨ NORMAL
@EventHandler(priority = EventPriority.NORMAL)
fun onEvent(event: SomeEvent) { }

// éœ€è¦æœ€åå¤„ç†ä½¿ç”¨ HIGHEST
@EventHandler(priority = EventPriority.HIGHEST)
fun onEvent(event: SomeEvent) { }

// éœ€è¦å¿½ç•¥å·²å–æ¶ˆäº‹ä»¶
@EventHandler(ignoreCancelled = true)
fun onEvent(event: SomeEvent) { }
```

### å¹¶å‘å®‰å…¨

```kotlin
// âœ… ä½¿ç”¨ ConcurrentHashMap
private val data: MutableMap<UUID, Int> = ConcurrentHashMap()

// âœ… ä½¿ç”¨ CopyOnWriteArrayListï¼ˆè¯»å¤šå†™å°‘ï¼‰
private val listeners: MutableList<Listener> = CopyOnWriteArrayList()
```

### èµ„æºæ¸…ç†

```kotlin
// âœ… ç©å®¶é€€å‡ºæ—¶æ¸…ç†æ•°æ®
@EventHandler
fun onPlayerQuit(event: PlayerQuitEvent) {
    manager.cleanupPlayer(event.player.uniqueId)
}

// Manager ä¸­
fun cleanupPlayer(uuid: UUID) {
    cooldowns.remove(uuid)
    // æ³¨æ„ï¼šPDC æ•°æ®ä¸éœ€è¦æ¸…ç†ï¼ˆè‡ªåŠ¨æŒä¹…åŒ–ï¼‰
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### å·²ä¼˜åŒ–

1. âœ… **é…ç½®ç¼“å­˜æœºåˆ¶** - å¯åŠ¨/reload æ—¶è¯»å–ï¼Œäº‹ä»¶å¤„ç†é›¶å¼€é”€
2. âœ… **äº‹ä»¶é©±åŠ¨æ¶æ„** - æ— è½®è¯¢ä»»åŠ¡
3. âœ… **å¿«é€Ÿå¤±è´¥ä¼˜åŒ–** - å…ˆæ£€æŸ¥ç®€å•æ¡ä»¶
4. âœ… **Folia è°ƒåº¦å™¨** - åŸç”Ÿå¤šçº¿ç¨‹æ”¯æŒ
5. âœ… **PDC æ•°æ®æŒä¹…åŒ–** - å‡å°‘å†…å­˜å ç”¨

### å¿«é€Ÿå¤±è´¥ç¤ºä¾‹

```kotlin
@EventHandler
fun onEvent(event: SomeEvent) {
    // âœ… å…ˆæ£€æŸ¥ç®€å•æ¡ä»¶
    if (!manager.isEnabled()) return  // æœ€å¿«
    if (player.isSneaking) return     // æ¬¡å¿«
    if (!player.hasPermission("...")) return
    
    // æœ€åæ£€æŸ¥å¤æ‚æ¡ä»¶
    if (manager.isBlacklisted(entity.type)) return
    
    // ä¸šåŠ¡é€»è¾‘
}
```

---

## å¼€å‘æµç¨‹

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

1. **åˆ›å»ºåŒ…ç»“æ„**
```
NewFeature/
â”œâ”€â”€ NewFeatureManager.kt
â”œâ”€â”€ NewFeatureCommand.kt
â””â”€â”€ NewFeatureListener.kt
```

2. **å®ç° Manager**
```kotlin
class NewFeatureManager(private val plugin: JavaPlugin) {
    private var enabled: Boolean = true
    
    init {
        loadConfig()
    }
    
    fun loadConfig() {
        enabled = plugin.config.getBoolean("new_feature.enabled", true)
    }
    
    fun isEnabled(): Boolean = enabled
}
```

3. **å®ç° Command**
```kotlin
class NewFeatureCommand(
    private val manager: NewFeatureManager
) : SubCommandHandler {
    // å®ç°æ¥å£æ–¹æ³•
}
```

4. **å®ç° Listener**
```kotlin
class NewFeatureListener(
    private val plugin: JavaPlugin,
    private val manager: NewFeatureManager
) : Listener {
    @EventHandler
    fun onEvent(event: SomeEvent) {
        if (!manager.isEnabled()) return
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

5. **æ³¨å†Œåˆ°ä¸»ç±»**
```kotlin
// TSLplugins.kt
private lateinit var newFeatureManager: NewFeatureManager

override fun onEnable() {
    // åˆå§‹åŒ–
    newFeatureManager = NewFeatureManager(this)
    val listener = NewFeatureListener(this, newFeatureManager)
    pm.registerEvents(listener, this)
    
    // æ³¨å†Œå‘½ä»¤
    dispatcher.registerSubCommand("newfeature", NewFeatureCommand(newFeatureManager))
}

// æ·»åŠ é‡è½½æ–¹æ³•
fun reloadNewFeatureManager() {
    newFeatureManager.loadConfig()
}
```

6. **æ·»åŠ åˆ° ReloadCommand**
```kotlin
// ReloadCommand.kt
plugin.reloadNewFeatureManager()
```

7. **æ·»åŠ é…ç½®**
```yaml
# config.yml
new_feature:
  enabled: true
  messages:
    prefix: "&6[NewFeature]&r "
```

8. **æ›´æ–°é…ç½®ç‰ˆæœ¬**
```kotlin
// ConfigUpdateManager.kt
const val CURRENT_CONFIG_VERSION = 11  // é€’å¢
```

---

### æ„å»ºå’Œéƒ¨ç½²

```bash
# æ¸…ç†
./gradlew clean

# æ„å»ºï¼ˆåŒ…å« Kotlin æ ‡å‡†åº“ï¼‰
./gradlew shadowJar

# è¾“å‡º
build/libs/TSLplugins-1.0.jar

# Windows
gradlew.bat clean shadowJar
```

---

## è°ƒè¯•æŠ€å·§

### æ—¥å¿—è°ƒè¯•

```kotlin
// è°ƒè¯•ä¿¡æ¯
plugin.logger.info("[Debug] å˜é‡å€¼: $value")

// æ–¹æ³•è°ƒç”¨è¿½è¸ª
plugin.logger.info("[Trace] è¿›å…¥æ–¹æ³•: methodName")
```

### æ¡ä»¶æ–­ç‚¹

åœ¨ IntelliJ IDEA ä¸­ï¼š
1. åœ¨è¡Œå·å·¦ä¾§ç‚¹å‡»è®¾ç½®æ–­ç‚¹
2. å³é”®æ–­ç‚¹ â†’ Condition
3. è¾“å…¥æ¡ä»¶è¡¨è¾¾å¼

### æµ‹è¯•æ¨¡å¼

```kotlin
// åœ¨é…ç½®ä¸­æ·»åŠ è°ƒè¯•å¼€å…³
class Manager(private val plugin: JavaPlugin) {
    private var debug: Boolean = false
    
    fun loadConfig() {
        debug = plugin.config.getBoolean("debug", false)
    }
    
    private fun debugLog(message: String) {
        if (debug) {
            plugin.logger.info("[DEBUG] $message")
        }
    }
}
```

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é…ç½®ç¼“å­˜ï¼Ÿ

A: ç›´æ¥è¯»å– config ä¼šæœ‰ I/O å¼€é”€ï¼Œæ¯æ¬¡äº‹ä»¶éƒ½è¯»å–ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚é…ç½®ç¼“å­˜åœ¨å¯åŠ¨æ—¶è¯»å–ä¸€æ¬¡ï¼Œäº‹ä»¶å¤„ç†æ—¶ç›´æ¥è¯»å–å†…å­˜ï¼Œé›¶å¼€é”€ã€‚

### Q: ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ·æ–°ç¼“å­˜ï¼Ÿ

A: åªåœ¨æ‰§è¡Œ `/tsl reload` å‘½ä»¤æ—¶åˆ·æ–°ã€‚é…ç½®ä¿®æ”¹åä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œéœ€è¦æ‰‹åŠ¨é‡è½½ã€‚

### Q: PDC æ•°æ®ä»€ä¹ˆæ—¶å€™ä¿å­˜ï¼Ÿ

A: PDC æ•°æ®åœ¨è°ƒç”¨ `set()` æ–¹æ³•æ—¶ç«‹å³ä¿å­˜ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ·æ–°ã€‚æ•°æ®ä¿å­˜åœ¨ç©å®¶çš„ `.dat` æ–‡ä»¶ä¸­ã€‚

### Q: Folia å’Œ Paper æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A: Folia æ˜¯å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ Paperï¼Œä¸æ”¯æŒä¼ ç»Ÿçš„ `Bukkit.getScheduler()`ï¼Œå¿…é¡»ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ APIã€‚

### Q: å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Ÿ

A: ä½¿ç”¨ `ConcurrentHashMap` ç­‰å¹¶å‘é›†åˆï¼Œé¿å…åœ¨ä¸åŒçº¿ç¨‹é—´å…±äº«å¯å˜çŠ¶æ€ã€‚Folia çš„è°ƒåº¦å™¨å·²ç»å¤„ç†äº†å¤§éƒ¨åˆ†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

### Q: ä¸ºä»€ä¹ˆ Vector.y ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Ÿ

A: Kotlin ä¸­ Vector çš„åæ ‡æ˜¯åªè¯»å±æ€§ï¼Œå¿…é¡»ä½¿ç”¨ `setX/setY/setZ` æ–¹æ³•ä¿®æ”¹ã€‚

---

## å¿«é€Ÿå‚è€ƒ

### è·å–ç©å®¶å»¶è¿Ÿ

```kotlin
val ping = player.ping  // è¿”å› Intï¼ˆæ¯«ç§’ï¼‰
```

### æƒé™æ£€æŸ¥

```kotlin
if (player.hasPermission("tsl.feature.use")) {
    // æœ‰æƒé™
}
```

### å‘é€æ¶ˆæ¯

```kotlin
player.sendMessage(serializer.deserialize("&aæˆåŠŸï¼"))
```

### å®ä½“è°ƒåº¦å™¨

```kotlin
player.scheduler.run(plugin, { _ ->
    // å®ä½“æ“ä½œ
}, null)
```

### å…¨å±€è°ƒåº¦å™¨

```kotlin
Bukkit.getGlobalRegionScheduler().runAtFixedRate(plugin, { _ ->
    // å…¨å±€ä»»åŠ¡
}, 20L, 20L)
```

---

**æœ€åæ›´æ–°**: 2025-11-24  
**æ’ä»¶ç‰ˆæœ¬**: 1.0  
**é…ç½®ç‰ˆæœ¬**: 10

