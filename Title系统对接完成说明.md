# 称号系统更新 v2

## 更新日期
2024-12-30

## 更新内容

### 1. 简化称号等级
- **变更**：移除单色称号等级，只保留两种等级
- **新等级**：
  | 等级 | 名称 | 功能 |
  |------|------|------|
  | 0 | 无称号 | 暂未开通 |
  | 1 | 渐变称号 | 支持单色和渐变效果 |
- **影响**：原来的等级 2（渐变称号）现在是等级 1

### 2. 移除称号括号
- **变更**：称号文字不再包含方括号 `[]`
- **旧格式**：`&6[大佬]` 或 `<gradient:#FF0000:#00FF00>[渐变]</gradient>`
- **新格式**：`&6大佬` 或 `<gradient:#FF0000:#00FF00>渐变</gradient>`

### 3. 移除称号位置选项
- **变更**：不再区分前缀/后缀位置
- **影响**：称号统一显示在玩家名字前方
- **API 变更**：`titlePosition` 字段固定为 `"prefix"`

### 4. 称号修改冷却
- **新增**：每 24 小时只能修改一次称号
- **影响**：用户在保存称号后，需等待 24 小时才能再次修改

## 插件适配指南

### 等级变更

插件端需要更新等级判断逻辑：

```java
// 旧代码
// tier 0 = 无称号
// tier 1 = 单色称号
// tier 2 = 渐变称号

// 新代码
// tier 0 = 无称号
// tier 1 = 渐变称号（支持单色和渐变）

public boolean canUseTitle(int tier) {
    return tier >= 1;
}

public boolean canUseGradient(int tier) {
    return tier >= 1; // 现在等级 1 就可以使用渐变
}
```

### 数据库迁移

如果数据库中有 `titleTier = 2` 的记录，建议将其更新为 `titleTier = 1`：

```sql
-- 将原来的等级 2 更新为等级 1
UPDATE player_titles SET title_tier = 1 WHERE title_tier = 2;
```

### 称号格式变更

移除对方括号的处理：

```java
// 旧代码可能有类似逻辑
String displayTitle = "[" + title + "]";

// 新代码：直接使用 title
String displayTitle = title;
```

### 聊天消息格式

建议格式：

```
{称号} {玩家名}: {消息}
```

### 兑换码等级

兑换码生成现在只支持生成等级 1（渐变称号）的兑换码。

## 向后兼容

- 已存储的旧格式称号（带括号）在用户重新编辑保存后会自动转换为新格式
- WebSocket 协议保持不变
- API 接口保持不变

## 测试建议

1. 测试等级 1 用户可以使用单色和渐变称号
2. 测试称号修改冷却功能（24 小时限制）
3. 测试兑换码只能生成等级 1
4. 测试已有等级 2 用户的称号显示正常
